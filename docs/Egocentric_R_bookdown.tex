% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Egocentric network analysis with R},
  pdfauthor={Raffaele Vacca},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Egocentric network analysis with R}
\author{\href{http://www.raffaelevacca.com/}{Raffaele Vacca}}
\date{2024-02-01}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

This book is a companion to \href{http://www.raffaelevacca.com/teaching/egocentric-r/}{my workshop} on egocentric network analysis with R. Over the past several years I have taught this workshop at different conferences and summer schools on social network analysis, personal networks, and network science -- such as \href{https://www.insna.org/}{INSNA Sunbelt} conferences, \href{https://netscisociety.net/home}{NetSci} conferences, and the \href{https://sway.office.com/1TpXMhGqKa7fTsAC}{UAB Barcelona Course on Personal Network Analysis}. The book is a work in progress and I'll keep updating it as I continue to teach the workshop and related courses.

A Spanish translation of part of this book has appeared in the journal \href{https://revistes.uab.cat/redes/article/view/v31-n2-vacca}{REDES - Revista hispana para el an√°lisis de redes sociales}. My colleagues and I provide a more in-depth discussion of personal network analysis and the methods covered in this workshop in our textbook on personal network research \citep{mccarty_conducting_2019}. See the bibliography at the end of the book for a list of other useful references on egocentric or personal network analysis.

Feel free to \href{http://www.raffaelevacca.com/}{contact me} to know more about this workshop and how to take it, or to give me feedback or report any issue about this book.

\href{https://www.guilford.com/books/Conducting-Personal-Network-Research/McCarty-Lubbers-Vacca-Molina/9781462538386/authors}{\includegraphics[width=0.5\textwidth,height=\textheight]{./Figures/McCarty_et_al_2019_cover.jpg}}

\hypertarget{setup}{%
\section{Workshop setup}\label{setup}}

To take this workshop you need to:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Download the last version of \textbf{R} \href{https://cran.r-project.org/mirrors.html}{here} (select a location near you)

  \begin{itemize}
  \tightlist
  \item
    Follow instructions to install R in your computer
  \end{itemize}
\item
  Download \textbf{RStudio} (free version) \href{https://www.rstudio.com/products/rstudio/download/}{here}

  \begin{itemize}
  \tightlist
  \item
    Follow instructions to install RStudio in your computer
  \end{itemize}
\item
  Install the \textbf{R packages} listed \protect\hyperlink{packages}{below}

  \begin{itemize}
  \tightlist
  \item
    Open RStudio and go to \texttt{Top\ menu\ \textgreater{}\ Tools\ \textgreater{}\ Install\ packages...}
  \item
    Install each package in the list
  \end{itemize}
\item
  Bring your \textbf{laptop} to the workshop
\item
  Download the \textbf{workshop folder} and save it to your computer: see \protect\hyperlink{materials}{below}

  \begin{itemize}
  \tightlist
  \item
    I recommend that you do this in class at the beginning of the workshop so as to download the most updated version of the folder.
  \end{itemize}
\item
  Once in class, go to the workshop folder on your computer (point 5 above) and double-click on the \emph{R project} file in it (\texttt{.Rproj} extension).

  \begin{itemize}
  \tightlist
  \item
    That will open RStudio: you're all set!
  \end{itemize}
\end{enumerate}

\textbf{NOTE:} It's very important that you save the workshop folder \emph{as downloaded} to a location in your computer, and open the \texttt{.Rproj} \emph{within that folder}. By doing so, you will be opening RStudio \emph{and} setting the workshop folder as your \protect\hyperlink{starting-R-and-loading-packages}{R working directory}. All our R scripts assume that working directory. In particular, they assume that the \texttt{Data} subfolder is in your R working directory. You can type \texttt{getwd()} in your R console to see the path to your R working directory and make sure that it's correctly pointed to the location of the workshop folder in your computer.

\hypertarget{materials}{%
\section{Workshop materials}\label{materials}}

The materials for this workshop consist of this book and the workshop folder.

You can \textbf{download the workshop folder} from \href{https://github.com/raffaelevacca/egocentric-r-book}{this GitHub repository}:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Click on the \texttt{Code} green button \textgreater{} Download ZIP
\item
  Unzip the folder and save it to your computer
\end{enumerate}

The workshop folder contains several files and folders, but you only need to focus on the following:

\begin{itemize}
\tightlist
\item
  \texttt{Scripts} subfolder: all the R code shown in this book.
\item
  \texttt{Data} subfolder: all the data we're going to use.
\item
  \texttt{egocentric-r.Rproj}: the workshop's R project file (you use this to launch RStudio).
\end{itemize}

The \texttt{Scripts} subfolder includes different R script (.R) files. You can access and run the R code in each script by opening the corresponding .R file in RStudio. Each script in \texttt{Scripts} corresponds to one of the following chapters (see the table of contents):

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  \protect\hyperlink{basics}{Basics of the R language} (\texttt{02\_Basics} script and slideshow).
\item
  \protect\hyperlink{represent}{Representing and visualizing ego-networks in R} (\texttt{03\_Representing\_egonets.R} script and slideshow).
\item
  \protect\hyperlink{composition}{Analyzing ego-network composition} (\texttt{04\_Composition} script and slideshow).
\item
  \protect\hyperlink{structure}{Analyzing ego-network structure} (\texttt{05\_Structure} script and slideshow).
\item
  \protect\hyperlink{multilevel}{Modeling tie- or alter-level variables with multilevel models} (\texttt{06\_Multilevel} script and slideshow).
\item
  \protect\hyperlink{egor}{Introduction to the \texttt{egor} package} (\texttt{07\_egor} script and slideshow).
\item
  \protect\hyperlink{supplementary}{Supplementary topics} (\texttt{08\_Supplementary} script and slideshow).
\end{enumerate}

The \textbf{slides} used for this workshop can be downloaded \href{https://www.dropbox.com/sh/o8rncfrtks1sx3s/AACyzgkwbhTDWsPIKST_2e6Ya?dl=0}{here}.

\hypertarget{r-settings}{%
\section{R settings}\label{r-settings}}

\hypertarget{packages}{%
\subsection{Required R packages}\label{packages}}

\begin{itemize}
\tightlist
\item
  For descriptive statistics

  \begin{itemize}
  \tightlist
  \item
    \href{https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html}{\texttt{janitor}}
  \item
    \href{https://cran.r-project.org/web/packages/skimr/vignettes/skimr.html}{\texttt{skimr}}
  \end{itemize}
\item
  For network data, measures, visualization

  \begin{itemize}
  \tightlist
  \item
    \href{https://github.com/tilltnet/egor}{\texttt{egor}}
  \item
    \href{https://github.com/thomasp85/ggraph}{\texttt{ggraph}}
  \item
    \href{https://igraph.org/}{\texttt{igraph}}
  \item
    \href{https://mbojan.github.io/intergraph/}{\texttt{intergraph}}
  \item
    \href{http://statnet.org/}{\texttt{statnet}}
  \item
    \href{https://github.com/thomasp85/tidygraph}{\texttt{tidygraph}}
  \end{itemize}
\item
  To fit multilevel statistical models and view their results

  \begin{itemize}
  \tightlist
  \item
    \href{https://cran.r-project.org/web/packages/broom.mixed/vignettes/broom_mixed_intro.html}{\texttt{broom.mixed}}
  \item
    \href{https://cran.r-project.org/web/packages/car/index.html}{\texttt{car}}
  \item
    \href{https://strengejacke.github.io/ggeffects/}{\texttt{ggeffects}}
  \item
    \href{https://github.com/lme4/lme4}{\texttt{lme4}}
  \end{itemize}
\item
  General

  \begin{itemize}
  \tightlist
  \item
    \href{https://magrittr.tidyverse.org/}{\texttt{magrittr}}
  \item
    \href{https://www.tidyverse.org/}{\texttt{tidyverse}}. This is a collection of different packages that share a common language and set of principles, including \texttt{dplyr}, \texttt{ggplot2}, and \texttt{purrr}. See \href{http://r4ds.had.co.nz/}{Wickham and Grolemund (2017)} for more information.
  \end{itemize}
\end{itemize}

\hypertarget{rstudio-options}{%
\subsection{RStudio options}\label{rstudio-options}}

RStudio gives you the ability to select and change various settings and features of its interface: see the \texttt{Preferences...} menu option. These are some of the settings you should pay attention to:

\begin{itemize}
\tightlist
\item
  \texttt{Preferences...\ \textgreater{}\ Code\ \textgreater{}\ Editing\ \textgreater{}\ Soft-wrap\ R\ source\ file}. Here you can decide whether or not to wrap long code lines in the editor. When code lines in a script are \emph{not} wrapped, be aware that some code will be hidden if script lines are longer than your editor window's width (you'll have to scroll right to see the rest of the code). With a script (\texttt{.R}) file open in the editor, try both options (checked and unchecked) to see what you're more comfortable with.
\item
  \texttt{Preferences...\ \textgreater{}\ Code\ \textgreater{}\ Display\ \textgreater{}\ Highlight\ R\ function\ calls}. This allows you to highlight all pieces of code that call an R function (``command''). I find function highlights very helpful to navigate a script and suggest that you check this option.
\end{itemize}

\hypertarget{data}{%
\section{Data}\label{data}}

This workshop uses real-world data collected in 2012 with a personal network survey among 107 Sri Lankan immigrants in Milan, Italy. Out of the 107 respondents, 102 reported their personal network. All data are in the \texttt{Data} subfolder.

The data files include ego-level data (gender, age, educational level, etc. for each Sri Lankan respondent), alter attributes (alter's nationality, country of residence, closeness to ego etc.), and information on alter-alter ties. Each personal network has a fixed size of 45 alters. Information about data variables and categories is available in \texttt{./Data/codebook.xlsx}.

All data objects are saved as R objects in the R data file \texttt{data.rda}. Data objects are the following:

\begin{itemize}
\tightlist
\item
  \texttt{ego.df}: A data frame with ego-level attributes for all respondents (egos).
\item
  \texttt{alter.attr.all}: A data frame with alter-level attributes for all alters from all respondents.
\item
  \texttt{gr.list}: A list. Each list element is one ego-network stored as an \texttt{igraph} object.
\item
  \texttt{alter.attr.28}: A data frame with alter-level attributes only for alters nominated by ego ID 28.
\item
  \texttt{gr.28}: The ego-network of ego ID 28 stored as an \texttt{igraph} object.
\item
  \texttt{gr.ego.28}: The same as \texttt{gr.28}, but with the node of the ego included in the \texttt{igraph} object.
\end{itemize}

The R data objects above were imported from raw csv data files. All csv files are in the \texttt{./Data/raw\_data/} subfolder:

\begin{itemize}
\tightlist
\item
  \texttt{ego\_data.csv}: A csv file with ego-level data for all the egos.
\item
  \texttt{alter\_attributes.csv}: A single csv file including attributes of all alters from all egos.
\item
  \texttt{alter\_ties\_028.csv}: The edge list for ego ID 28's egocentric network.
\item
  \texttt{alter\_attributes\_028.csv}: The alter attributes in ego ID 28's egocentric network.
\item
  \texttt{adj\_028.csv}: The adjacency matrix for ego ID 28's egocentric network.
\item
  \texttt{alter\_ties.csv}: A single csv file with the edge list for all alters from all egos.
\end{itemize}

For most of the workshop we will directly use R data objects in \texttt{data.rda}. We will \emph{not} focus on importing ego-network data from outside sources (for example, csv files). However, Section \ref{egor-import} shows you how the data objects in \texttt{data.rda} were created by importing csv files with the \texttt{egor} package. Section \ref{import-igraph} covers importing ego-network data using just \texttt{tidyverse} and \texttt{igraph}.

\hypertarget{author-and-contacts}{%
\section{Author and contacts}\label{author-and-contacts}}

I am an assistant professor of sociology at the \href{https://www.unimi.it/en}{University of Milan} in the \href{http://eng.sps.unimi.it/ecm/home}{Deparment of Social and Political Sciences}. My main research and teaching interests are social networks, migration, health inequalities, and studies of science. I also teach and do research on data science, statistics, and computational methods for the social sciences. More information about me, my work and my contact details is \href{http://www.raffaelevacca.com/about-me/}{here}.

\hypertarget{basics}{%
\chapter{R basics}\label{basics}}

\hypertarget{overview}{%
\section{Overview}\label{overview}}

This chapter covers some basic tools and characteristics of the R language that we'll use in the workshop. While this obviously can't be a comprehensive introduction to R, we'll demonstrate some essential R notions and features that are commonly used in social science data analysis, including (egocentric) social network analysis.

The script covers the following topics:

\begin{itemize}
\tightlist
\item
  Starting R, getting help with R.
\item
  Creating and saving R objects.
\item
  Vectors and matrices, data frames and tibbles.
\item
  Arithmetic and relational operations.
\item
  Subsetting vectors, matrices, and data frames.
\end{itemize}

\hypertarget{starting-R-and-loading-packages}{%
\section{Starting R and loading packages}\label{starting-R-and-loading-packages}}

\begin{itemize}
\tightlist
\item
  Before starting any work in R, you normally want to do two things:

  \begin{itemize}
  \tightlist
  \item
    Make sure your R session is pointing to the correct \emph{working directory}.
  \item
    Install and/or load the \emph{packages} you are going to use.
  \end{itemize}
\item
  \textbf{Working directory}. By default, R will look for files and save new files in this directory.

  \begin{itemize}
  \tightlist
  \item
    Type \texttt{getwd()} in the console to view your current working directory.
  \item
    If you opened RStudio by double-clicking on a project (\texttt{.Rproj}) file, then the working directory is the folder where that file is located.
  \item
    You can always use \texttt{setwd()} to manually change your working directory to any path, but it's usually more convenient to work with R projects and their default working directory instead.
  \item
    In RStudio, you can also check the current working directory by clicking on the \texttt{Files} panel.
  \end{itemize}
\item
  \textbf{R packages}. There are two steps to using a package in R:

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    \textbf{Install} the package. \emph{You do this just once}. Use \texttt{install.packages("package\_name")} or the appropriate RStudio menu (\texttt{Tools\ \textgreater{}\ Install\ Packages...}). Once you install a package, the package files are in your system R folder and R will be able to always find the package there.
  \item
    \textbf{Load} the package in your current session. Use \texttt{library(package\_name)} (\emph{no} quotation marks around the package name). \emph{You do this in each R session in which you need the package}, that is, every time you start R and you need the package.
  \end{enumerate}
\item
  An R package is just a collection of \textbf{functions}. You can only use an R function if that function is included in a package you loaded in the current session.
\item
  Sometimes two different functions from two different packages have the same \textbf{name}. For example, both the \texttt{igraph} package and the \texttt{sna} package have a function called \texttt{degree}. If both packages are loaded, typing just \texttt{degree} might give you unexpected results, because R will pick one of the two functions (the one in the package that was loaded most recently), which might not be the function you meant.

  \begin{itemize}
  \tightlist
  \item
    To avoid this problem, you can use the \texttt{package::function()} notation: \texttt{igraph::degree()} will always call the \texttt{degree} function from the \texttt{igraph} package, while \texttt{sna::degree()} will call the \texttt{degree} function from the \texttt{sna} package.
  \end{itemize}
\item
  Tip: To check the package that a function comes from, just go to that function's manual page. The package will be indicated in the first line of the page. E.g., type \texttt{?degree} to see where the \texttt{degree} function comes from.

  \begin{itemize}
  \tightlist
  \item
    If no currently loaded package has a function called \texttt{degree}, then typing \texttt{?degree} will cause a warning (\texttt{No\ documentation\ for\ \textquotesingle{}degree\textquotesingle{}}).
  \item
    If multiple, currently loaded packages have a function called \texttt{degree}, then typing \texttt{?degree} will bring up a page with the list of all those packages.
  \end{itemize}
\item
  This workshop will use a number of packages, listed \protect\hyperlink{packages}{here}.
\end{itemize}

\hypertarget{console-vs-scripts}{%
\subsection{Console vs scripts}\label{console-vs-scripts}}

\begin{itemize}
\tightlist
\item
  When you open RStudio, you typically see two separate windows: the script editor and the console. You can write R code in either of them.
\item
  \textbf{Console}. Here you write R code line by line. Once you type a line, you press \texttt{ENTER} to execute it. By pressing \texttt{ARROW\ UP} you go back to the last line you ran. By continuing to press \texttt{ARROW\ UP}, you can navigate through all the lines of code you previously executed. This is called the ``commands history'' (all the lines of code executed in the current session). You will lose all this code (all the history) when you quit R, unless you explicitly save the history to a file (which is not what you typically do, you should just write the code in a script).\\
\item
  \textbf{Script editor}. Here you write a script. This is the most common way of working with R. A script is simply a plain text file where all your R code is saved. If your work is in a script, it is \textbf{reproducible}.
\item
  Both the R standard GUI and RStudio have a script editor with several helpful tools. Among other things, these allow you to run a script while you write it. By pressing \texttt{CTRL+ENTER} (Windows) or \texttt{CMD+ENTER} (Mac), you run the script line your cursor is on (or the selected script region).

  \begin{itemize}
  \tightlist
  \item
    Note that with RStudio you can run the single script line where your cursor is; a whole highlighted region of code; the region of code from the beginning of the script up to the line where your cursor is; the region of code from the line where your cursor is up to the end of the script. See the \emph{Code} menu and its keyboard shortcuts.
  \end{itemize}
\item
  The script editor also allows you to save your script. In RStudio, see \texttt{File\ \textgreater{}\ Save} and its keyboard shortcut. R script files commonly have a \texttt{.R} extension (e.g.~``\texttt{myscript.R}''). But note that a script file is just a text file (like any \texttt{.txt} file), which you can open and edit in any text editor, or in Microsoft Word and the likes.
\item
  You can also run a whole script altogether --- this is called \textbf{sourcing} a script. By running \texttt{source("myscript.R")}, you source the script file \texttt{myscript.R} (assuming the file is in your working directory, otherwise you'll have to enter the whole file path). In RStudio: see \emph{Code} \textgreater{} \emph{Source} and its keyboard shortcut.
\item
  In both the console and the script editor, any line that starts by \texttt{\#} is called a \textbf{comment}. R disregards comments --- it just prints them as they are in the console (does not parse and execute them as programming code). Remember to always use comments to document what your code is doing (this is good for yourself and for others).
\item
  In RStudio you can navigate the script headings in your script with a drop-down menu in the bottom-left of the script editor. Any line that starts by \texttt{\#} and ends by \texttt{\#\#\#\#}, \texttt{-\/-\/-\/-}, or \texttt{====} is read as a heading by RStudio.
\end{itemize}

\hypertarget{getting-help}{%
\subsection{Getting help}\label{getting-help}}

\begin{itemize}
\tightlist
\item
  Getting help is one of the most common things you do when using R. As a beginner, you'll constantly need to get help (for example, read manual pages) about R functions. Also as an experienced user, you'll often need to go back to the manual pages of particular functions or other R help resources. At any experience level, using R involves constantly using its documentation and help resources.
\item
  The following are a few help tools in R:

  \begin{itemize}
  \tightlist
  \item
    \texttt{help(...)} or \texttt{?...} are the most common ways of getting help: they send you to the R manual page for a specific function. E.g. \texttt{help(sum)} or \texttt{?sum} (they are equivalent).
  \item
    \texttt{help.start()} (or RStudio: \texttt{Help\ \textgreater{}\ R\ Help}) gives you general help pages in html (introduction to R, references to all functions in all installed packages, etc.).
  \item
    \texttt{demo()} gives you demos on specific topics. Run \texttt{demo()} to see all available topics.
  \item
    \texttt{example()} gives you example code on specific functions, e.g.~\texttt{example(sum)} for the function \texttt{sum}.\\
  \item
    \texttt{help.search(...)} or \texttt{??...} search for a specific string in the manual pages, e.g.~\texttt{??histogram}.
  \end{itemize}
\item
  In addition to built-in help facilities within R, there are plenty of ways to get \textbf{R help online}. Certain popular R packages have their own website, e.g.~\href{http://ggplot2.tidyverse.org/}{ggplot2}, \href{http://igraph.org/}{igraph}, and \href{http://www.statnet.org/}{statnet}. Other websites for general R help include \href{http://www.rdocumentation.org/}{rdocumentation.org} and \href{http://stackoverflow.com/}{stackoverflow.com}. See the workshop slides or talk to me for more information.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# What\textquotesingle{}s the current working directory? }
\CommentTok{\# getwd() }
\CommentTok{\# Un{-}comment to check your actual working directory.}

\CommentTok{\# Change the working directory. }
\CommentTok{\# setwd("/my/working/directory") }
\CommentTok{\# (Delete the leading "\#" and type in your actual working directory\textquotesingle{}s path}
\CommentTok{\# instead of "/my/working/directory")}

\CommentTok{\# You should use R projects (.Rproj) to point to a working directory instead of}
\CommentTok{\# manually changing it.}

\CommentTok{\# Suppose that we want to use the package "igraph" in the following code.}
\FunctionTok{library}\NormalTok{(igraph)}

\CommentTok{\# Note that we can only load a package if we have it installed. In this case, I}
\CommentTok{\# have igraph already installed. Had this not been the case, I would have have}
\CommentTok{\# needed to install it: }
\CommentTok{\# install.packages("igraph").}
\CommentTok{\# (Packages can also be installed through an RStudio menu item).}

\CommentTok{\# Let\textquotesingle{}s load another suite of packages we\textquotesingle{}ll use in the rest of this script.}
\FunctionTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# Note that whatever is typed after the "\#" sign has no effect but to be printed}
\CommentTok{\# as is in the console: it is a comment.}
\end{Highlighting}
\end{Shaded}

\hypertarget{objects-in-r}{%
\section{Objects in R}\label{objects-in-r}}

\begin{quote}
In R, everything that \textbf{exists} is an object. Everything that \textbf{happens} is a function call.
- John Chambers
\end{quote}

\begin{itemize}
\tightlist
\item
  R is an object-oriented programming language. Everything is contained in an \textbf{object}, including data, analysis tools and analysis results. Things such as datasets, commands (called ``functions'' in R), regression results, descriptive statistics, etc., are all objects.
\item
  An object has a \emph{name} and a \emph{value}. You create an object by \textbf{assigning} a value to a name.

  \begin{itemize}
  \tightlist
  \item
    You assign with \texttt{\textless{}-} or with \texttt{=}.
  \item
    R is \textbf{case-sensitive}: the object named \texttt{mydata} is different from the object named \texttt{Mydata}.
  \end{itemize}
\item
  Whenever you run an operation or execute a function in R, you need to assign the result to an object if you want to save it and re-use it later. \textbf{Assign it or lose it}: anything that is not assigned to an object is just printed to the console and lost.
\item
  Objects have a size (bytes, megabytes, etc.) and a \textbf{type} (technically, a \emph{class}, a \emph{type} and a \emph{mode} --- more on this \protect\hyperlink{types-and-classes-of-objects}{later}).
\item
  A \textbf{function} is a particular type of object. Functions take other objects as arguments (input) and return more objects as a result (output). R functions are what other data analysis programs call ``commands''. See Section \ref{functions} for more about functions.
\end{itemize}

\hypertarget{the-workspace}{%
\subsection{The workspace}\label{the-workspace}}

\begin{itemize}
\tightlist
\item
  During your R session, objects (data, results) are located in the computer's main memory. They make up your workspace: the set of \textbf{all the objects} currently in memory. They will disappear when you quit R, unless you save them to files on disk.
\item
  What's in your current workspace?

  \begin{itemize}
  \tightlist
  \item
    The function \texttt{ls()} shows you a full list of the objects currently in the workspace.
  \item
    Alternatively, in RStudio open the Environment panel to get a clickable list of objects currently in the workspace (if you don't see your Environment panel, check \texttt{Preferences...\ \textgreater{}\ Pane\ Layout}).
  \end{itemize}
\end{itemize}

\hypertarget{saving-and-removing-objects}{%
\subsection{Saving and removing objects}\label{saving-and-removing-objects}}

\begin{itemize}
\tightlist
\item
  Two main functions to \textbf{save} R objects to files: \texttt{save()} (saves specific objects, its arguments); \texttt{save.image()} (saves all the current workspace).
\item
  Unless you specify a different path, all files you save from R are put in your current working directory.
\item
  The most common file extensions for files that store R objects are \texttt{.rda} and \texttt{.RData}.
\item
  If you have a file with R objects, say \texttt{objects.rda}, you can \textbf{load} it in you current R session using the \texttt{load()} function: \texttt{load(file=\ "objects.rda")}. This assumes \texttt{objects.rda} is in your current working directory (otherwise you'll have to specify the whole file path).
\item
  The function \texttt{rm()} \textbf{removes} specific objects from the workspace. You can use it to clear the workspace from all existing objects by typing \texttt{rm(list=ls())} (remember that \texttt{ls()} returns a character vector with the names of all the objects in the current workspace).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create the object a: assign the value 50 to the name "a"}
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{50}

\CommentTok{\# Display ("print") the object a.}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s create another object.}
\NormalTok{b }\OtherTok{\textless{}{-}} \StringTok{"Mark"}

\CommentTok{\# Display it.}
\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Mark"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create and display object at the same time.}
\NormalTok{(obj }\OtherTok{\textless{}{-}} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s reuse the object we created for a simple operation.}
\NormalTok{a }\SpecialCharTok{+} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 53
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# What if we want to save this result?}
\NormalTok{result }\OtherTok{\textless{}{-}}\NormalTok{ a }\SpecialCharTok{+} \DecValTok{3}

\CommentTok{\# All objects in the workspace}
\FunctionTok{ls}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a"      "b"      "obj"    "result"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Now we can view that result whenever we need it.}
\NormalTok{result}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 53
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...and further re{-}use it}
\NormalTok{result}\SpecialCharTok{*}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 106
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that R is case{-}sensitive, "result" is different from "reSult".}
\NormalTok{reSult}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in eval(expr, envir, enclos): object 'reSult' not found
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s clear the workspace before proceeding.}
\FunctionTok{rm}\NormalTok{(}\AttributeTok{list=}\FunctionTok{ls}\NormalTok{())}

\CommentTok{\# The workspace is now empty.}
\FunctionTok{ls}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## character(0)
\end{verbatim}

\hypertarget{vector-and-matrix-objects}{%
\subsection{Vector and matrix objects}\label{vector-and-matrix-objects}}

\begin{itemize}
\tightlist
\item
  \textbf{Vectors} are the most basic objects you use in R. Vectors can be numeric (numerical data), logical (TRUE/FALSE data), or character (string data).
\item
  The basic function to create a vector is \texttt{c} (\textbf{concatenate}).
\item
  Other useful functions to create vectors: \texttt{rep} and \texttt{seq}.

  \begin{itemize}
  \tightlist
  \item
    Another function we'll use to create vectors later in the workshop is \texttt{seq\_along}. \texttt{seq\_along(x)} creates a vector consisting of a sequence of integers from 1 to \texttt{length(x)} in steps of 1.
  \item
    Also keep in mind the \texttt{:} shortcut: \texttt{c(1,\ 2,\ 3,\ 4)} is the same as \texttt{1:4}.
  \end{itemize}
\item
  The \textbf{length} (number of elements) is a basic property of vectors: \texttt{length(x)} returns the length of vector \texttt{x}.
\item
  When we \texttt{print} vectors, the numbers in square brackets indicate the positions of vector elements.
\item
  To create a matrix: \texttt{matrix}. Its main arguments are the cell values (within \texttt{c()}), number of rows (\texttt{nrow}) and number of columns (\texttt{ncol}). Values are arranged in a \texttt{nrow} x \texttt{ncol} matrix \emph{by column}. See \texttt{?matrix}.
\item
  When we \texttt{print} matrices, the numbers in square brackets indicate the row and column numbers.
\end{itemize}

\hypertarget{dataframes}{%
\subsection{Data frames}\label{dataframes}}

\begin{itemize}
\tightlist
\item
  ``Data frame'' is R's name for dataset. A dataset is a collection of cases (rows), and variables (columns) which are measured on those cases.
\item
  When \texttt{print}ed in R, data frames look like matrices. However, unlike matrix columns, data frame columns can be of different types, e.g.~a numeric variable and a character variable.
\item
  On the other hand, just like matrix columns, data frame columns (variables) must all have the same \texttt{length} (number of cases). You can't put together variables (vectors) of different length in the same data frame.
\item
  Although data frames look like matrices, in R's mind they are a specific kind of \emph{list} (more about lists in Section \ref{lists}). In fact, the \texttt{class} of a data frame is \texttt{data.frame}, but the \texttt{type} of a data frame is \texttt{list}. The list elements for a data frame are its variables (columns).
\item
  \textbf{Tibbles.} The tidyverse packages, which we use in this workshop, rely on a more efficient form of data frame, called \emph{tibble}.

  \begin{itemize}
  \tightlist
  \item
    A tibble has class \texttt{tbl\_df} \emph{and} \texttt{data.frame}. This means that, to R, a tibble is \emph{also} a data frame, and any function that works on data frames normally also works on tibbles.
  \item
    A tibble has a number of advantages over a traditional data frame, some of which we'll see in this workshop.
  \item
    One of the advantages is the clearer and more informative way in which tibbles are printed. When we print a tibble data frame we can immediately see its number of rows, number of columns, names of variables, and type of each variable (numeric, integer, character, etc.).
  \item
    To convert an existing data frame to tibble: \texttt{as\_tibble}. To create a tibble from scratch (similar to the \texttt{data.frame} function in base R): \texttt{tibble}.
  \end{itemize}
\item
  While data frames can be created manually in R (with the functions \texttt{data.frame} in base R and \texttt{tibble} in \texttt{tidyverse}), data are most commonly imported into R from external sources, like a csv or txt file.
\item
  We'll import data from csv files using the \texttt{read\_csv()} function from \texttt{tidyverse}.

  \begin{itemize}
  \tightlist
  \item
    \texttt{read\_csv()} reads csv files (values separated by ``,'' or ``;''). \texttt{read\_delim()} reads files in which values are separated by any delimiter.
  \item
    These functions have many arguments that make them very flexible and allow users to import basically any kind of table stored in a text file. Check out \texttt{?read\_delim}.
  \item
    In base R, the corresponding functions are \texttt{read.csv()} and \texttt{read.table()}.
  \end{itemize}
\item
  Data can also be imported into R from most external file formats (SAS, SPSS, Stata, Excel, etc.) using the tidyverse packages \texttt{readxl} and \texttt{haven}, or the \texttt{foreign} package in traditional R.
\item
  Note that you can click on a data frame's name in RStudio's Environment pane. That will open the data frame in a window, similar to SPSS's data view.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s create a simple vector.}
\NormalTok{(x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Shortcut for the same thing.}
\NormalTok{(y }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# What\textquotesingle{}s the length of x?}
\FunctionTok{length}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that when we print vectors, numbers in square brackets indicate positions}
\CommentTok{\# of the vector elements.}

\CommentTok{\# Create a simple matrix.}
\NormalTok{adj }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{), }\AttributeTok{nrow=} \DecValTok{3}\NormalTok{, }\AttributeTok{ncol=}\DecValTok{3}\NormalTok{)}

\CommentTok{\# This is what our matrix looks like:}
\NormalTok{adj}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2] [,3]
## [1,]    0    1    1
## [2,]    1    0    1
## [3,]    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Notice the row and column numbers in square brackets. }

\CommentTok{\# Normally we create data frames by importing data from external files, for}
\CommentTok{\# example csv files.}
\NormalTok{ego.df }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/ego\_data.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 102 Columns: 9
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (4): ego.sex, ego.edu, ego.empl.bin, ego.age.cat
## dbl (5): ego_ID, ego.age, ego.arr, ego.inc, empl
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View the result.}
\NormalTok{ego.df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second~    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second~    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second~     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note the different pieces of information that are displayed when printing a tibble}
\CommentTok{\# data frame.}
\end{Highlighting}
\end{Shaded}

\hypertarget{arithmetic-statistical-and-relational-operations}{%
\section{Arithmetic, statistical, and relational operations}\label{arithmetic-statistical-and-relational-operations}}

\hypertarget{arithmetic-operations-and-recycling}{%
\subsection{Arithmetic operations and recycling}\label{arithmetic-operations-and-recycling}}

\begin{itemize}
\tightlist
\item
  R can work as a normal calculator.

  \begin{itemize}
  \tightlist
  \item
    Addition/subtraction: \texttt{7+3}
  \item
    Multiplication: \texttt{7*3}
  \item
    Negative: \texttt{-7}
  \item
    Division: \texttt{7/3}
  \item
    Integer division: \texttt{7\%/\%3}
  \item
    Integer remainder: \texttt{7\%\%3}
  \item
    Exponentiation: \texttt{7\^{}3}
  \end{itemize}
\item
  Many operations involving vectors in R are performed \textbf{element-wise}, i.e., separately on each element of the vector (see examples below).
\item
  Most operations on vectors use the \textbf{recycling} rule: if a vector is too short, its values are re-used the number of times needed to match the desired length (see examples below).
\item
  Examples of vector operations and recycling:

  \begin{itemize}
  \tightlist
  \item
    \texttt{{[}1\ 2\ 3\ 4{]}\ +\ {[}1\ 2\ 3\ 4{]}\ =\ {[}1+1\ 2+2\ 3+3\ 4+4{]}} (element-wise addition.)
  \item
    \texttt{{[}1\ 2\ 3\ 4{]}\ +\ 1\ =\ {[}1+1\ 2+1\ 3+1\ 4+1{]}} (\texttt{1} is recycled 3 times to match the \texttt{length} of the first vector.)
  \item
    \texttt{{[}1\ 2\ 3\ 4{]}\ +\ {[}1\ 2{]}\ =\ {[}1+1\ 2+2\ 3+1\ 4+2{]}} (\texttt{{[}1\ 2{]}} is recycled once.)
  \item
    \texttt{{[}1\ 2\ 3\ 4{]}\ +\ {[}1\ 2\ 3{]}\ =\ {[}1+1\ 2+2\ 3+3\ 4+1{]}} (\texttt{{[}1\ 2\ 3{]}} is recycled one third of a time: R will warn that the length of longer vector is not a multiple of the length of shorter vector.)
  \end{itemize}
\end{itemize}

\hypertarget{relational-operations-and-logical-vectors}{%
\subsection{Relational operations and logical vectors}\label{relational-operations-and-logical-vectors}}

\begin{itemize}
\tightlist
\item
  \textbf{Relational} operators: \texttt{\textgreater{}}, \texttt{\textless{}}, \texttt{\textless{}=}, \texttt{\textgreater{}=}. Equal is \texttt{==} (NOT \texttt{=}). \emph{Not} equal is \texttt{!=}.

  \begin{itemize}
  \tightlist
  \item
    Note: equal is \texttt{==}, whereas \texttt{=} has a different meaning. \texttt{=} is used to assign function arguments (e.g.~\texttt{matrix(x,\ nrow\ =\ 3,\ ncol\ =\ 4)}), or to assign objects (\texttt{x\ \textless{}-\ 2} is the same as \texttt{x\ =\ 2}).
  \end{itemize}
\item
  Relational operations result in \textbf{logical} vectors: vectors of \texttt{TRUE}/\texttt{FALSE} values.
\item
  Like arithmetic operations, relational ones are performed element-wise on vectors, and recycling applies.
\item
  Logical operators: \texttt{\&} for AND, \texttt{\textbar{}} for OR.
\item
  Negation (i.e.~opposite) of a logical vector: \texttt{!}.
\item
  Is value \emph{x} in vector \emph{y}? \texttt{x\ \%in\%\ y}.
\item
  R can convert logical vectors to numeric (\texttt{as.numeric()}, \texttt{as.integer()}). In this conversion, \texttt{TRUE} becomes \texttt{1} and \texttt{FALSE} becomes \texttt{0}. Conversely, if converted to logical (\texttt{as.logical()}), \texttt{1/0} are \texttt{TRUE/FALSE}.

  \begin{itemize}
  \tightlist
  \item
    Therefore, if \texttt{x} is a logical vector, \texttt{sum(x)} gives the \emph{count} of \texttt{TRUE}s in \texttt{x} (sum of \texttt{1}s in the vector).
  \item
    \texttt{mean(x)} gives the \emph{proportion} of \texttt{1}s in \texttt{x} (mean of a binary vector: sum of \texttt{1}s in the vector divided by number of elements in the vector).
  \end{itemize}
\end{itemize}

\hypertarget{examples-of-arithmetic-and-statistical-functions}{%
\subsection{Examples of arithmetic and statistical functions}\label{examples-of-arithmetic-and-statistical-functions}}

\begin{itemize}
\tightlist
\item
  Arithmetic \emph{vector} functions are performed element-wise, and return a vector. Examples:

  \begin{itemize}
  \tightlist
  \item
    Exponential: \texttt{exp(x)}.
  \item
    Logarithm: \texttt{log(x)} (base \emph{e}) or \texttt{log10(x)} (base 10).
  \end{itemize}
\item
  Statistical \emph{scalar} functions are executed on the set of all vector elements taken together, and return a scalar. Examples:

  \begin{itemize}
  \tightlist
  \item
    \texttt{mean(x)} and \texttt{median(x)}.
  \item
    Standard deviation and variance: \texttt{sd(x)}, \texttt{var(x)}.
  \item
    Minimum and maximum: \texttt{min(x)}, \texttt{max(x)}.
  \item
    \texttt{sum(x)}: sum of all elements in \texttt{x}.
  \end{itemize}
\item
  \texttt{table(x)} is another basic statistical function (but it's not scalar):

  \begin{itemize}
  \tightlist
  \item
    \texttt{table(x)} returns a \texttt{table} object with the absolute frequencies of values in \texttt{x}.
  \end{itemize}
\item
  Functions such as \texttt{sum()}, \texttt{mean()} and \texttt{table()} are very useful when programming in R (for example, when writing your own functions). However, if you just need descriptive statistics for the data, there are more convenient tools you can use. Some of these are the following functions, which work well with \texttt{tidyverse} (we'll see them in Ch. \ref{composition}):

  \begin{itemize}
  \tightlist
  \item
    The \texttt{skim} function (from the \texttt{skimr} package) for descriptive statistics of continuous/quantitative variables.
  \item
    The \texttt{tabyl} function (from the \texttt{janitor} package) for frequencies of categorical variables.
  \end{itemize}
\end{itemize}

\hypertarget{missing-and-infinite-values}{%
\subsection{Missing and infinite values}\label{missing-and-infinite-values}}

\begin{itemize}
\tightlist
\item
  Missing values in R are represented by \texttt{NA} (Not Available).

  \begin{itemize}
  \tightlist
  \item
    If your data has a different code for missing values (e.g., -99), you'll have to recode that to NA for R to properly handle missing values in your data.
  \end{itemize}
\item
  Infinity may result from arithmetic operations: \texttt{Inf} and \texttt{-Inf} (e.g.~\texttt{3/0}). \texttt{NaN} also may result, meaning Not a Number (e.g.~\texttt{0/0}).

  \begin{itemize}
  \tightlist
  \item
    While \texttt{NA}s can appear in any type of object, \texttt{Inf}, \texttt{-Inf} and \texttt{NaN} can only appear in numeric objects.
  \end{itemize}
\item
  \texttt{is.na(x)} checks if each element of \texttt{x} is NA and returns TRUE if that's the case, FALSE otherwise. It's a vector function (its value has the same \texttt{length} as \texttt{x}).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Just a few arithmetic operations between vectors to demonstrate element{-}wise}
\CommentTok{\# calculations and the recycling rule.}

\NormalTok{(v1 }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(v2 }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1 2 3 4] + [1 2 3 4]}
\NormalTok{v1 }\SpecialCharTok{+}\NormalTok{ v2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 4 6 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1 2 3 4] + 1}
\DecValTok{1}\SpecialCharTok{:}\DecValTok{4} \SpecialCharTok{+} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1 2 3 4] + [1 2]}
\NormalTok{(v1 }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(v2 }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v1 }\SpecialCharTok{+}\NormalTok{ v2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 4 4 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [1 2 3 4] + [1 2 3]}
\DecValTok{1}\SpecialCharTok{:}\DecValTok{4} \SpecialCharTok{+} \DecValTok{1}\SpecialCharTok{:}\DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in 1:4 + 1:3: longer object length is not a multiple of shorter object
## length
\end{verbatim}

\begin{verbatim}
## [1] 2 4 6 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Relational operations.}

\CommentTok{\# Let\textquotesingle{}s take a single variable from the ego attribute data: ego\textquotesingle{}s age (in years)}
\CommentTok{\# for the first 10 respondents. Let\textquotesingle{}s put the result in a separate vector. This}
\CommentTok{\# code involves indexing, we\textquotesingle{}ll explain it better below.}
\NormalTok{age }\OtherTok{\textless{}{-}}\NormalTok{ ego.df}\SpecialCharTok{$}\NormalTok{ego.age[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{]}
\NormalTok{age}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 61 38 30 25 29 56 52 35 22 51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note how the following comparisons are performed element{-}wise, and the value}
\CommentTok{\# to which age is compared (30) is recycled.}

\CommentTok{\# Is age equal to 30?}
\NormalTok{age}\SpecialCharTok{==}\DecValTok{30}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The resulting logical vector is TRUE for those elements (i.e., respondents)}
\CommentTok{\# who meet the condition.}

\CommentTok{\# Which respondent\textquotesingle{}s age is greater than 40?}
\NormalTok{age }\SpecialCharTok{\textgreater{}} \DecValTok{40}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Which respondent age values are lower than 40 OR greater than 60?}
\NormalTok{age }\SpecialCharTok{\textless{}} \DecValTok{40} \SpecialCharTok{|}\NormalTok{ age }\SpecialCharTok{\textgreater{}} \DecValTok{60}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Which elements of "age" are lower than 40 AND greater than 30?}
\NormalTok{age }\SpecialCharTok{\textless{}} \DecValTok{40} \SpecialCharTok{\&}\NormalTok{ age }\SpecialCharTok{\textgreater{}} \DecValTok{30}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Notice the difference between OR (|) and AND (\&).}

\CommentTok{\# Is 30 in "age"? I.e., is one of the respondents of 30 years of age?}
\DecValTok{30} \SpecialCharTok{\%in\%}\NormalTok{ age}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Is "age" in c(30, 35)? That is, which values of "age" are either 30 or 35?}
\NormalTok{age }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{35}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A logical vector can be converted to numeric: TRUE becomes 1 and FALSE becomes}
\CommentTok{\# 0.}
\NormalTok{age }\SpecialCharTok{\textgreater{}} \DecValTok{45}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.numeric}\NormalTok{(age }\SpecialCharTok{\textgreater{}} \DecValTok{45}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 1 0 0 0 0 1 1 0 0 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This allows us to use the sum() and the mean() functions to get the count and}
\CommentTok{\# proportion of TRUE\textquotesingle{}s in a logical vector.}

\CommentTok{\# Count of TRUE\textquotesingle{}s: Number of respondents (elements of "age") that are older than}
\CommentTok{\# 40.}
\FunctionTok{sum}\NormalTok{(age }\SpecialCharTok{\textgreater{}} \DecValTok{45}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# How many respondents in the vector are older than 30?}
\FunctionTok{sum}\NormalTok{(age }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Proportion of TRUE\textquotesingle{}s: What\textquotesingle{}s the proportion of "age" elements (respondents)}
\CommentTok{\# that are greater than 50?}
\FunctionTok{mean}\NormalTok{(age }\SpecialCharTok{\textgreater{}} \DecValTok{50}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ***** EXERCISES}
\CommentTok{\#}
\CommentTok{\# (1) Obtain a logical vector indicating which elements of "age" are smaller than 30}
\CommentTok{\# OR greater than 50. Then obtain a logical vector indicating which elements of}
\CommentTok{\# "age" are smaller than 30 AND greater than 50. Why all elements are FALSE in}
\CommentTok{\# the latter vector?}
\CommentTok{\#}
\CommentTok{\# (2) Using the : shortcut, create a vector that goes from 1 to 100 in steps of 1.}
\CommentTok{\# Obtain a logical vector that is TRUE for the first 10 elements and the last 10}
\CommentTok{\# elements of the vector.}
\CommentTok{\#}
\CommentTok{\# (3) Use the age vector with relational operators and sum/mean to answer these}
\CommentTok{\# questions: How many respondents are younger than 50? What percentage of}
\CommentTok{\# respondents is between 30 and 40 years of age, including 30 and 40? Is there}
\CommentTok{\# any respondent who is younger than 20 OR older than 70 (use any())?}
\CommentTok{\#}
\CommentTok{\# (4) How many elements of the vector 1:100 are greater than the length of that }
\CommentTok{\# vector divided by 2? Use sum().}
\CommentTok{\#}
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{subsetting}{%
\section{Subsetting}\label{subsetting}}

\begin{itemize}
\tightlist
\item
  \textbf{Subsetting} is crucial in R. It means appending an index (or subscript) to an object to subset or extract one (or more) of its elements or components. This is also called ``indexing'' or ``subscripting''.
\item
  Subsetting can be used to \textbf{extract} (view, query) the component of an object, or to \textbf{replace} it (assign a different value to that element).
\item
  The basic notation for subsetting in R is \texttt{{[}\ {]}}: \texttt{x{[}i{]}} gives you the \emph{i}-th element of object \texttt{x}.
\item
  \textbf{Numeric subsetting} uses integers in square brackets \texttt{{[}\ {]}}: e.g.~\texttt{x{[}3{]}}. Note that you can use negative integers to index (select) everything \emph{but} that element: e.g.~\texttt{x{[}-3{]}}, \texttt{x{[}c(-2,-4){]}}.
\item
  \textbf{Logical subsetting} uses logical vectors in square brackets \texttt{{[}\ {]}}. It's used to subset objects based on a condition, e.g., to index all values in \texttt{x} that are greater than 3 (see example code below).
\item
  \textbf{Name subsetting} uses element names. Elements in a vector, and rows or columns in a matrix can have names.

  \begin{itemize}
  \tightlist
  \item
    Names can be displayed and assigned using the \texttt{names} function in base R, or \texttt{set\_names} (just to assign names) in tidyverse.
  \end{itemize}
\item
  When subsetting you must take into account the \textbf{number of dimensions} of an object. For example, vectors have one dimension, matrices have two. Arrays can be defined with three dimensions or more (e.g.~three-way tables).

  \begin{itemize}
  \tightlist
  \item
    Square brackets typically contain a slot for each dimension of the object, separated by a comma:

    \begin{itemize}
    \tightlist
    \item
      \texttt{x{[}i{]}} indexes the \emph{i}-th element of the one-dimensional object \texttt{x};
    \item
      \texttt{x{[}i,j{]}} indexes the \emph{i,j}-th element of the two-dimensional object \texttt{x} (e.g.~\texttt{x} is a matrix, \emph{i} refers to a row and \emph{j} refers to a column);
    \item
      \texttt{x{[}i,j,k{]}} indexes the \emph{i,j,k}-th element of the three-dimensional object \texttt{x}, etc.
    \end{itemize}
  \item
    Notice that a dimension's slot may be empty, meaning that we index all elements in that dimension. So, if \texttt{x} is a matrix, \texttt{x{[}3,{]}} will index the whole 3rd row of the matrix -- i.e.~\texttt{{[}}row 3, all columns\texttt{{]}}.
  \item
    If \texttt{x} has more than one dimension (e.g.~it's a matrix), then \texttt{x{[}3{]}} (no comma, just one slot) is still valid, but it might give you unexpected results.
  \end{itemize}
\item
  Matrices have special functions that can be used for subsetting, e.g.~\texttt{diagonal()}, \texttt{upper.tri()}, \texttt{lower.tri()}. These can be useful for manipulating adjacency matrices.
\item
  Particular subsetting rules may apply to particular \texttt{class}es of objects, for example lists and data frames (see next Section \ref{index-df}).
\end{itemize}

\hypertarget{index-df}{%
\subsection{Subsetting data frames}\label{index-df}}

\begin{itemize}
\tightlist
\item
  \textbf{List notations.} Data frames are a special class of lists (see Section \ref{lists} for more about lists). Just like any list, data frames can be subset in the following three ways:

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    \texttt{{[}\ {]}} notation, e.g.~\texttt{df{[}3{]}} or \texttt{df{[}"variable.name"{]}}. This returns another data frame that only includes the indexed element(s), e.g.~only the 3\textsuperscript{rd} element. Note:

    \begin{itemize}
    \tightlist
    \item
      This notation \emph{preserves the} \texttt{data.frame} \emph{class}: the result is still a data frame.
    \item
      This notation can be used to index \emph{multiple} elements of a data frame into a new data frame, e.g.~\texttt{df{[}c(1,3,5){]}} or \texttt{df{[}c("sex",\ "age"){]}}
    \end{itemize}
  \item
    \texttt{{[}{[}\ {]}{]}} notation, e.g.~\texttt{df{[}{[}3{]}{]}} or \texttt{df{[}{[}"variable.name"{]}{]}}. This returns the specific element (column) selected, not as a data frame but as a vector with its own type and class, e.g.~the numeric vector \emph{within} the 3\textsuperscript{rd} element of \texttt{df}. Note two differences from the \texttt{{[}\ {]}} notation:

    \begin{itemize}
    \tightlist
    \item
      \texttt{{[}{[}\ {]}{]}} \emph{does not} preserve the \texttt{data.frame} class. The result is \emph{not} a data frame.
    \item
      Consistently, \texttt{{[}{[}\ {]}{]}} can only be used to index a \emph{single} element (column) of the data frame, not multiple elements.
    \end{itemize}
  \item
    The \texttt{\$} notation. If \emph{variable.name} is the name of a specific variable (column) in \texttt{df}, then \texttt{df\$variable.name} indexes that variable. This is the same as the \texttt{{[}{[}\ {]}{]}} notation: \texttt{df\$variable.name} is the same as \texttt{df{[}{[}"variable.name"{]}{]}}, and it's also the same as \texttt{df{[}{[}i{]}{]}} (where \texttt{i} is the position of the variable called \emph{variable.name} in the data frame).
  \end{enumerate}
\item
  \textbf{Matrix notation.} Data frames can also be subset like a matrix, with the \texttt{{[}\ ,\ {]}} notation:

  \begin{itemize}
  \tightlist
  \item
    \texttt{df{[}2,3{]}}, \texttt{df{[}2,\ {]}}, \texttt{df{[}\ ,3{]}}.
  \item
    \texttt{df{[},"age"{]}}, \texttt{df{[},c("sex",\ "age"){]}}, \texttt{df{[}5,"age"{]}}
  \end{itemize}
\item
  \textbf{Keep in mind the difference} between the following:

  \begin{itemize}
  \tightlist
  \item
    Extracting a data frame's variable (column) in itself, as a vector (numeric, character, etc.) --- The single pepper packet by itself in the figure below (panel C). This is given by \texttt{df{[}{[}i{]}{]}}, \texttt{df{[}{[}"variable.name"{]}{]}}, \texttt{df\$variable.name}.
  \item
    Extracting another data frame of just one variable (column) -- The single pepper packet \emph{within} the pepper shaker in the figure below (panel B). This is given by \texttt{df{[}i{]}}, \texttt{df{[}"variable.name"{]}}.
  \end{itemize}
\item
  \textbf{Subsetting verbs} in tidyverse. In addition to subsetting data frames via the base indexing syntax described above, we can also use the subsetting functions introduced by the \texttt{dplyr} package in tidyverse (see \protect\hyperlink{the-tidyverse-syntax}{below}).
\end{itemize}

\href{https://twitter.com/hadleywickham/status/643381054758363136?lang=en}{\includegraphics[width=0.5\textwidth,height=\textheight]{./Figures/wickham_indexing_tweet.png}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Numeric indexing                                                          {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Let\textquotesingle{}s use our vector of ego age values again.}
\NormalTok{age}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 61 38 30 25 29 56 52 35 22 51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Index its 2nd element: The age of the 2nd respondent.}
\NormalTok{age[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 38
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Its 2nd, 4th and 5th elements.}
\NormalTok{age[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 38 25 29
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fifth to sevents elements}
\NormalTok{age[}\DecValTok{5}\SpecialCharTok{:}\DecValTok{7}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 29 56 52
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Use indexing to assign (replace) an element.}
\NormalTok{age[}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{45}

\CommentTok{\# The content of x has now changed.}
\NormalTok{age}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 61 45 30 25 29 56 52 35 22 51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s index the adjacency matrix we created before.}
\NormalTok{adj}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2] [,3]
## [1,]    0    1    1
## [2,]    1    0    1
## [3,]    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Its 2,3 cell: Edge from node 2 to node 3.}
\NormalTok{adj[}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Its 2nd column: All edges to node 2.}
\NormalTok{adj[,}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 0 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Its 2nd and 3rd row: All edges from nodes 2 and 3.}
\NormalTok{adj[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2] [,3]
## [1,]    1    0    1
## [2,]    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Logical indexing                                                          {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Which values of "age" are between 40 and 60?}

\CommentTok{\# Let\textquotesingle{}s create a logical index that flags these values.}
\NormalTok{(ind }\OtherTok{\textless{}{-}}\NormalTok{ age }\SpecialCharTok{\textgreater{}} \DecValTok{40} \SpecialCharTok{\&}\NormalTok{ age }\SpecialCharTok{\textless{}} \DecValTok{60}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] FALSE  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Use this index to extract these values from vector "age" via logical indexing.}
\NormalTok{age[ind]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 45 56 52 51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We could also have typed directly:}
\NormalTok{age[age }\SpecialCharTok{\textgreater{}} \DecValTok{40} \SpecialCharTok{\&}\NormalTok{ age }\SpecialCharTok{\textless{}} \DecValTok{60}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 45 56 52 51
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Indexing data frames                                                     {-}{-}{-}{-} }
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# We\textquotesingle{}ll use our ego{-}level data frame.}
\NormalTok{ego.df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second~    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second~    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second~     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Numeric indexing works on data frames too: it allows you to index variables.}

\CommentTok{\# The 3rd variable.}
\NormalTok{ego.df[}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 1
##    ego.age
##      <dbl>
##  1      61
##  2      38
##  3      30
##  4      25
##  5      29
##  6      56
##  7      52
##  8      35
##  9      22
## 10      51
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note the difference with the double square bracket.}
\NormalTok{ego.df[[}\DecValTok{3}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 61 38 30 25 29 56 52 35 22 51 50 45 51 32 57 42 32 55 44 25 28 60 54 30 37
##  [26] 41 47 33 37 29 39 31 52 30 57 44 47 42 44 31 31 56 36 47 47 35 43 22 55 32
##  [51] NA 60 51 53 25 33 38 37 27 34 32 26 36 53 42 45 36 54 49 35 27 32 58 51 55
##  [76] 59 27 35 24 52 27 42 47 43 53 54 35 50 51 40 49 33 33 36 32 35 55 61 34 44
## [101] 50 28
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# What do you think is the difference?}
\FunctionTok{class}\NormalTok{(ego.df[}\DecValTok{3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "tbl_df"     "tbl"        "data.frame"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(ego.df[[}\DecValTok{3}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The [[ ]] notation extracts the actual column as a vector, while [ ] keeps}
\CommentTok{\# the data frame class.}

\CommentTok{\# We can also index data frames as matrices.}
\CommentTok{\# The second and third columns.}
\NormalTok{ego.df[,}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 2
##    ego.sex ego.age
##    <chr>     <dbl>
##  1 Male         61
##  2 Male         38
##  3 Male         30
##  4 Male         25
##  5 Male         29
##  6 Male         56
##  7 Male         52
##  8 Male         35
##  9 Male         22
## 10 Male         51
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Lines 1 to 3}
\NormalTok{ego.df[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 9
##   ego_ID ego.sex ego.age ego.arr ego.edu  ego.inc  empl ego.empl.bin ego.age.cat
##    <dbl> <chr>     <dbl>   <dbl> <chr>      <dbl> <dbl> <chr>        <chr>      
## 1     28 Male         61    2008 Seconda~     350     3 Yes          60+        
## 2     29 Male         38    2000 Primary      900     4 Yes          36-40      
## 3     33 Male         30    2010 Primary      200     3 Yes          26-30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can use name indexing with data frames, selecting variables by name}
\NormalTok{ego.df[}\StringTok{"ego.age"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 1
##    ego.age
##      <dbl>
##  1      61
##  2      38
##  3      30
##  4      25
##  5      29
##  6      56
##  7      52
##  8      35
##  9      22
## 10      51
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ego.df[[}\StringTok{"ego.age"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 61 38 30 25 29 56 52 35 22 51 50 45 51 32 57 42 32 55 44 25 28 60 54 30 37
##  [26] 41 47 33 37 29 39 31 52 30 57 44 47 42 44 31 31 56 36 47 47 35 43 22 55 32
##  [51] NA 60 51 53 25 33 38 37 27 34 32 26 36 53 42 45 36 54 49 35 27 32 58 51 55
##  [76] 59 27 35 24 52 27 42 47 43 53 54 35 50 51 40 49 33 33 36 32 35 55 61 34 44
## [101] 50 28
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The $ notation is very common and concise. It\textquotesingle{}s equivalent to the [[ notation.}
\NormalTok{ego.df}\SpecialCharTok{$}\NormalTok{ego.age}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 61 38 30 25 29 56 52 35 22 51 50 45 51 32 57 42 32 55 44 25 28 60 54 30 37
##  [26] 41 47 33 37 29 39 31 52 30 57 44 47 42 44 31 31 56 36 47 47 35 43 22 55 32
##  [51] NA 60 51 53 25 33 38 37 27 34 32 26 36 53 42 45 36 54 49 35 27 32 58 51 55
##  [76] 59 27 35 24 52 27 42 47 43 53 54 35 50 51 40 49 33 33 36 32 35 55 61 34 44
## [101] 50 28
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This is the same as ego.df[[3]] or ego.df[["ego.age"]]}
\FunctionTok{identical}\NormalTok{(ego.df[[}\DecValTok{3}\NormalTok{]], ego.df}\SpecialCharTok{$}\NormalTok{ego.age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# With tidyverse, this type of indexing syntax is replaced by new "verbs" }
\CommentTok{\# (see section below):}
\CommentTok{\# * Index data frame rows: filter() instead of []}
\CommentTok{\# * Index data frame columns: select() instead of []}
\CommentTok{\# * Extract data frame variable as a vector: pull() instead of [[]] or $}


\CommentTok{\# ***** EXERCISES }
\CommentTok{\#}
\CommentTok{\# (1) What\textquotesingle{}s the mean age of respondents whose education is NOT "Primary"? Use}
\CommentTok{\# the ego.age and ego.edu variables. Remember that the "different from"}
\CommentTok{\# comparison operator is !=.}
\CommentTok{\#}
\CommentTok{\# (2) What is the modal education level (i.e., the most common education level)}
\CommentTok{\# of respondents who are older than 40? Use table() or tabyl().}
\CommentTok{\#}
\CommentTok{\# (3) Create the fictitious variable var \textless{}{-} c(1:30, rep(NA, 3), 34:50). Use is.na()}
\CommentTok{\# to index all the NA values in the variable. Then use is.na() to index all}
\CommentTok{\# values that are *not* NA. Hint: Remember the operator used to negate a logical}
\CommentTok{\# vector. Finally, use this indexing to remove all NA values from var.}
\CommentTok{\#}
\CommentTok{\# (4) Use the $ notation to extract the "ego.arr" variable in ego.df. Recode all }
\CommentTok{\# values equal to 2008 as 99. Hint: Index all values equal to 2008, then replace }
\CommentTok{\# them with 99 via the assignment operator. }
\CommentTok{\#}
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{the-tidyverse-syntax}{%
\section{\texorpdfstring{The \texttt{tidyverse} syntax}{The tidyverse syntax}}\label{the-tidyverse-syntax}}

\hypertarget{pipes-and-the-operator}{%
\subsection{\texorpdfstring{Pipes and the \texttt{\textbar{}\textgreater{}} operator}{Pipes and the \textbar\textgreater{} operator}}\label{pipes-and-the-operator}}

\begin{itemize}
\tightlist
\item
  The original pipe operator, \texttt{\%\textgreater{}\%}, was introduced by the \texttt{magrittr} package in 2014. It quickly gained popularity in the R community and was adopted by \texttt{igraph} and \texttt{tidyverse} (among other packages), which we use in this workshop. In 2021, R incorporated the pipe idea with a new, similar (but not identical) operator: \texttt{\textbar{}\textgreater{}}. See \href{https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/}{this page} for an overview of the differences between \texttt{\textbar{}\textgreater{}} and \texttt{\%\textgreater{}\%}.
\item
  The idea behind pipes is in essence very simple:

  \begin{itemize}
  \tightlist
  \item
    \texttt{f(g(x))} becomes \texttt{x\ \textbar{}\textgreater{}\ g()\ \textbar{}\textgreater{}\ f()}.
  \item
    For example: \texttt{mean(table(x))} becomes \texttt{x\ \textbar{}\textgreater{}\ table()\ \textbar{}\textgreater{}\ mean()}.
  \end{itemize}
\item
  So \texttt{\textbar{}\textgreater{}} pipes the output of the previous function (e.g., \texttt{table()}) into the input of the following function (e.g., \texttt{mean()}). This turns inside-to-outside code into left-to-right code. Because left to right is the direction most of us are used to read in (at least in English and other Western languages), pipes make R code easier to read and follow.
\item
  You may also see pipes concatenating multiple lines of code. That's possible and a common coding style. Instead of
\end{itemize}

\begin{verbatim}
x |> table() |> mean()
\end{verbatim}

you can write

\begin{verbatim}
x |>
  table() |>
  mean()
\end{verbatim}

\hypertarget{subsetting-data-frames-in-tidyverse}{%
\subsection{\texorpdfstring{Subsetting data frames in \texttt{tidyverse}}{Subsetting data frames in tidyverse}}\label{subsetting-data-frames-in-tidyverse}}

\begin{itemize}
\tightlist
\item
  Tidyverse includes the \texttt{dplyr} package for data frame manipulation. This is a very powerful package for all kinds of data wrangling. To learn more, see the package \href{https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf}{cheatsheet} and \href{https://dplyr.tidyverse.org/articles/index.html}{vignettes}.
\item
  Subsetting data frames with \texttt{dplyr}:

  \begin{itemize}
  \tightlist
  \item
    \texttt{dplyr::filter()} is used to subset rows (cases) of a data frame based on one or multiple conditions (for example, respondents with certain values on one or more variables). This preserves the data frame class, similar to \texttt{{[}\ {]}} indexing.
  \item
    \texttt{dplyr::select()} is used to subset columns (variables) of a data frame. You can use full variable names or select variables in many other ways (see examples in the \texttt{select} \href{https://dplyr.tidyverse.org/reference/select.html}{manual page}). This preserves the data frame class, similar to \texttt{{[}\ {]}} indexing.
  \item
    \texttt{dplyr::pull()} is used to extract a column as a vector. This does \emph{not} preserve the data frame class, similar to \texttt{{[}{[}\ {]}{]}} or \texttt{\$}.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The pipe operator                                                         {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Ego education variable }
\NormalTok{(edu }\OtherTok{\textless{}{-}}\NormalTok{ ego.df}\SpecialCharTok{$}\NormalTok{ego.edu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "Secondary"  "Primary"    "Primary"    "Secondary"  "Primary"   
##   [6] "Secondary"  "Primary"    "Secondary"  "Secondary"  "Primary"   
##  [11] "Secondary"  "Secondary"  "University" "Primary"    "Secondary" 
##  [16] "Primary"    "Primary"    "Secondary"  "Secondary"  "Primary"   
##  [21] "University" "University" "Primary"    "Secondary"  "Primary"   
##  [26] "Primary"    "Secondary"  "Primary"    "Primary"    "Primary"   
##  [31] "Secondary"  "Secondary"  "Secondary"  "Primary"    "Primary"   
##  [36] "Secondary"  "Secondary"  "Primary"    "Secondary"  "Primary"   
##  [41] "Primary"    "Primary"    "Primary"    "Secondary"  "Primary"   
##  [46] "Primary"    "Primary"    "University" "Primary"    "Secondary" 
##  [51] "University" "Primary"    "University" "Secondary"  "Secondary" 
##  [56] "University" "Primary"    "Primary"    "Secondary"  "Secondary" 
##  [61] "Secondary"  "University" "University" "University" "Secondary" 
##  [66] "Secondary"  "Secondary"  "University" "Primary"    "Secondary" 
##  [71] "Secondary"  "Secondary"  "University" "Primary"    "Secondary" 
##  [76] "Secondary"  "Secondary"  "Secondary"  "Secondary"  "Secondary" 
##  [81] "Secondary"  "Primary"    "Primary"    "University" "Primary"   
##  [86] "Primary"    "Secondary"  "Secondary"  "Secondary"  "University"
##  [91] "Secondary"  "Secondary"  "Primary"    "Primary"    "University"
##  [96] "Primary"    "Primary"    "Primary"    "Primary"    "Secondary" 
## [101] "Primary"    "Secondary"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Frequency of educational categories in the data}
\FunctionTok{table}\NormalTok{(edu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## edu
##    Primary  Secondary University 
##         42         45         15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Average frequency}
\FunctionTok{mean}\NormalTok{(}\FunctionTok{table}\NormalTok{(edu))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 34
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s re{-}write this with the pipe operator}
\NormalTok{edu }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{table}\NormalTok{() }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mean}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 34
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Subsetting data frames with dplyr: filter and select                      {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Filter to egos who are older than 40}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(ego.age }\SpecialCharTok{\textgreater{}} \DecValTok{40}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 51 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  3     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  4     48 Male         51    2007 Primary     950     4 Yes          51-60      
##  5     49 Male         50    2001 Second~    1300     4 Yes          41-50      
##  6     51 Male         45    2011 Second~     480     3 Yes          41-50      
##  7     52 Male         51    2002 Univer~    1200     4 Yes          51-60      
##  8     55 Male         57    1979 Second~     470     7 No           51-60      
##  9     56 Male         42    1992 Primary    1100     4 Yes          41-50      
## 10     58 Male         55    1990 Second~    1450     4 Yes          51-60      
## # i 41 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Filter to egos with Primary education}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(ego.edu }\SpecialCharTok{==} \StringTok{"Primary"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 42 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  2     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  3     39 Male         29    2007 Primary       0     1 No           26-30      
##  4     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  5     48 Male         51    2007 Primary     950     4 Yes          51-60      
##  6     53 Male         32    2003 Primary    1600     1 No           31-35      
##  7     56 Male         42    1992 Primary    1100     4 Yes          41-50      
##  8     57 Male         32    2000 Primary    1200     4 Yes          31-35      
##  9     60 Male         25    2011 Primary       0     1 No           18-25      
## 10     64 Male         54    1981 Primary     300     3 Yes          51-60      
## # i 32 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Combine the two conditions: Intersection.}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(ego.age }\SpecialCharTok{\textgreater{}} \DecValTok{40} \SpecialCharTok{\&}\NormalTok{ ego.edu }\SpecialCharTok{==} \StringTok{"Primary"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 21 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  2     48 Male         51    2007 Primary     950     4 Yes          51-60      
##  3     56 Male         42    1992 Primary    1100     4 Yes          41-50      
##  4     64 Male         54    1981 Primary     300     3 Yes          51-60      
##  5     68 Male         41    2008 Primary     600     4 Yes          41-50      
##  6     82 Male         57    1982 Primary    1190     4 Yes          51-60      
##  7     85 Male         42    2008 Primary     400     2 No           41-50      
##  8     90 Male         56    2004 Primary     450     4 Yes          51-60      
##  9     93 Male         47    2010 Primary     880     4 Yes          41-50      
## 10     95 Male         43    1997 Primary     800     4 Yes          41-50      
## # i 11 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Combine the two conditions: Union.}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(ego.age }\SpecialCharTok{\textgreater{}} \DecValTok{40} \SpecialCharTok{|}\NormalTok{ ego.edu }\SpecialCharTok{==} \StringTok{"Primary"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 72 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     39 Male         29    2007 Primary       0     1 No           26-30      
##  5     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  6     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  7     48 Male         51    2007 Primary     950     4 Yes          51-60      
##  8     49 Male         50    2001 Second~    1300     4 Yes          41-50      
##  9     51 Male         45    2011 Second~     480     3 Yes          41-50      
## 10     52 Male         51    2002 Univer~    1200     4 Yes          51-60      
## # i 62 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that the object ego.df hasn\textquotesingle{}t changed. To re{-}use any of the filtered data}
\CommentTok{\# frames above, we have to assign them to an object.}
\NormalTok{ego.df}\FloatTok{.40} \OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(ego.age }\SpecialCharTok{\textgreater{}} \DecValTok{40}\NormalTok{)}

\NormalTok{ego.df}\FloatTok{.40}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 51 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  3     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  4     48 Male         51    2007 Primary     950     4 Yes          51-60      
##  5     49 Male         50    2001 Second~    1300     4 Yes          41-50      
##  6     51 Male         45    2011 Second~     480     3 Yes          41-50      
##  7     52 Male         51    2002 Univer~    1200     4 Yes          51-60      
##  8     55 Male         57    1979 Second~     470     7 No           51-60      
##  9     56 Male         42    1992 Primary    1100     4 Yes          41-50      
## 10     58 Male         55    1990 Second~    1450     4 Yes          51-60      
## # i 41 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select specific variables}
\NormalTok{ego.df}\FloatTok{.40} \SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(ego.sex, ego.age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 51 x 2
##    ego.sex ego.age
##    <chr>     <dbl>
##  1 Male         61
##  2 Male         56
##  3 Male         52
##  4 Male         51
##  5 Male         50
##  6 Male         45
##  7 Male         51
##  8 Male         57
##  9 Male         42
## 10 Male         55
## # i 41 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# As usual, we can re{-}assign the result to the same data object}
\NormalTok{ego.df}\FloatTok{.40} \OtherTok{\textless{}{-}}\NormalTok{ ego.df}\FloatTok{.40} \SpecialCharTok{|\textgreater{}} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(ego.sex, ego.age)}

\NormalTok{ego.df}\FloatTok{.40}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 51 x 2
##    ego.sex ego.age
##    <chr>     <dbl>
##  1 Male         61
##  2 Male         56
##  3 Male         52
##  4 Male         51
##  5 Male         50
##  6 Male         45
##  7 Male         51
##  8 Male         57
##  9 Male         42
## 10 Male         55
## # i 41 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Pull a variable out of a data frame, as a vector}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(ego.age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 61 38 30 25 29 56 52 35 22 51 50 45 51 32 57 42 32 55 44 25 28 60 54 30 37
##  [26] 41 47 33 37 29 39 31 52 30 57 44 47 42 44 31 31 56 36 47 47 35 43 22 55 32
##  [51] NA 60 51 53 25 33 38 37 27 34 32 26 36 53 42 45 36 54 49 35 27 32 58 51 55
##  [76] 59 27 35 24 52 27 42 47 43 53 54 35 50 51 40 49 33 33 36 32 35 55 61 34 44
## [101] 50 28
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This is the same as}
\NormalTok{ego.df}\SpecialCharTok{$}\NormalTok{ego.age}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 61 38 30 25 29 56 52 35 22 51 50 45 51 32 57 42 32 55 44 25 28 60 54 30 37
##  [26] 41 47 33 37 29 39 31 52 30 57 44 47 42 44 31 31 56 36 47 47 35 43 22 55 32
##  [51] NA 60 51 53 25 33 38 37 27 34 32 26 36 53 42 45 36 54 49 35 27 32 58 51 55
##  [76] 59 27 35 24 52 27 42 47 43 53 54 35 50 51 40 49 33 33 36 32 35 55 61 34 44
## [101] 50 28
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ***** EXERCISES }
\CommentTok{\#}
\CommentTok{\# (1) Use the [ , ] notation to extract the education level and income of egos who}
\CommentTok{\# are younger than 30. Then do the same thing with the dplyr::filter() function.}
\CommentTok{\# }
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{represent}{%
\chapter{Representing and visualizing ego-networks}\label{represent}}

\hypertarget{overview-1}{%
\section{Overview}\label{overview-1}}

After learning some basics of the R language, we now focus on R tools for egocentric network data. To make things simpler, we'll start by considering just one egocentric network. The following chapters will show you how to replicate the same type of analysis on many ego-networks at once.

This chapter covers the following topics:

\begin{itemize}
\tightlist
\item
  Representing ego-level attribute data and alter-level attribute data in R.
\item
  Joining (merging) ego-level and alter-level data frames.
\item
  Representing alter-alter tie data.
\item
  Representing and manipulating an ego-network as an \texttt{igraph} object.
\item
  Visualizing an ego-network.
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{egocentric-data}{%
\section{Ego-level and alter-level data}\label{egocentric-data}}

\begin{itemize}
\tightlist
\item
  In this section we use the data objects described earlier in Section \ref{data}. All these objects are stored in the \texttt{data.rda} file. In sections \ref{egor-import} and \ref{import-igraph} we'll show how to create these objects from raw (csv) data using \texttt{egor} and \texttt{tidyverse}.
\item
  Egocentric network data typically include at least three types of data:

  \begin{itemize}
  \tightlist
  \item
    \textbf{Ego-level attribute data}. This is a dataset with attributes of egos. Each row is an ego (typically, a survey respondent) and each column is a characteristic of the ego. Following multilevel modeling terminology, we call this ``level 2'' because, in the multilevel structure of ego-network data, egos are the higher-level ``groups'' in which alters are clustered. In personal network surveys, these data are obtained from standard survey questions asking individual information about the respondent.
  \item
    \textbf{Alter-level attribute data}. This is a dataset with attributes of alters and of ego-alter ties. It is also the dataset that, for each alter, indicates who is the ego who nominated that alter: that is, it lists all the ego-alter ties. In this dataset, each row is an alter and each column is a characteristic of the alter, or of the relationship between the alter and the ego who nominated him/her. Following multilevel modeling terminology, we call this ``level 1'' because alters are the most granular units in the data, clustered within egos. In personal network surveys, these data are obtained from the so-called \emph{name generator} questions, which elicit lists of alters from each ego; and from the \emph{name interpreter} questions, which elicit characteristics of each alter.
  \item
    \textbf{Alter-alter tie data}. These are the data about alter-alter ties as reported by the ego. In personal network surveys, these data are obtained from so-called \emph{edge interpreter} questions.
  \end{itemize}
\item
  \textbf{File formats:}

  \begin{itemize}
  \tightlist
  \item
    Ego-level attribute data. This is normally a single dataset (in a single file), with each row representing one ego, and different columns representing different ego-level attributes. This is similar to any respondent-level dataset you have in standard survey data.
  \item
    Alter-level attribute data. Depending on the data collection software, you might have a single dataset (in a single file) including alters nominated by all egos; or separate datasets (in separate files), one for each ego, with the alters nominated by that ego (and with the same variables in all datasets).
  \item
    Alter-alter tie data. These are typically in edge list format or in adjacency matrix format, depending on the data collection software. If the tie data are in adjacency matrices, you normally have a separate adjacency matrix for each ego, in a separate file. If they are in edge lists, you might have a single edge list including alters from all egos (with an additional column indicating the ego that nominated the two alters), or a separate edge list (in a separate file) for each ego.
  \end{itemize}
\item
  The data format described above works well because, in standard egocentric data, the different ego-networks are \textbf{separate} (non-overlapping). This means that an alter can only ``belong'' to one and one only ego, and alter-alter ties only exist between alters nominated by the same egos. In other words, there are no links or overlaps between the networks of different egos.

  \begin{itemize}
  \tightlist
  \item
    In particular, this means that there is a one-to-one correspondence between alters and ego-alter ties: for each ego-alter tie there is only one alter, and vice versa (so the level of alters is the same as the level of ego-alter ties).
  \end{itemize}
\item
  In egocentric analysis you are frequently switching between level 1 and 2, and \textbf{joining} information from the two levels.
\item
  \textbf{Level-1 join.} Bring information from level 2 into the level-1 dataset.

  \begin{itemize}
  \tightlist
  \item
    For certain types of analysis you need to join ego attributes (level 2) into an alter-level data set (level 1).
  \item
    For example, you need to do this when estimating multilevel models in which the dependent variable is a characteristic of ego-alter ties (e.g., if the tie provides support), and some of the predictors are ego-level characteristics (e.g., gender of the ego).
  \item
    Because there is one ego for multiple alters, this is a one-to-many join, with the same value of an ego attribute (one ego row in the level-2 dataset) being joined to multiple alters (multiple alter rows in the level-1 dataset).
  \item
    The data frames are joined by ego ID.
  \end{itemize}
\item
  \textbf{Level-2 join.} Bring information from level 1 into the level-2 dataset.

  \begin{itemize}
  \tightlist
  \item
    In other cases you want to join alter attributes (level 1) into an ego-level dataset (level 2).
  \item
    For example, you need to do this when you want to analyze summary measures of ego-network characteristics (e.g.~average age of alters) among the egos.
  \item
    Because there are multiple alters for one ego, this requires that you first summarize or aggregate the alter attributes for each ego.
  \item
    If you have \emph{continuous} alter attributes, you typically summarize them by taking averages and dispersion measures (variance, standard deviation, etc.) of the alter attribute for each ego: for example, average alter age for each ego, or standard deviation of contact frequency between alters and each ego.
  \item
    If you have \emph{categorical} alter attributes, you normally summarize them by taking counts or proportions of certain categories, or qualitative diversity measures (e.g., generalized variance, entropy): for example, proportion of women, or ethnic diversity in each ego's network.
  \item
    Once you have these summary variables on ego-network \emph{composition}, you can join them with an ego-level dataset by ego ID.
  \item
    The level-2 join can also involve summary variables on ego-network \emph{structure}: for example, average alter degree, ego-network density, or number of components. These variables can be joined with an ego-level dataset by ego ID.
  \item
    We'll consider this type of ego-level summarization and the level-2 join in Chapters \ref{composition} and \ref{structure} about measures of ego-network composition and structure.
  \end{itemize}
\item
  In base R, data frames can be joined using the \texttt{merge} function. However, we use the \texttt{dplyr} join functions, whose code is more efficient and readable:

  \begin{itemize}
  \tightlist
  \item
    \texttt{left\_join()} retains all rows in the \emph{left} data frame, and discards any row in the right data frame that does not have a match with a row in the left data frame.
  \item
    \texttt{right\_join()} retains all rows in the \emph{right} data frame, and discards any row in the left data frame that does not have a match with a row in the right data frame.
  \item
    \texttt{full\_join()} retains all rows from both data frames.
  \end{itemize}
\item
  McCarty and colleagues (2019) provide a more detailed discussion of all types of egocentric network data, levels in egocentric data, and switching and joining operations between levels.
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    View ego-level data (level 2) and alter-level data (level 1) as stored in R data frames.
  \item
    Do the level-1 join: Bring ego attributes into an alter-level data frame.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load packages.}
\FunctionTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# Load data.}
\FunctionTok{load}\NormalTok{(}\StringTok{"./Data/data.rda"}\NormalTok{)}

\CommentTok{\# The file we just loaded includes the following objects.}

\CommentTok{\# * Ego{-}level attribute data}
\NormalTok{ego.df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <fct>     <dbl>   <dbl> <fct>     <dbl> <dbl> <fct>        <fct>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second~    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second~    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second~     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# * Attribute data for alters and ego{-}alter ties (all alters and ego{-}alter ties }
\CommentTok{\# in one data frame). }
\NormalTok{alter.attr.all}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,590 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <fct>     <fct>         <fct>        <fct>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 4,580 more rows
## # i 5 more variables: alter.res <fct>, alter.clo <dbl>, alter.loan <fct>,
## #   alter.fam <fct>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Level{-}1 join: Ego attributes into alter{-}level data (one to many).}
\NormalTok{(data }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(alter.attr.all, ego.df, }\AttributeTok{by=} \StringTok{"ego\_ID"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,590 x 20
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <fct>     <fct>         <fct>        <fct>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 4,580 more rows
## # i 13 more variables: alter.res <fct>, alter.clo <dbl>, alter.loan <fct>,
## #   alter.fam <fct>, alter.age <dbl>, ego.sex <fct>, ego.age <dbl>,
## #   ego.arr <dbl>, ego.edu <fct>, ego.inc <dbl>, empl <dbl>,
## #   ego.empl.bin <fct>, ego.age.cat <fct>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that the new data frame has one row for each alter, and the same ego ID}
\CommentTok{\# and ego attribute value is repeated for all alters belonging to the same ego.}
\NormalTok{data }\SpecialCharTok{|\textgreater{}} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(alter\_ID, ego\_ID, ego.age, ego.edu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,590 x 4
##    alter_ID ego_ID ego.age ego.edu  
##       <dbl>  <dbl>   <dbl> <fct>    
##  1     2801     28      61 Secondary
##  2     2802     28      61 Secondary
##  3     2803     28      61 Secondary
##  4     2804     28      61 Secondary
##  5     2805     28      61 Secondary
##  6     2806     28      61 Secondary
##  7     2807     28      61 Secondary
##  8     2808     28      61 Secondary
##  9     2809     28      61 Secondary
## 10     2810     28      61 Secondary
## # i 4,580 more rows
\end{verbatim}

\hypertarget{networks-in-r}{%
\section{Networks in R}\label{networks-in-r}}

\begin{itemize}
\tightlist
\item
  There are several packages for network analysis in R. The two main (collections of) R network packages are \texttt{igraph} and \texttt{statnet}. \texttt{igraph} is a single package. It represents networks as objects of class \texttt{igraph}. \texttt{statnet} is not a package, it's a collection of packages. It represents networks as objects of class \texttt{network}.
\item
  \texttt{igraph} and \texttt{statnet} are in part overlapping, in part complementary. Historically, \texttt{igraph} has focused more on network methods developed in computer science and physics, while \texttt{statnet} has emphasized network methods developed in statistics and the social sciences. Many things can be done in \emph{both} \texttt{igraph} and \texttt{statnet}: basic network creation, importing network data, network manipulation, basic network metrics such as centrality, and network visualization. On the other hand, a few things can only be done in \texttt{igraph} (e.g., ``community detection'' algorithms and modularity analysis), and others can only be done in \texttt{statnet} (e.g., ERGMs).
\item
  Most of this workshop uses the package \texttt{igraph}. This is because I personally find \texttt{igraph}'s syntax more intuitive for beginners, especially for simple operations on networks. In Chapter \ref{statnet} we'll also briefly demonstrate how networks are represented in \texttt{statnet}'s \texttt{network} objects. You should keep in mind that everything we'll do here with \texttt{igraph}, can also be done with \texttt{statnet}. In general, you'll need to learn about \texttt{statnet} too if you want to master a complete toolkit for social network analysis with R.
\item
  We'll also briefly use the \texttt{ggraph} package for network visualization and the \texttt{tidygraph} package for easier display and manipulation of networks. We don't have time to go into much detail about these two packages, but you can find more tutorials and learning resources about them online.

  \begin{itemize}
  \tightlist
  \item
    \texttt{ggraph} flexible and easy tools for network visualization by applying the \href{https://ggplot2.tidyverse.org/}{\texttt{ggplot2} grammar} of graphics to network data (learn more \href{https://github.com/thomasp85/ggraph}{here}). In addition to \texttt{ggraph}, you can also visualize networks with \texttt{igraph}, which uses base R plotting (see Section \ref{more-igraph}).
  \item
    \texttt{tidygraph} applies the \texttt{tidyverse} principles of \href{https://r4ds.had.co.nz/tidy-data.html}{tidy data} to networks. This allows you to easily view and manipulate the basic components of network data in tabular format, i.e., edge data as an edge list and node attribute data as a case-by-variable dataset. More information about \texttt{tidygraph} is \href{https://www.data-imaginist.com/2017/introducing-tidygraph/}{here}.
  \end{itemize}
\end{itemize}

\hypertarget{ego-networks-as-igraph-objects}{%
\section{\texorpdfstring{Ego-networks as \texttt{igraph} objects}{Ego-networks as igraph objects}}\label{ego-networks-as-igraph-objects}}

\begin{itemize}
\tightlist
\item
  In \texttt{igraph}, networks are called \textbf{graphs} and are represented by objects of class \texttt{igraph}. Nodes are called \textbf{vertices} and ties are called \textbf{edges}.
\item
  Given an igraph object \texttt{gr}:

  \begin{itemize}
  \tightlist
  \item
    \texttt{V(gr)} shows you the graph vertices (identified by \texttt{name}, if they have a \texttt{name} attribute, or by integers otherwise). This is an object of class \emph{vertex sequence} (\texttt{igraph.vs}).
  \item
    \texttt{E(gr)} shows you the graph edges. This is an object of class \emph{edge sequence} (\texttt{igraph.es}).
  \end{itemize}
\item
  Vertices, edges and graphs have \textbf{attributes}. You can import them from external data files, or you can set them manually in R. If you import data into an \texttt{igraph} object with a vertex attribute called ``age'', an edge attribute called ``strength'', and a graph attribute called ``size'', then

  \begin{itemize}
  \tightlist
  \item
    \texttt{V(gr)\$age} returns the vertex attribute \texttt{age} as a vector;
  \item
    \texttt{E(gr)\$strength} returns the edge attribute \texttt{strength} as a vector;
  \item
    \texttt{gr\$size} returns the graph attribute \texttt{size}.
  \end{itemize}
\item
  \texttt{print}ing an \texttt{igraph} object returns some \textbf{summary information} about the network. This includes the counts of vertices and edges, and whether the network is directed, named (i.e.~if vertices have a \texttt{name} attribute), weighted (i.e.~if edges have a \texttt{weight} attribute), or bipartite (also called two-mode).
\item
  \textbf{Querying vertices and edges}

  \begin{itemize}
  \tightlist
  \item
    Based on attributes. You can query vertices and edges with specific characteristics (attribute values), and save them for re-use. E.g. \texttt{V(gr){[}age=30{]}} returns all vertices whose \texttt{age} attribute equals 30; \texttt{E(gr){[}strength=1{]}} returns all edges whose strength is 1.
  \item
    Based on network structure. The \texttt{V(gr){[}...{]}} and \texttt{E(gr){[}...{]}} syntax can also be used with specific functions that extract information on tie distribution: for example, to query all vertices that are adjacent to a given vertex \emph{i}, or all edges between two particular subsets of vertices. The main functions here are \texttt{nei()}, \texttt{inc()} and \texttt{\%-\/-\%} (see code below).
  \item
    More information on useful igraph syntax for vertex and edge indexing is \href{http://igraph.org/r/doc/igraph-vs-indexing.html}{here} (vertex indexing) and \href{http://igraph.org/r/doc/igraph-es-indexing.html}{here} (edge indexing).
  \end{itemize}
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    View an ego-network as an \texttt{igraph} object.
  \item
    View vertex and edge attributes in an ego-network.
  \item
    Obtain descriptive statistics for attributes of alters (vertex attributes) and alter-alter ties (edge attributes) in the ego-network.
  \item
    Visualize an ego-network with \texttt{ggraph}, setting aesthetic parameters based on alter attributes.
  \item
    Query vertices and edges based on attributes.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load packages.}
\FunctionTok{library}\NormalTok{(igraph)}
\FunctionTok{library}\NormalTok{(ggraph)}
\FunctionTok{library}\NormalTok{(tidygraph)}
\FunctionTok{library}\NormalTok{(skimr)}
\FunctionTok{library}\NormalTok{(janitor)}

\CommentTok{\# The data.rda file, which we loaded earlier, also includes the ego{-}network of }
\CommentTok{\# ego 28 (as igraph object)}
\NormalTok{gr}\FloatTok{.28}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 32a99df UNW- 45 259 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 32a99df (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The graph is Undirected, Named, Weighted. It has 45 vertices and 259 edges. It}
\CommentTok{\# has a vertex attribute called "name", and an edge attribute called "weight". }
\CommentTok{\# We see several vertex attributes (see codebook.xlsx for their meaning).}

\CommentTok{\# Let\textquotesingle{}s reassign it to a new, generic object name. This makes the code more }
\CommentTok{\# generic and more easily re{-}usable on any ego{-}network igraph object }
\CommentTok{\# (of any ego ID).}
\NormalTok{gr }\OtherTok{\textless{}{-}}\NormalTok{ gr}\FloatTok{.28}

\CommentTok{\# We also have the same network, with ego included: note the different number}
\CommentTok{\# of vertices and edges compared to the previous graph.}
\NormalTok{gr.ego}\FloatTok{.28}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 3e551cc UNW- 46 304 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 3e551cc (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gr.ego }\OtherTok{\textless{}{-}}\NormalTok{ gr.ego}\FloatTok{.28}

\CommentTok{\# Show the graph. Note that ego is not included.}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{607}\NormalTok{)}
\FunctionTok{ggraph}\NormalTok{(gr) }\SpecialCharTok{+} 
  \FunctionTok{geom\_edge\_link}\NormalTok{() }\SpecialCharTok{+} \CommentTok{\# Draw edges}
  \FunctionTok{geom\_node\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{5}\NormalTok{, }\AttributeTok{color=}\StringTok{"blue"}\NormalTok{) }\SpecialCharTok{+} \CommentTok{\# Draw nodes}
  \FunctionTok{theme\_graph}\NormalTok{(}\AttributeTok{base\_family =} \StringTok{\textquotesingle{}Helvetica\textquotesingle{}}\NormalTok{) }\CommentTok{\# Set graph theme and font}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.6\linewidth]{Egocentric_R_bookdown_files/figure-latex/igraph-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# An igraph object can be indexed as an adjacency matrix.}

\CommentTok{\# Adjacency row of alter \#3.}
\NormalTok{gr[}\DecValTok{3}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    1    1    0    1    1    1    1    1    1    1    1    1    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##    0    0    0    0    0    0    0    1    1    0    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adjacency row of alter with vertex name (alter ID) "2805".}
\NormalTok{gr[}\StringTok{"2805"}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    1    1    1    1    0    1    1    1    1    1    1    0    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##    0    0    0    0    0    0    0    1    1    0    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adjacency columns of alters 3{-}5}
\NormalTok{gr[,}\DecValTok{3}\SpecialCharTok{:}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 45 x 3 sparse Matrix of class "dgCMatrix"
##      2803 2804 2805
## 2801    1    1    1
## 2802    1    1    1
## 2803    .    1    1
## 2804    1    .    1
## 2805    1    1    .
## 2806    1    1    1
## 2807    1    1    1
## 2808    1    1    1
## 2809    1    1    1
## 2810    1    1    1
## 2811    1    2    1
## 2812    1    .    .
## 2813    .    .    .
## 2814    .    .    .
## 2815    .    .    .
## 2816    .    .    .
## 2817    .    .    .
## 2818    .    .    .
## 2819    .    .    .
## 2820    .    .    .
## 2821    .    .    .
## 2822    .    .    .
## 2823    .    .    .
## 2824    .    .    .
## 2825    .    .    .
## 2826    .    .    .
## 2827    .    .    .
## 2828    .    .    .
## 2829    .    .    .
## 2830    .    .    .
## 2831    .    .    .
## 2832    .    .    .
## 2833    .    .    .
## 2834    .    .    .
## 2835    .    .    .
## 2836    .    .    .
## 2837    .    .    .
## 2838    .    .    .
## 2839    .    .    .
## 2840    1    2    1
## 2841    1    1    1
## 2842    .    .    .
## 2843    .    .    .
## 2844    .    .    .
## 2845    .    .    .
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert and view the ego{-}network as a tidygraph object: you can now see the }
\CommentTok{\# attribute data and edge list as tabular datasets.}
\NormalTok{(gr.tbl }\OtherTok{\textless{}{-}} \FunctionTok{as\_tbl\_graph}\NormalTok{(gr))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tbl_graph: 45 nodes and 259 edges
## #
## # An undirected simple graph with 1 component
## #
## # A tibble: 45 x 11
##   name  alter_num alter.sex alter.age.cat alter.rel    alter.nat alter.res
##   <chr>     <dbl> <chr>     <chr>         <chr>        <chr>     <chr>    
## 1 2801          1 Female    51-60         Close family Sri Lanka Sri Lanka
## 2 2802          2 Male      51-60         Other family Sri Lanka Sri Lanka
## 3 2803          3 Male      51-60         Close family Sri Lanka Sri Lanka
## 4 2804          4 Male      60+           Close family Sri Lanka Sri Lanka
## 5 2805          5 Female    41-50         Close family Sri Lanka Sri Lanka
## 6 2806          6 Female    60+           Close family Sri Lanka Sri Lanka
## # i 39 more rows
## # i 4 more variables: alter.clo <dbl>, alter.loan <chr>, alter.fam <chr>,
## #   alter.age <dbl>
## #
## # A tibble: 259 x 3
##    from    to weight
##   <int> <int>  <dbl>
## 1     1     2      1
## 2     1     3      1
## 3     1     4      1
## # i 256 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vertex and edge sequences and attributes                                  {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Vertex sequences and edge sequences can be extracted from a graph.}

\CommentTok{\# Vertex sequence of the whole graph. Notice that vertices are displayed by}
\CommentTok{\# "names" (alter IDs in this case).}
\FunctionTok{V}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 45/45 vertices, named, from 32a99df:
##  [1] 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## [16] 2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## [31] 2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Edge sequence of the whole graph. Notice that vertex names (alter IDs) are}
\CommentTok{\# used here too.}
\FunctionTok{E}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 259/259 edges from 32a99df (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## [31] 2802--2809 2802--2810 2802--2811 2802--2812 2802--2813 2802--2815
## [37] 2802--2823 2802--2831 2802--2840 2802--2841 2803--2804 2803--2805
## [43] 2803--2806 2803--2807 2803--2808 2803--2809 2803--2810 2803--2811
## [49] 2803--2812 2803--2840 2803--2841 2804--2805 2804--2806 2804--2807
## [55] 2804--2808 2804--2809 2804--2810 2804--2811 2804--2840 2804--2841
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View vertex attributes and calculate statistics on them.}

\CommentTok{\# Closeness of alters to ego.}
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.clo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] NA  3 NA NA NA NA  5  4  5  5  5  4  3  5  3  3  1  5  4  5  5  5  5  5  2
## [26]  3  4  5  5  5  5  3  5  3  4  5  5  5  5  3  3  3  3  3  5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mean closeness of alters to ego. }
\FunctionTok{mean}\NormalTok{(}\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.clo, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# More descriptive statistics on alter closeness.}
\NormalTok{skimr}\SpecialCharTok{::}\FunctionTok{skim\_tee}\NormalTok{(}\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.clo) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Data Summary ------------------------
##                            Values
## Name                       data  
## Number of rows             45    
## Number of columns          1     
## _______________________          
## Column type frequency:           
##   numeric                  1     
## ________________________         
## Group variables            None  
## 
## -- Variable type: numeric ------------------------------------------------------
##   skim_variable n_missing complete_rate mean   sd p0 p25 p50 p75 p100 hist 
## 1 data                  5         0.889  4.1 1.08  1   3   5   5    5 ‚ñÅ‚ñÅ‚ñÖ‚ñÇ‚ñá
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Alter\textquotesingle{}s country of residence.}
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.res}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka"
##  [7] "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka"
## [13] "Italy"     "Italy"     "Italy"     "Italy"     "Italy"     "Italy"    
## [19] "Italy"     "Other"     "Italy"     "Italy"     "Italy"     "Italy"    
## [25] "Italy"     "Italy"     "Sri Lanka" "Sri Lanka" "Sri Lanka" "Italy"    
## [31] "Italy"     "Italy"     "Italy"     "Italy"     "Italy"     "Italy"    
## [37] "Italy"     "Italy"     "Italy"     "Sri Lanka" "Sri Lanka" "Italy"    
## [43] "Italy"     "Italy"     "Italy"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Frequencies.}
\NormalTok{janitor}\SpecialCharTok{::}\FunctionTok{tabyl}\NormalTok{(}\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.res)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  V(gr)$alter.res  n    percent
##            Italy 27 0.60000000
##            Other  1 0.02222222
##        Sri Lanka 17 0.37777778
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This is more readable with the pipe operator.}
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.res }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tabyl}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  V(gr)$alter.res  n    percent
##            Italy 27 0.60000000
##            Other  1 0.02222222
##        Sri Lanka 17 0.37777778
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Alter IDs are stored in the "name" vertex attribute}
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{name}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "2801" "2802" "2803" "2804" "2805" "2806" "2807" "2808" "2809" "2810"
## [11] "2811" "2812" "2813" "2814" "2815" "2816" "2817" "2818" "2819" "2820"
## [21] "2821" "2822" "2823" "2824" "2825" "2826" "2827" "2828" "2829" "2830"
## [31] "2831" "2832" "2833" "2834" "2835" "2836" "2837" "2838" "2839" "2840"
## [41] "2841" "2842" "2843" "2844" "2845"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can also create new vertex attributes.}
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{new.attribute }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{45}

\CommentTok{\# Now a new attribute is listed for the graph.}
\NormalTok{gr}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 32a99df UNW- 45 259 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), new.attribute (v/n), weight (e/n)
## + edges from 32a99df (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Also edges have attributes, in this case "weight".}
\FunctionTok{E}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [75] 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 2 1
## [112] 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1
## [149] 1 1 1 1 1 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1
## [186] 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 2 1 1 1 1 1 1
## [223] 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Frequencies of edge weights.}
\FunctionTok{tabyl}\NormalTok{(}\FunctionTok{E}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{weight)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  E(gr)$weight   n    percent
##             1 235 0.90733591
##             2  24 0.09266409
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Also graphs have attributes, and we can query or assign them. For example,}
\CommentTok{\# assign the "ego\_ID" attribute for this graph: this is the personal network of}
\CommentTok{\# ego ID 28.}
\NormalTok{gr}\SpecialCharTok{$}\NormalTok{ego\_ID }\OtherTok{\textless{}{-}} \DecValTok{28}

\CommentTok{\# Check that the new attribute was created}
\NormalTok{gr}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 32a99df UNW- 45 259 -- 
## + attr: .egoID (g/n), ego_ID (g/n), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), new.attribute (v/n), weight (e/n)
## + edges from 32a99df (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Displaying vertex attributes in network visualization                     {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Let\textquotesingle{}s visualize our ego{-}network, using different node colors for different }
\CommentTok{\# countries of residence of alters.}

\CommentTok{\# Vertex attribute with alter\textquotesingle{}s country of residence.}
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.res}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka"
##  [7] "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka"
## [13] "Italy"     "Italy"     "Italy"     "Italy"     "Italy"     "Italy"    
## [19] "Italy"     "Other"     "Italy"     "Italy"     "Italy"     "Italy"    
## [25] "Italy"     "Italy"     "Sri Lanka" "Sri Lanka" "Sri Lanka" "Italy"    
## [31] "Italy"     "Italy"     "Italy"     "Italy"     "Italy"     "Italy"    
## [37] "Italy"     "Italy"     "Italy"     "Sri Lanka" "Sri Lanka" "Italy"    
## [43] "Italy"     "Italy"     "Italy"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot with alter.res as node color}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{607}\NormalTok{)}
\FunctionTok{ggraph}\NormalTok{(gr) }\SpecialCharTok{+} 
  \FunctionTok{geom\_edge\_link}\NormalTok{() }\SpecialCharTok{+} \CommentTok{\# Draw edges}
  \FunctionTok{geom\_node\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color=}\NormalTok{ alter.res), }\AttributeTok{size=}\DecValTok{5}\NormalTok{) }\SpecialCharTok{+} \CommentTok{\# Draw nodes setting alter.res }
  \CommentTok{\# as node color and fixed node size}
  \FunctionTok{theme\_graph}\NormalTok{(}\AttributeTok{base\_family =} \StringTok{\textquotesingle{}Helvetica\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.6\linewidth]{Egocentric_R_bookdown_files/figure-latex/igraph-2} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot with alter ID labels instead of circles}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{607}\NormalTok{)}
\FunctionTok{ggraph}\NormalTok{(gr) }\SpecialCharTok{+} 
  \FunctionTok{geom\_edge\_link}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_node\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{ name)) }\SpecialCharTok{+} 
  \FunctionTok{theme\_graph}\NormalTok{(}\AttributeTok{base\_family =} \StringTok{\textquotesingle{}Helvetica\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.6\linewidth]{Egocentric_R_bookdown_files/figure-latex/igraph-3} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s look at the same network, but with ego included}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{607}\NormalTok{)}
\FunctionTok{ggraph}\NormalTok{(gr.ego) }\SpecialCharTok{+} 
  \FunctionTok{geom\_edge\_link}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_node\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{ name)) }\SpecialCharTok{+} 
  \FunctionTok{theme\_graph}\NormalTok{(}\AttributeTok{base\_family =} \StringTok{\textquotesingle{}Helvetica\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.6\linewidth]{Egocentric_R_bookdown_files/figure-latex/igraph-4} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Indexing vertices and edges based on attributes or network structure      {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# View only female alters.}
\FunctionTok{V}\NormalTok{(gr)[alter.sex}\SpecialCharTok{==}\StringTok{"Female"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 8/45 vertices, named, from 32a99df:
## [1] 2801 2805 2806 2808 2809 2828 2832 2837
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View residence country just for female alters.}
\FunctionTok{V}\NormalTok{(gr)[alter.sex}\SpecialCharTok{==}\StringTok{"Female"}\NormalTok{]}\SpecialCharTok{$}\NormalTok{alter.res}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka"
## [7] "Italy"     "Italy"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Frequencies of countries of residence of female alters.}
\FunctionTok{V}\NormalTok{(gr)[alter.sex}\SpecialCharTok{==}\StringTok{"Female"}\NormalTok{]}\SpecialCharTok{$}\NormalTok{alter.res }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{tabyl}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  V(gr)[alter.sex == "Female"]$alter.res n percent
##                                   Italy 2    0.25
##                               Sri Lanka 6    0.75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View nationality for alter 2833.}
\FunctionTok{V}\NormalTok{(gr)[name}\SpecialCharTok{==}\StringTok{"2833"}\NormalTok{]}\SpecialCharTok{$}\NormalTok{alter.nat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Sri Lanka"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Edit nationality for alter 2833}
\FunctionTok{V}\NormalTok{(gr)[name}\SpecialCharTok{==}\StringTok{"2833"}\NormalTok{]}\SpecialCharTok{$}\NormalTok{alter.nat }\OtherTok{\textless{}{-}} \StringTok{"Italy"}

\CommentTok{\# View all alters who know alter 2833 (vertices that are adjacent to vertex}
\CommentTok{\# "2833").}
\FunctionTok{V}\NormalTok{(gr)[}\FunctionTok{.nei}\NormalTok{(}\StringTok{"2833"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 16/45 vertices, named, from 32a99df:
##  [1] 2814 2815 2821 2822 2823 2824 2825 2826 2832 2834 2835 2837 2838 2839 2843
## [16] 2845
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View the gender of all alters who know alter 2833.}
\FunctionTok{V}\NormalTok{(gr)[}\FunctionTok{.nei}\NormalTok{(}\StringTok{"2833"}\NormalTok{)]}\SpecialCharTok{$}\NormalTok{alter.sex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Male"  
##  [9] "Female" "Male"   "Male"   "Female" "Male"   "Male"   "Male"   "Male"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View all edges that are incident on alter 2833}
\FunctionTok{E}\NormalTok{(gr)[}\FunctionTok{.inc}\NormalTok{(}\StringTok{"2833"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 16/259 edges from 32a99df (vertex names):
##  [1] 2814--2833 2815--2833 2821--2833 2822--2833 2823--2833 2824--2833
##  [7] 2825--2833 2826--2833 2832--2833 2833--2834 2833--2835 2833--2837
## [13] 2833--2838 2833--2839 2833--2843 2833--2845
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View the weight of these edges.}
\FunctionTok{E}\NormalTok{(gr)[}\FunctionTok{.inc}\NormalTok{(}\StringTok{"2833"}\NormalTok{)]}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 2 2 2 1 1 1 2 1 1 1 1 1 1 1 2 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Max weight of any edge that is incident on alter 2833. }
\FunctionTok{E}\NormalTok{(gr)[}\FunctionTok{.inc}\NormalTok{(}\StringTok{"2833"}\NormalTok{)]}\SpecialCharTok{$}\NormalTok{weight }\SpecialCharTok{|\textgreater{}}  
  \FunctionTok{max}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# View all edges with weight==2 (alters who "maybe" know each other).}
\FunctionTok{E}\NormalTok{(gr)[weight}\SpecialCharTok{==}\DecValTok{2}\NormalTok{] }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 24/259 edges from 32a99df (vertex names):
##  [1] 2801--2818 2801--2829 2804--2811 2804--2840 2807--2811 2811--2812
##  [7] 2811--2828 2813--2841 2813--2845 2814--2833 2815--2833 2816--2835
## [13] 2817--2835 2821--2826 2821--2833 2821--2839 2823--2830 2825--2833
## [19] 2827--2828 2830--2835 2831--2840 2833--2843 2834--2843 2840--2844
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Conditions in R indexing can always be combined: view all "maybe" edges}
\CommentTok{\# that are incident on alter 2833.}
\FunctionTok{E}\NormalTok{(gr)[weight}\SpecialCharTok{==}\DecValTok{2} \SpecialCharTok{\&} \FunctionTok{.inc}\NormalTok{(}\StringTok{"2833"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 5/259 edges from 32a99df (vertex names):
## [1] 2814--2833 2815--2833 2821--2833 2825--2833 2833--2843
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ***** EXERCISES}
\CommentTok{\# (1) Get the average alter closeness (vertex attribute $alter.clo) of Sri Lankan}
\CommentTok{\# alters in the personal network gr. Use mean().}
\CommentTok{\#}
\CommentTok{\# (2) How many edges in the personal network gr involve at least one close}
\CommentTok{\# family member and have $weight==2 (the two alters "maybe" know each other)?}
\CommentTok{\# Remember that close family members have $relation=="Close family". Use .inc().}
\CommentTok{\#}
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{composition}{%
\chapter{Ego-network composition}\label{composition}}

\hypertarget{overview-2}{%
\section{Overview}\label{overview-2}}

Ego-network composition refers to the distribution of attributes of alters (for example, age and race/ethnicity) or attributes of ties between alters and the ego (for example, closeness or frequency of contact). For brevity, these are often called simply \emph{alter attributes} in the following text. Recall that, in typical egocentric network data, the level of alters is the same as the level of ego-alter ties: for each alter there is one and only one ego-alter tie, and vice versa. Like in other chapters, we consider composition by first analyzing just one ego-network, then replicating the same type of analysis on many ego-networks at once.

This chapter covers the following topics:

\begin{itemize}
\tightlist
\item
  Calculating measures of composition for one ego-network.
\item
  Representing data from multiple ego-networks as data frames.
\item
  Running the same operation on many ego-networks and combining results back together (split-apply-combine).
\item
  Split-apply-combine on data frames with \texttt{dplyr} to analyze the composition of many ego-networks at once.
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{measures-of-ego-network-composition}{%
\section{Measures of ego-network composition}\label{measures-of-ego-network-composition}}

\begin{itemize}
\tightlist
\item
  Many different measures can be calculated in R to describe ego-network composition.

  \begin{itemize}
  \tightlist
  \item
    The result is typically an ego-level summary variable: one that assigns a number to each ego, with that number describing a characteristic of the ego-network composition for each ego.
  \end{itemize}
\item
  To calculate compositional measures we don't need any network or relational data (data about alter-alter ties), we only need the alter-level attribute dataset (for example, with alter age, gender, ethnicity, frequency of contact, etc.). In other words, we only need, for each ego, a list of alters with their characteristics, and no information about ties between alters.

  \begin{itemize}
  \tightlist
  \item
    So in this section, ego-networks are represented simply by alter-level data frames. We don't need to work with the \texttt{igraph} network objects until we want to analyze ego-network structure (alter-alter ties).
  \end{itemize}
\item
  There are at least three types of compositional measures that we may want to calculate on ego networks. All these measures are calculated for each ego.

  \begin{itemize}
  \tightlist
  \item
    Measures based on \emph{one attribute} of alters. For example, average alter age in the network.
  \item
    Measures based on \emph{multiple attributes} of alters. For example, average frequency of contact (attribute 1) between ego and alters who are family members (attribute 2).
  \item
    Measures of \emph{ego-alter homophily}. These are summary measures of the extent to which alters are similar to the ego who nominated them, with respect to one or more attributes. For example, the proportion of alters who are of the same gender (ethnicity, age bracket) as the ego who nominated them.
  \end{itemize}
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Look at the alter attribute data frame for one ego.
  \item
    Using this data frame, calculate compositional measures based on one alter attribute.
  \item
    Calculate compositional measures based on two alter attributes.
  \item
    Do the level-1 join: join ego attributes into alter-level data.
  \item
    Using the joined data, calculate compositional measures of homophily between ego and alters.
  \item
    Calculate multiple compositional measures and put them together into one ego-level data frame.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load packages.}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(skimr)}
\FunctionTok{library}\NormalTok{(janitor)}
\FunctionTok{library}\NormalTok{(magrittr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'magrittr'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     set_names
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:tidyr':
## 
##     extract
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load data.}
\FunctionTok{load}\NormalTok{(}\StringTok{"./Data/data.rda"}\NormalTok{)}

\CommentTok{\# For compositional measures all we need is the alter attribute data frame.}
\CommentTok{\# The data.rda file loaded above includes the alter attribute data frame for}
\CommentTok{\# ego ID 28.}
\NormalTok{alter.attr}\FloatTok{.28}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 45 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <fct>     <fct>         <fct>        <fct>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 35 more rows
## # i 5 more variables: alter.res <fct>, alter.clo <dbl>, alter.loan <fct>,
## #   alter.fam <fct>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Compositional measures based on a single alter attribute                  {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Summary of continuous variable: Average alter closeness.}

\CommentTok{\# Check out the relevant variable}
\NormalTok{alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.clo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] NA  3 NA NA NA NA  5  4  5  5  5  4  3  5  3  3  1  5  4  5  5  5  5  5  2
## [26]  3  4  5  5  5  5  3  5  3  4  5  5  5  5  3  3  3  3  3  5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Or, in tidyverse syntax}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}} 
  \FunctionTok{pull}\NormalTok{(alter.clo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] NA  3 NA NA NA NA  5  4  5  5  5  4  3  5  3  3  1  5  4  5  5  5  5  5  2
## [26]  3  4  5  5  5  5  3  5  3  4  5  5  5  5  3  3  3  3  3  5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Battery of descriptive stats.}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{skim\_tee}\NormalTok{(alter.clo) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Data Summary ------------------------
##                            Values
## Name                       data  
## Number of rows             45    
## Number of columns          12    
## _______________________          
## Column type frequency:           
##   numeric                  1     
## ________________________         
## Group variables            None  
## 
## -- Variable type: numeric ------------------------------------------------------
##   skim_variable n_missing complete_rate mean   sd p0 p25 p50 p75 p100 hist 
## 1 alter.clo             5         0.889  4.1 1.08  1   3   5   5    5 ‚ñÅ‚ñÅ‚ñÖ‚ñÇ‚ñá
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get a single summary measure (useful when writing functions)}
\FunctionTok{mean}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.clo, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Summary of categorical variable: Proportion female alters.}

\CommentTok{\# Check out the relevant vector}
\NormalTok{alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.sex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] Female Male   Male   Male   Female Female Male   Female Female Male  
## [11] Male   Male   Male   Male   Male   Male   Male   Male   Male   Male  
## [21] Male   Male   Male   Male   Male   Male   Male   Female Male   Male  
## [31] Male   Female Male   Male   Male   Male   Female Male   Male   Male  
## [41] Male   Male   Male   Male   Male  
## Levels: Female Male
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get frequencies}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{tabyl}\NormalTok{(alter.sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  alter.sex  n   percent
##     Female  8 0.1777778
##       Male 37 0.8222222
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same for nationalities}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{tabyl}\NormalTok{(alter.nat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  alter.nat  n    percent
##      Italy  0 0.00000000
##      Other  2 0.04444444
##  Sri Lanka 43 0.95555556
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Another way to get the proportion of a specific category (this is useful when}
\CommentTok{\# writing functions).}
\FunctionTok{mean}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.sex }\SpecialCharTok{==} \StringTok{"Female"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1777778
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.nat }\SpecialCharTok{==} \StringTok{"Sri Lanka"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9555556
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The function dplyr::summarise() allows us to calculate multiple measures, name}
\CommentTok{\# them, and put them together in a data frame.}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{mean.clo =} \FunctionTok{mean}\NormalTok{(alter.clo, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{), }
    \AttributeTok{prop.fem =} \FunctionTok{mean}\NormalTok{(alter.sex}\SpecialCharTok{==}\StringTok{"Female"}\NormalTok{), }
    \AttributeTok{count.nat.slk =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{), }
    \AttributeTok{count.nat.ita =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{), }
    \AttributeTok{count.nat.oth =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Other"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   mean.clo prop.fem count.nat.slk count.nat.ita count.nat.oth
##      <dbl>    <dbl>         <int>         <int>         <int>
## 1      4.1    0.178            43             0             2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# What if we want to calculate the same measures for all ego{-}networks in the data?}
\CommentTok{\# We\textquotesingle{}ll have to use the data frame with all alter attributes from all egos.}
\NormalTok{alter.attr.all}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,590 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <fct>     <fct>         <fct>        <fct>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 4,580 more rows
## # i 5 more variables: alter.res <fct>, alter.clo <dbl>, alter.loan <fct>,
## #   alter.fam <fct>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# dplyr allows us to "group" a data frame by a factor (here, ego IDs) so all}
\CommentTok{\# measures we calculate on that data frame via summarise (means, proportions,}
\CommentTok{\# etc.) are calculated by the groups given by that factor (here, for each ego}
\CommentTok{\# ID).}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{group\_by}\NormalTok{(ego\_ID) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{mean.clo =} \FunctionTok{mean}\NormalTok{(alter.clo, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{), }
    \AttributeTok{prop.fem =} \FunctionTok{mean}\NormalTok{(alter.sex}\SpecialCharTok{==}\StringTok{"Female"}\NormalTok{), }
    \AttributeTok{count.nat.slk =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{), }
    \AttributeTok{count.nat.ita =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{), }
    \AttributeTok{count.nat.oth =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Other"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 6
##    ego_ID mean.clo prop.fem count.nat.slk count.nat.ita count.nat.oth
##     <dbl>    <dbl>    <dbl>         <int>         <int>         <int>
##  1     28     4.1    0.178             43             0             2
##  2     29     4.03   0.0889            44             1             0
##  3     33     3.62   0.378             32             2            11
##  4     35     3.78   0.289             33             4             8
##  5     39     3.73   0.244             39             5             1
##  6     40     3.32   0.356             34             1            10
##  7     45     4.02   0.244             14            19            12
##  8     46     3.48   0.4               33             7             5
##  9     47     4.05   0.267             45             0             0
## 10     48     4.07   0.311             39             4             2
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We\textquotesingle{}ll talk more about this and show more examples in the next sections.}


\CommentTok{\# Compositional measures based on multiple alter attributes                 {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Using indexing we can combine multiple alter attribute variables.}

\CommentTok{\# Mean closeness of alters who are "Friends".}

\CommentTok{\# Check out the relevant vector.}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Friends"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(alter.clo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 5 4 3 5 3 3 5 5 5 5 5 5 4 5 5 5 5 5 4 5 5 5 5 3 3 3 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get its mean.}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Friends"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(alter.clo) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mean}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.444444
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Mean closeness of alters who are "Acquaintances".}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Acquaintances"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(alter.clo) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mean}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Equivalently (useful for writing functions)}
\FunctionTok{mean}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.clo[alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel}\SpecialCharTok{==}\StringTok{"Acquaintances"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Count of close family members who live in Sri Lanka vs those who live in Italy.}

\CommentTok{\# In Sri Lanka.}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(alter.rel }\SpecialCharTok{==} \StringTok{"Close family"}\NormalTok{, alter.res }\SpecialCharTok{==} \StringTok{"Sri Lanka"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{count}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##       n
##   <int>
## 1     5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Equivalently (useful for writing functions)}
\FunctionTok{sum}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel }\SpecialCharTok{==} \StringTok{"Close family"} \SpecialCharTok{\&}\NormalTok{ alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.res }\SpecialCharTok{==} \StringTok{"Sri Lanka"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# In Italy.}
\FunctionTok{sum}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel }\SpecialCharTok{==} \StringTok{"Close family"} \SpecialCharTok{\&}\NormalTok{ alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.res }\SpecialCharTok{==} \StringTok{"Italy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Again, we can put these measures together into a data frame row with dplyr.}
\NormalTok{alter.attr}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{mean.clo.fr =} \FunctionTok{mean}\NormalTok{(alter.clo[alter.rel}\SpecialCharTok{==}\StringTok{"Friends"}\NormalTok{]), }
    \AttributeTok{mean.clo.acq =} \FunctionTok{mean}\NormalTok{(alter.clo[alter.rel}\SpecialCharTok{==}\StringTok{"Acquaintances"}\NormalTok{]),}
    \AttributeTok{count.fam.slk =} \FunctionTok{sum}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Close family"} \SpecialCharTok{\&}\NormalTok{ alter.res}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{),}
    \AttributeTok{count.fam.ita =} \FunctionTok{sum}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Close family"} \SpecialCharTok{\&}\NormalTok{ alter.res}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 4
##   mean.clo.fr mean.clo.acq count.fam.slk count.fam.ita
##         <dbl>        <dbl>         <int>         <int>
## 1        4.44         2.75             5             0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Compositional measures of homophily between ego and alters                {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Level{-}1 join: Bring ego{-}level data into alter{-}level data frame for ego 28.}
\NormalTok{(data}\FloatTok{.28} \OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(alter.attr}\FloatTok{.28}\NormalTok{, ego.df, }\AttributeTok{by=} \StringTok{"ego\_ID"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 45 x 20
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <fct>     <fct>         <fct>        <fct>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 35 more rows
## # i 13 more variables: alter.res <fct>, alter.clo <dbl>, alter.loan <fct>,
## #   alter.fam <fct>, alter.age <dbl>, ego.sex <fct>, ego.age <dbl>,
## #   ego.arr <dbl>, ego.edu <fct>, ego.inc <dbl>, empl <dbl>,
## #   ego.empl.bin <fct>, ego.age.cat <fct>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note the left join: We only retain rows in the left data frame (i.e., alters}
\CommentTok{\# of ego 28), and discard all egos in the right data frame that do not}
\CommentTok{\# correspond to those rows.}

\CommentTok{\# Example: Proportion of alters of the same gender as ego.}

\CommentTok{\# View the relevant data}
\NormalTok{data}\FloatTok{.28} \SpecialCharTok{|\textgreater{}} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(alter\_ID, ego\_ID, alter.sex, ego.sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 45 x 4
##    alter_ID ego_ID alter.sex ego.sex
##       <dbl>  <dbl> <fct>     <fct>  
##  1     2801     28 Female    Male   
##  2     2802     28 Male      Male   
##  3     2803     28 Male      Male   
##  4     2804     28 Male      Male   
##  5     2805     28 Female    Male   
##  6     2806     28 Female    Male   
##  7     2807     28 Male      Male   
##  8     2808     28 Female    Male   
##  9     2809     28 Female    Male   
## 10     2810     28 Male      Male   
## # i 35 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# First create a vector that is TRUE whenever alter has the same sex as ego in }
\CommentTok{\# data.28 (the joined data frame for ego 28).}
\NormalTok{data}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.sex }\SpecialCharTok{==}\NormalTok{ data}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{ego.sex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] FALSE  TRUE  TRUE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE
## [13]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [25]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE
## [37] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The proportion we\textquotesingle{}re looking for is simply the proportion of TRUE\textquotesingle{}s in this}
\CommentTok{\# vector.}
\FunctionTok{mean}\NormalTok{(data}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.sex }\SpecialCharTok{==}\NormalTok{ data}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{ego.sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8222222
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Similarly: count of alters who are in the same age bracket as the ego.}
\FunctionTok{sum}\NormalTok{(data}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.age.cat }\SpecialCharTok{==}\NormalTok{ data}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{ego.age.cat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Again, we can put these measures together into a data frame row with dplyr.}
\NormalTok{data}\FloatTok{.28} \SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{prop.same.gender =} \FunctionTok{mean}\NormalTok{(alter.sex }\SpecialCharTok{==}\NormalTok{ ego.sex), }
    \AttributeTok{count.same.age =} \FunctionTok{sum}\NormalTok{(alter.age.cat }\SpecialCharTok{==}\NormalTok{ ego.age.cat)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   prop.same.gender count.same.age
##              <dbl>          <int>
## 1            0.822              9
\end{verbatim}

\hypertarget{comp-many}{%
\section{Analyzing the composition of many ego-networks}\label{comp-many}}

\hypertarget{split-apply-combine-in-egocentric-network-analysis}{%
\subsection{Split-apply-combine in egocentric network analysis}\label{split-apply-combine-in-egocentric-network-analysis}}

\begin{itemize}
\tightlist
\item
  Now that we've learned how to represent and analyze data on one ego-network, we're ready to scale these operations up to a \emph{collection} of many ego-networks.
\item
  Often in social science data analaysis (or any data analysis), our data are in a single file, dataset or object, and we need to:

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    \emph{Split} the object into pieces based on one or multiple (combinations of) categorical variables or factors.
  \item
    \emph{Apply} exactly the same type of calculation on each piece, identically and independently.
  \item
    \emph{Combine} all results back together, for example into a new dataset.
  \end{enumerate}
\item
  This has been called the \textbf{split-apply-combine} strategy \citep{wickham_split-apply-combine_2011} and is essential in egocentric network analysis. With ego-networks, we are constantly (1) splitting the data into pieces, each piece typically corresponding to one ego; (2) performing identical and independent analyses on each piece (each ego-network); (3) combining the results back together, typically into a single ego-level dataset, to then associate them with other ego-level variables.
\item
  In base and traditional R, common tools to perform split-apply-combine operations include \texttt{for} loops, the \texttt{apply} family of functions, and \texttt{aggregate}.
\item
  The \texttt{tidyverse} packages provide new ways of conducting split-apply-combine operations with more efficient and readable code:

  \begin{itemize}
  \tightlist
  \item
    Grouping and summarizing data frames with the \texttt{dplyr} package. This is particularly relevant to ego-network composition (next \protect\hyperlink{summarize-dplyr}{section}).
  \item
    Applying the same function to all elements in a list with the \texttt{map} family of functions in the \texttt{purrr} package. This is more relevant to ego-network structure (see Section \ref{apply-purrr})
  \end{itemize}
\end{itemize}

\hypertarget{summarize-dplyr}{%
\subsection{\texorpdfstring{Grouping and summarizing with \texttt{dplyr}}{Grouping and summarizing with dplyr}}\label{summarize-dplyr}}

\begin{itemize}
\tightlist
\item
  Whenever we have a dataset in which rows (level 1) are clustered or grouped by values of a given factor (level 2), the package \texttt{dplyr} makes level-2 summarizations very easy.

  \begin{itemize}
  \tightlist
  \item
    In egocentric analysis, we typically have an alter attribute data frame whose rows (alters, level 1) are clustered by egos (level 2).
  \end{itemize}
\item
  In general, the \texttt{dplyr::summarise} function allows us to calculate summary statistics on a single variable or on multiple variables in a data frame.

  \begin{itemize}
  \tightlist
  \item
    To calculate the same summary statistic on multiple variables, we select them with \texttt{across()}.
  \end{itemize}
\item
  If we run \texttt{summarise} after \emph{grouping} the data frame by a factor variable with \texttt{group\_by}, then the data frame will be ``split'' by levels (categories) of that factor, and the summary statistics will be calculated on each piece: that is, for each unique level of the grouping factor.

  \begin{itemize}
  \tightlist
  \item
    So if the grouping factor is the ego ID, we can immediately obtain summary statistics for each of hundreds or thousands of egos in one line of code. The code below provides examples.
  \end{itemize}
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Use \texttt{summarise} to calculate summary variables on network composition for all of the 102 egos at once.
  \item
    Join the results with other ego-level data (level-2 join).
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The summarise function offers a concise syntax to calculate summary }
\CommentTok{\# statistics on a data frame\textquotesingle{}s variables. }

\CommentTok{\# Let\textquotesingle{}s see what happens if we apply this function to the alter attribute data}
\CommentTok{\# frame including all alters, without grouping it by ego ID.}

\CommentTok{\# * Mean alter closeness:}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean.clo =} \FunctionTok{mean}\NormalTok{(alter.clo, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   mean.clo
##      <dbl>
## 1     3.87
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# * N of distinct values in the alter nationality variable (i.e., number of }
\CommentTok{\# distinct nationalities of alters):}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{N.nat =} \FunctionTok{n\_distinct}\NormalTok{(alter.nat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   N.nat
##   <int>
## 1     3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# * N of distinct values in the alter nationality, country of residence, and}
\CommentTok{\# age bracket variables. In this case, we apply the same summarizing function}
\CommentTok{\# to multiple variables (not just one), to be selected via across().}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}
    \FunctionTok{across}\NormalTok{(}\FunctionTok{c}\NormalTok{(alter.nat, alter.res, alter.age.cat), }
\NormalTok{           n\_distinct)}
\NormalTok{    )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##   alter.nat alter.res alter.age.cat
##       <int>     <int>         <int>
## 1         3         3             8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Because we ran this without previously grouping the data frame by ego ID, each}
\CommentTok{\# function is calculated on all alters from all egos pooled (all rows of the}
\CommentTok{\# alter attribute data frame), not on the set of alters of each ego.}

\CommentTok{\# If we group the data frame by ego\_ID, each of those summary statistics is}
\CommentTok{\# calculated for each ego:}

\CommentTok{\# * Mean alter closeness:}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \CommentTok{\# Group by ego ID}
  \FunctionTok{group\_by}\NormalTok{(ego\_ID) }\SpecialCharTok{|\textgreater{}}
  \CommentTok{\# Calculate summary measure}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean.clo =} \FunctionTok{mean}\NormalTok{(alter.clo, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 2
##    ego_ID mean.clo
##     <dbl>    <dbl>
##  1     28     4.1 
##  2     29     4.03
##  3     33     3.62
##  4     35     3.78
##  5     39     3.73
##  6     40     3.32
##  7     45     4.02
##  8     46     3.48
##  9     47     4.05
## 10     48     4.07
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# * N of distinct values in the alter nationality variable (i.e., number of }
\CommentTok{\# distinct nationalities of alters):}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_by}\NormalTok{(ego\_ID) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{N.nat =} \FunctionTok{n\_distinct}\NormalTok{(alter.nat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 2
##    ego_ID N.nat
##     <dbl> <int>
##  1     28     2
##  2     29     2
##  3     33     3
##  4     35     3
##  5     39     3
##  6     40     3
##  7     45     3
##  8     46     3
##  9     47     1
## 10     48     3
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can also "permanently" group the data frame by ego\_ID and then calculate all}
\CommentTok{\# our summary measures by ego ID.}
\NormalTok{alter.attr.all }\SpecialCharTok{\%\textless{}\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ego\_ID)}

\CommentTok{\# * N of distinct values in the alter nationality, country of residence, and}
\CommentTok{\# age bracket variables:}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}
    \FunctionTok{across}\NormalTok{(}\FunctionTok{c}\NormalTok{(alter.nat, alter.res, alter.age.cat), }
\NormalTok{           n\_distinct)}
\NormalTok{    )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 4
##    ego_ID alter.nat alter.res alter.age.cat
##     <dbl>     <int>     <int>         <int>
##  1     28         2         3             7
##  2     29         2         3             7
##  3     33         3         2             6
##  4     35         3         3             7
##  5     39         3         3             7
##  6     40         3         3             6
##  7     45         3         3             8
##  8     46         3         3             7
##  9     47         1         3             6
## 10     48         3         3             7
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can also use summarise to run more complex functions on alter attributes}
\CommentTok{\# by ego.}

\CommentTok{\# Imagine we want to count the number of alters who are "Close family", "Other}
\CommentTok{\# family", and "Friends" in an ego{-}network.}

\CommentTok{\# Let\textquotesingle{}s consider the ego{-}network of ego ID 28 as an example.}
\NormalTok{alter.attr}\FloatTok{.28}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 45 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <fct>     <fct>         <fct>        <fct>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 35 more rows
## # i 5 more variables: alter.res <fct>, alter.clo <dbl>, alter.loan <fct>,
## #   alter.fam <fct>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Calculate the number of alters in each relationship type in this ego{-}network.}

\CommentTok{\# Vector of alter relationship attribute.}
\NormalTok{alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] Close family  Other family  Close family  Close family  Close family 
##  [6] Close family  Other family  Other family  Other family  Other family 
## [11] Friends       Friends       Friends       Friends       Friends      
## [16] Friends       Acquaintances Friends       Acquaintances Friends      
## [21] Friends       Friends       Friends       Friends       Acquaintances
## [26] Acquaintances Friends       Friends       Friends       Friends      
## [31] Friends       Acquaintances Friends       Acquaintances Friends      
## [36] Friends       Friends       Friends       Friends       Friends      
## [41] Friends       Acquaintances Acquaintances Friends       Friends      
## Levels: Acquaintances Close family Friends Other family
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Flag with TRUE whenever alter is "Close family"}
\NormalTok{alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel}\SpecialCharTok{==}\StringTok{"Close family"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Count the number of TRUE\textquotesingle{}s}
\FunctionTok{sum}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel}\SpecialCharTok{==}\StringTok{"Close family"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The same can be done for "Other family" and "Friends"}
\FunctionTok{sum}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel}\SpecialCharTok{==}\StringTok{"Other family"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(alter.attr}\FloatTok{.28}\SpecialCharTok{$}\NormalTok{alter.rel}\SpecialCharTok{==}\StringTok{"Friends"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 27
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# With dplyr we can run the same operations for every ego}
\NormalTok{N.rel }\OtherTok{\textless{}{-}}\NormalTok{ alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{N.clo.fam =} \FunctionTok{sum}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Close family"}\NormalTok{),}
            \AttributeTok{N.oth.fam =} \FunctionTok{sum}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Other family"}\NormalTok{),}
            \AttributeTok{N.fri =} \FunctionTok{sum}\NormalTok{(alter.rel}\SpecialCharTok{==}\StringTok{"Friends"}\NormalTok{))}
\NormalTok{N.rel}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 4
##    ego_ID N.clo.fam N.oth.fam N.fri
##     <dbl>     <int>     <int> <int>
##  1     28         5         5    27
##  2     29         5         6    30
##  3     33         3        16    13
##  4     35         4         1    38
##  5     39         4         9    27
##  6     40         5         7    17
##  7     45         3         6    30
##  8     46         3        14    12
##  9     47         1        20    18
## 10     48         4         6    26
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# After getting compositional summary variables for each ego, we might want to}
\CommentTok{\# join them with other ego{-}level data (level{-}2 join).}

\CommentTok{\# Merge with summary variables.}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{left\_join}\NormalTok{(N.rel, }\AttributeTok{by=} \StringTok{"ego\_ID"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 12
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <fct>     <dbl>   <dbl> <fct>     <dbl> <dbl> <fct>        <fct>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second~    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second~    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second~     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # i 92 more rows
## # i 3 more variables: N.clo.fam <int>, N.oth.fam <int>, N.fri <int>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can then ungroup alter.attr.all by ego ID to remove the grouping information.}
\NormalTok{alter.attr.all }\OtherTok{\textless{}{-}} \FunctionTok{ungroup}\NormalTok{(alter.attr.all)}

\CommentTok{\# To get the size of each personal network, we can simpy use the count() function:}
\CommentTok{\# it counts the number of rows for each unique value of a variable. The}
\CommentTok{\# number of rows for each unique value of ego\_ID in alter.attr.all is the number}
\CommentTok{\# of alters for each ego (personal network size).}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{count}\NormalTok{(ego\_ID)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 2
##    ego_ID     n
##     <dbl> <int>
##  1     28    45
##  2     29    45
##  3     33    45
##  4     35    45
##  5     39    45
##  6     40    45
##  7     45    45
##  8     46    45
##  9     47    45
## 10     48    45
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ***** EXERCISES }
\CommentTok{\#}
\CommentTok{\# (1) Extract the values of alter.attr.all$alter.sex corresponding to ego\_ID 28}
\CommentTok{\# (dplyr::filter). Calculate the proportion of "Female" values. Based on this}
\CommentTok{\# code, use summarise() to calculate the proportion of women in every ego\textquotesingle{}s}
\CommentTok{\# personal network. Hint: mean(alter.sex=="Female").}
\CommentTok{\#}
\CommentTok{\# (2) Subset alter.attr.all to the rows corresponding to ego\_ID 53 (dplyr::filter).}
\CommentTok{\# Using the resulting data frame, calculate the average closeness ($alter.clo)}
\CommentTok{\# of Italian alters (i.e. $alter.nat=="Italy"). Based on this code, run}
\CommentTok{\# summarise() to calculate the average closeness of Italian alters for all egos.}
\CommentTok{\#}
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{structure}{%
\chapter{Ego-network structure}\label{structure}}

\hypertarget{overview-3}{%
\section{Overview}\label{overview-3}}

Ego-network structure refers to the distribution of ties among alters. As usual, we first illustrate analyses on one ego-network, then replicate them on many ego-networks at once.

This chapter covers the following topics:

\begin{itemize}
\tightlist
\item
  Calculating measures of ego-network structure.
\item
  R lists and how they can be used to represent many ego-networks.
\item
  Split-apply-combine on lists with \texttt{purrr} to analyze the structure of many ego-networks at once.
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{measures-of-ego-network-structure}{%
\section{Measures of ego-network structure}\label{measures-of-ego-network-structure}}

\begin{itemize}
\tightlist
\item
  Ego-network structure can be described using different measures, either at the alter level (e.g., alter centrality measures) or at the ego level (e.g., ego-network density).
\item
  Some of these structural measures are calculated on the alter-alter network \emph{excluding} the ego. Other measures (e.g., ego betweenness, constraint) are calculated on the ego-network \emph{including} the ego. We will see examples of both.
\item
  Certain measures combine information about both structure and composition: they are based on data about both the distribution of alter-alter ties and the distribution of alter attributes. An example is the average degree centrality (network structure) of alters who are family members (network composition).
\item
  Note that whenever ego-network structure is considered (whether by itself or in combination with composition), we need data on alter-alter ties. Unlike in Chapter \ref{composition}, just the alter attribute data frame will not be sufficient.

  \begin{itemize}
  \tightlist
  \item
    So in this section we need to work with the \texttt{igraph} objects containing the alter-alter tie information for our ego-networks (and possibly also incorporate alter attribute data frames if our measures are a combination of structure and composition).
  \end{itemize}
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Consider ego-network structural measures based on the distribution of alter-alter ties, with the ego excluded: density, number of components, average alter degree, maximum alter betweenness, number of isolates. Calculate these using \texttt{igraph} functions.
  \item
    Consider structural measures that require the ego to be included in the \texttt{igraph} object: ego betweenness, constraint. Calculate these with \texttt{igraph}.
  \item
    Calculate measures combining ego-network structure and composition: type of relationship between ego and the most between-central alter; average degree centrality of alters who are family members; density of ties among alters in certain categories (e.g., alters who live in Sri Lanka).
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load packages.}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(igraph)}

\CommentTok{\# Load data.}
\FunctionTok{load}\NormalTok{(}\StringTok{"./Data/data.rda"}\NormalTok{)}

\CommentTok{\# For structural measures we need the ego{-}network as an igraph.}

\CommentTok{\# The data.rda file, which we loaded earlier, includes the igraph object of}
\CommentTok{\# ego ID 28\textquotesingle{}s network.}
\NormalTok{gr}\FloatTok{.28}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 32a99df UNW- 45 259 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 32a99df (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s reassign it to a new, generic object name. This makes the code more }
\CommentTok{\# generic and more easily re{-}usable on any ego{-}network igraph object }
\CommentTok{\# (of any ego ID).}
\NormalTok{gr }\OtherTok{\textless{}{-}}\NormalTok{ gr}\FloatTok{.28}

\CommentTok{\# Measures based only on the structure of alter{-}alter ties                  {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Structural characteristics of the network.}

\CommentTok{\# Network density.}
\FunctionTok{edge\_density}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2616162
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Number of components.}
\FunctionTok{components}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $membership
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##    1    1    1    1    1    1    1    1    1    1    1    1    1 
## 
## $csize
## [1] 45
## 
## $no
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This is a list, we only need its 3rd element (number of components).}
\FunctionTok{components}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{no}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Summarization of structural characteristics of the alters.}

\CommentTok{\# Average alter degree.}
\FunctionTok{degree}\NormalTok{(gr) }\SpecialCharTok{|\textgreater{}} \FunctionTok{mean}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11.51111
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Max alter betweenness.}
\FunctionTok{betweenness}\NormalTok{(gr, }\AttributeTok{weights =} \ConstantTok{NA}\NormalTok{) }\SpecialCharTok{|\textgreater{}} \FunctionTok{max}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 257.0168
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Number of "isolate" alters.}

\CommentTok{\# Check out the alter degree vector.}
\FunctionTok{degree}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##   24   17   13   12   12   13   13   12   10    9   11    8   18   14   16    9 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    9   10    2    2    9   18   27   13   10    8    4    3    3    3   15   16 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##   16   12   21    3   10   14   14   16   13    7   12    5   12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Count the number of isolates, i.e. alters with degree==0}
\FunctionTok{sum}\NormalTok{(}\FunctionTok{degree}\NormalTok{(gr)}\SpecialCharTok{==}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# All sorts of more complicated structural analyses can be run on an ego{-}network}
\CommentTok{\# using igraph or statnet functions. For example, here are the results of the}
\CommentTok{\# Girvan{-}Newman community{-}detection algorithm on the ego{-}network.}
\FunctionTok{cluster\_edge\_betweenness}\NormalTok{(gr, }\AttributeTok{weights=} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH clustering edge betweenness, groups: 10, mod: 0.41
## + groups:
##   $`1`
##    [1] "2801" "2802" "2803" "2804" "2805" "2806" "2807" "2808" "2809" "2810"
##   [11] "2811" "2812" "2840" "2841"
##   
##   $`2`
##   [1] "2813" "2814" "2815" "2816" "2817" "2818" "2824" "2831"
##   
##   $`3`
##   [1] "2819" "2836"
##   
##   + ... omitted several groups/vertices
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# What if we want to calculate the same structural measure (e.g. density) on all}
\CommentTok{\# ego{-}networks? We can take the list of all ego{-}networks and run the same }
\CommentTok{\# function on every list element with the purrr package in tidyverse.}

\CommentTok{\# List that contains all our ego{-}networks.}
\FunctionTok{class}\NormalTok{(gr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "list"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(gr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(gr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $`28`
## IGRAPH 32a99df UNW- 45 259 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 32a99df (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
## 
## $`29`
## IGRAPH 6db62c1 UNW- 45 202 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 6db62c1 (vertex names):
##  [1] 2901--2902 2901--2904 2901--2906 2901--2907 2901--2908 2901--2909
##  [7] 2901--2910 2901--2911 2901--2915 2901--2916 2901--2917 2901--2918
## [13] 2901--2919 2901--2927 2901--2928 2901--2929 2901--2930 2901--2931
## [19] 2901--2936 2901--2942 2901--2945 2902--2903 2902--2904 2902--2905
## [25] 2902--2906 2902--2907 2902--2908 2902--2909 2902--2910 2902--2911
## + ... omitted several edges
## 
## $`33`
## IGRAPH 5331804 UNW- 45 207 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 5331804 (vertex names):
##  [1] 3301--3302 3301--3303 3301--3304 3301--3305 3301--3306 3301--3307
##  [7] 3301--3308 3301--3309 3301--3310 3301--3311 3301--3312 3301--3313
## [13] 3301--3314 3301--3315 3301--3316 3301--3317 3301--3318 3301--3319
## [19] 3301--3320 3301--3321 3301--3322 3301--3323 3302--3303 3302--3304
## [25] 3302--3305 3302--3306 3302--3307 3302--3308 3302--3309 3302--3310
## + ... omitted several edges
## 
## $`35`
## IGRAPH 4e7492a UNW- 45 221 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 4e7492a (vertex names):
##  [1] 3501--3502 3501--3503 3501--3504 3501--3505 3501--3506 3501--3507
##  [7] 3501--3508 3501--3509 3501--3510 3501--3512 3501--3513 3501--3514
## [13] 3501--3516 3501--3517 3501--3522 3501--3523 3501--3524 3501--3525
## [19] 3501--3526 3501--3527 3501--3528 3501--3529 3501--3530 3501--3532
## [25] 3501--3533 3501--3534 3501--3535 3501--3536 3501--3540 3501--3543
## + ... omitted several edges
## 
## $`39`
## IGRAPH ad523ff UNW- 45 92 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from ad523ff (vertex names):
##  [1] 3901--3902 3901--3903 3901--3904 3901--3905 3901--3906 3901--3907
##  [7] 3901--3911 3901--3913 3901--3920 3901--3924 3901--3925 3901--3931
## [13] 3901--3932 3901--3933 3901--3937 3901--3938 3901--3940 3901--3941
## [19] 3902--3903 3902--3904 3902--3905 3902--3906 3902--3907 3902--3908
## [25] 3902--3909 3902--3910 3902--3913 3902--3924 3902--3925 3902--3931
## + ... omitted several edges
## 
## $`40`
## IGRAPH 5464b4d UNW- 45 255 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 5464b4d (vertex names):
##  [1] 4001--4003 4001--4007 4001--4008 4001--4009 4001--4036 4001--4040
##  [7] 4001--4045 4002--4003 4002--4004 4002--4006 4002--4008 4002--4009
## [13] 4002--4010 4002--4011 4002--4012 4002--4013 4002--4014 4002--4015
## [19] 4002--4016 4002--4017 4002--4021 4002--4029 4002--4036 4002--4037
## [25] 4002--4038 4002--4040 4002--4041 4002--4042 4002--4043 4002--4044
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can use purrr::map() to run the same function on every element of the list.}
\NormalTok{purrr}\SpecialCharTok{::}\FunctionTok{map\_dbl}\NormalTok{(gr.list, edge\_density)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         28         29         33         35         39         40         45 
## 0.26161616 0.20404040 0.20909091 0.22323232 0.09292929 0.25757576 0.18484848 
##         46         47         48         49         51         52         53 
## 0.26969697 0.53737374 0.20303030 0.42828283 0.16969697 0.12929293 0.16565657 
##         55         56         57         58         59         60         61 
## 0.23838384 0.22828283 0.60000000 0.20505051 0.50505051 0.28888889 0.37676768 
##         62         64         65         66         68         69         71 
## 0.30202020 0.28282828 0.36060606 0.30909091 0.23333333 0.23636364 0.47777778 
##         73         74         78         79         80         81         82 
## 0.40707071 0.42525253 0.17575758 0.29292929 0.33434343 0.29797980 0.35353535 
##         83         84         85         86         87         88         90 
## 0.38888889 0.27575758 0.12525253 0.18989899 0.24444444 0.40101010 0.45353535 
##         91         92         93         94         95         97         99 
## 0.47171717 0.43535354 0.14141414 0.26767677 0.36767677 0.35050505 0.24040404 
##        102        104        105        107        108        109        110 
## 0.27777778 0.22929293 0.26666667 0.16262626 0.10606061 0.33535354 0.48686869 
##        112        113        114        115        116        118        119 
## 0.13939394 0.23636364 0.28787879 0.33232323 0.22929293 0.37676768 0.33131313 
##        120        121        122        123        124        125        126 
## 0.20101010 0.23838384 0.35959596 0.39090909 0.61111111 0.26464646 0.72828283 
##        127        128        129        130        131        132        133 
## 0.28080808 0.26262626 0.22727273 0.22020202 0.27979798 0.29090909 0.27575758 
##        135        136        138        139        140        141        142 
## 0.22525253 0.28686869 0.19797980 0.31515152 0.29292929 0.26868687 0.21010101 
##        144        146        147        149        151        152        153 
## 0.24949495 0.14747475 0.23030303 0.20707071 0.27272727 0.25151515 0.34242424 
##        154        155        156        157        158        159        160 
## 0.31818182 0.39393939 0.24646465 0.37777778 0.23737374 0.37979798 0.36767677 
##        161        162        163        164 
## 0.41010101 0.41111111 0.35454545 0.32222222
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We\textquotesingle{}ll talk more about this and show more examples in the section about }
\CommentTok{\# multiple ego{-}networks.}

\CommentTok{\# Structural measures requiring ego in the network                          {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# We now need the ego{-}network with ego included. The file data.rda, loaded earlier,}
\CommentTok{\# includes this ego{-}network for ego ID 28. }
\NormalTok{gr.ego}\FloatTok{.28}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 3e551cc UNW- 46 304 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 3e551cc (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s reassign it to another, generic object name.}
\NormalTok{gr.ego }\OtherTok{\textless{}{-}}\NormalTok{ gr.ego}\FloatTok{.28}

\CommentTok{\# Ego\textquotesingle{}s betweenness centrality.}
\CommentTok{\# weights = NA so the function doesn\textquotesingle{}t use the $weight edge attribute to}
\CommentTok{\# calculate weighted betweenness.}
\FunctionTok{betweenness}\NormalTok{(gr.ego, }\AttributeTok{v =} \StringTok{"ego"}\NormalTok{, }\AttributeTok{weights =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      ego 
## 434.0271
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Ego\textquotesingle{}s constraint.}
\FunctionTok{constraint}\NormalTok{(gr.ego, }\AttributeTok{nodes=} \StringTok{"ego"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ego 
##  NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Measures combining composition and structure: From structure to composition {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Non{-}network attribute of alters selected based on structural characteristics.}

\CommentTok{\# Type of relationship with alter with max betweenness.}

\CommentTok{\# Logical index for alter with max betweenness.}
\NormalTok{ind }\OtherTok{\textless{}{-}} \FunctionTok{betweenness}\NormalTok{(gr, }\AttributeTok{weights =} \ConstantTok{NA}\NormalTok{) }\SpecialCharTok{==} \FunctionTok{max}\NormalTok{(}\FunctionTok{betweenness}\NormalTok{(gr, }\AttributeTok{weights =} \ConstantTok{NA}\NormalTok{))}

\CommentTok{\# Get that alter.}
\FunctionTok{V}\NormalTok{(gr)[ind]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 1/45 vertex, named, from 32a99df:
## [1] 2801
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get type of relation of that alter.}
\FunctionTok{V}\NormalTok{(gr)[ind]}\SpecialCharTok{$}\NormalTok{alter.rel}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Close family"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that there might be multiple alters with the same (maximum) value of }
\CommentTok{\# betweenness. For that case, we\textquotesingle{}ll need more complicated code (see exercise).}

\CommentTok{\# Measures combining composition and structure: From composition to structure {-}{-}{-}{-}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Structural characteristics of alters selected based on composition.}

\CommentTok{\# Average degree of Close family.}

\CommentTok{\# Vertex sequence of Close family members.}
\NormalTok{(clo.fam.vs }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.rel}\SpecialCharTok{==}\StringTok{"Close family"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 5/45 vertices, named, from 32a99df:
## [1] 2801 2803 2804 2805 2806
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get their average degree.}
\NormalTok{gr }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{degree}\NormalTok{(}\AttributeTok{v =}\NormalTok{ clo.fam.vs) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mean}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 14.8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Count of ties between alters who live in Sri Lanka.}

\CommentTok{\# First get the vertex sequence of alters who live in Sri Lanka.}
\NormalTok{(alters.sl }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.res}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 17/45 vertices, named, from 32a99df:
##  [1] 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2827 2828 2829
## [16] 2840 2841
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Then get the edges among them.}
\FunctionTok{E}\NormalTok{(gr)[alters.sl }\SpecialCharTok{\%{-}{-}\%}\NormalTok{ alters.sl]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 88/259 edges from 32a99df (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2827
## [13] 2801--2828 2801--2829 2801--2840 2801--2841 2802--2803 2802--2804
## [19] 2802--2805 2802--2806 2802--2807 2802--2808 2802--2809 2802--2810
## [25] 2802--2811 2802--2812 2802--2840 2802--2841 2803--2804 2803--2805
## [31] 2803--2806 2803--2807 2803--2808 2803--2809 2803--2810 2803--2811
## [37] 2803--2812 2803--2840 2803--2841 2804--2805 2804--2806 2804--2807
## [43] 2804--2808 2804--2809 2804--2810 2804--2811 2804--2840 2804--2841
## [49] 2805--2806 2805--2807 2805--2808 2805--2809 2805--2810 2805--2811
## [55] 2805--2840 2805--2841 2806--2807 2806--2808 2806--2809 2806--2810
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# How many edges are there between alters who live in Sri Lanka?}
\FunctionTok{E}\NormalTok{(gr)[alters.sl }\SpecialCharTok{\%{-}{-}\%}\NormalTok{ alters.sl] }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{length}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 88
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Density between alters who live in Sri Lanka.}

\CommentTok{\# Get subgraph of relevant alters}
\FunctionTok{induced\_subgraph}\NormalTok{(gr, }\AttributeTok{vids =}\NormalTok{ alters.sl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 3ccb605 UNW- 17 88 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from 3ccb605 (vertex names):
##  [1] 2801--2802 2801--2803 2802--2803 2801--2804 2802--2804 2803--2804
##  [7] 2801--2805 2802--2805 2803--2805 2804--2805 2801--2806 2802--2806
## [13] 2803--2806 2804--2806 2805--2806 2801--2807 2802--2807 2803--2807
## [19] 2804--2807 2805--2807 2806--2807 2801--2808 2802--2808 2803--2808
## [25] 2804--2808 2805--2808 2806--2808 2807--2808 2801--2809 2802--2809
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get the density of this subgraph.}
\FunctionTok{induced\_subgraph}\NormalTok{(gr, }\AttributeTok{vids =}\NormalTok{ alters.sl) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{edge\_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6470588
\end{verbatim}

\hypertarget{lists}{%
\section{R lists}\label{lists}}

\begin{itemize}
\tightlist
\item
  A lists is simply a \textbf{collection} of objects. It can contain any kind of object, with no restriction. A list can contain other lists.
\item
  Lists have \texttt{list} as \texttt{type} \emph{and} \texttt{class}.
\item
  Data frames are a type of list. Other complex objects in R are also \emph{stored} as lists (have \texttt{list} as \texttt{type}), although their \texttt{class} is not \texttt{list}: for example, results from statistical estimations or network community detection procedures.
\item
  Use \texttt{str(list)} to display the types and lengths of elements in a list.
\item
  List may be \emph{named}, that is, have element names. You can view or assign names with the \texttt{names} function (base R) or the \texttt{set\_names} function (tidyverse).
\item
  \textbf{Three different notations to index lists}:

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    \texttt{{[}\ {]}} notation, e.g.~\texttt{my.list{[}3{]}}.
  \item
    \texttt{{[}{[}\ {]}{]}} notation, e.g.~\texttt{my.list{[}{[}3{]}{]}} or \texttt{my.list{[}{[}"element.name"{]}{]}}.
  \item
    The \texttt{\$} notation. This only works for named lists. E.g., \texttt{list\$element.name}. This is the same as the \texttt{{[}{[}\ {]}{]}} notation: \texttt{list\$element.name} is the same as \texttt{list{[}{[}"element.name"{]}{]}} or \texttt{list{[}{[}i{]}{]}} (where \texttt{i} is the position of the element called \emph{element.name} in the list).
  \end{enumerate}
\item
  These three indexing methods work in exactly the same way as for data frames (see Section \ref{index-df}).
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Create, display, and index a list.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s get some objects to put in a list.}

\CommentTok{\# A simple numeric vector.}
\NormalTok{(num }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A matrix.}
\NormalTok{(mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\AttributeTok{nrow=}\DecValTok{2}\NormalTok{, }\AttributeTok{ncol=}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A character vector.}
\NormalTok{(char }\OtherTok{\textless{}{-}} \FunctionTok{colors}\NormalTok{()[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "white"         "aliceblue"     "antiquewhite"  "antiquewhite1"
## [5] "antiquewhite2"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a list that contains all these objects.}
\NormalTok{L }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(num, mat, char)}

\CommentTok{\# Display it}
\NormalTok{L}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## [[2]]
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
## 
## [[3]]
## [1] "white"         "aliceblue"     "antiquewhite"  "antiquewhite1"
## [5] "antiquewhite2"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a named list}
\NormalTok{L }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{numbers=}\NormalTok{ num, }\AttributeTok{matrix=}\NormalTok{ mat, }\AttributeTok{colors=}\NormalTok{ char)  }

\CommentTok{\# Display it}
\NormalTok{L}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $numbers
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $matrix
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
## 
## $colors
## [1] "white"         "aliceblue"     "antiquewhite"  "antiquewhite1"
## [5] "antiquewhite2"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Type and class}
\FunctionTok{typeof}\NormalTok{(L)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "list"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(L)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "list"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Extract the first element of L}
\CommentTok{\# [ ] notation (result is a list containing the element).}
\NormalTok{L[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $numbers
##  [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# [[ ]] notation (result is the element itself, no longer in a list).}
\NormalTok{L[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# $ notation (result is the element itself, no longer in a list).}
\NormalTok{L}\SpecialCharTok{$}\NormalTok{numbers}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Name indexing.}
\NormalTok{L[[}\StringTok{"numbers"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Types of elements in L.}
\FunctionTok{str}\NormalTok{(L)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 3
##  $ numbers: int [1:10] 1 2 3 4 5 6 7 8 9 10
##  $ matrix : int [1:2, 1:2] 1 2 3 4
##  $ colors : chr [1:5] "white" "aliceblue" "antiquewhite" "antiquewhite1" ...
\end{verbatim}

\hypertarget{apply-purrr}{%
\section{Analyzing the structure of many ego-networks}\label{apply-purrr}}

\begin{itemize}
\tightlist
\item
  In base R, functions of the \texttt{apply} family, such as \texttt{lapply} and \texttt{sapply}, are the traditional way to take a function and apply it to every element of a list. In tidyverse, the \texttt{purrr} package does the same thing but in more efficient ways and with more readable code.
\item
  We use \texttt{purrr} to apply the same function to each element of a list of ego-networks, that is, to each ego-network. Depending on the function, the result for each ego-network may be a single number or a more complex object (for example, a data frame).
\item
  \texttt{purrr} provides type-stable functions, which always return the same type of output:

  \begin{itemize}
  \tightlist
  \item
    \texttt{map} always returns a list. (This is the equivalent of \texttt{lapply} in base R).
  \item
    \texttt{map\_dbl} always returns a vector of double-precision numbers. \texttt{map\_int} returns a vector of integer numbers. \texttt{map\_chr} returns a character vector. \texttt{map\_lgl} returns a logical vector.
  \item
    \texttt{map\_dfr} returns a data frame. It assumes that you are applying an operation to each list element, which returns one data frame row for that element. It then binds together the data frame rows obtained for each element, combining them into a single data frame.
  \end{itemize}
\item
  In addition to type-stable output, the \texttt{map} functions also offer a convenient formula syntax: \texttt{\textasciitilde{}\ f(.x)}, where: (1) \texttt{.x} represents each element of the input list; (2) \texttt{f} is the function to be executed on that element.

  \begin{itemize}
  \tightlist
  \item
    For example, \texttt{map(L,\ \textasciitilde{}\ .x\ *\ 2)} takes each element of the list \texttt{L} (represented by \texttt{.x}) and multiplies it times 2.
  \end{itemize}
\item
  The \texttt{map} functions preserve list names in their output. If we have a list of ego-networks whose names are the ego IDs, this means that ego IDs will be preserved in result lists and vectors.
\item
  \texttt{map} is also useful when you want to run functions that take a list element as argument (e.g.~an \texttt{igraph} ego-network), and return another list element as output (e.g.~another \texttt{igraph} object). This is the case whenever you want to manipulate the ego-networks (for example, only keep a certain type of ties or vertices in the networks) and store the results in a new list.
\item
  \texttt{map\_dbl} is useful when you want to run functions that take a list element as argument (e.g.~an \texttt{igraph} ego-network), and return a number as output. This is the case whenever you want to run a structural measure such as tie density or centralization on each network.
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Use \texttt{purrr} functions to calculate the same structural measures on every ego-network in the data.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A simple structural measure such as network density can be applied to every}
\CommentTok{\# ego{-}network (i.e., every element of our list), and returns a scalar for each}
\CommentTok{\# network. All the scalars can be put in a vector.}
\NormalTok{gr.list }\SpecialCharTok{|\textgreater{}}
\NormalTok{  purrr}\SpecialCharTok{::}\FunctionTok{map\_dbl}\NormalTok{(edge\_density) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         28         29         33         35         39         40         45 
## 0.26161616 0.20404040 0.20909091 0.22323232 0.09292929 0.25757576 0.18484848 
##         46         47         48         49         51         52         53 
## 0.26969697 0.53737374 0.20303030 0.42828283 0.16969697 0.12929293 0.16565657 
##         55         56         57         58         59         60         61 
## 0.23838384 0.22828283 0.60000000 0.20505051 0.50505051 0.28888889 0.37676768 
##         62         64         65         66         68         69         71 
## 0.30202020 0.28282828 0.36060606 0.30909091 0.23333333 0.23636364 0.47777778 
##         73         74         78         79         80         81         82 
## 0.40707071 0.42525253 0.17575758 0.29292929 0.33434343 0.29797980 0.35353535 
##         83         84         85         86         87         88         90 
## 0.38888889 0.27575758 0.12525253 0.18989899 0.24444444 0.40101010 0.45353535 
##         91         92         93         94         95         97         99 
## 0.47171717 0.43535354 0.14141414 0.26767677 0.36767677 0.35050505 0.24040404 
##        102        104        105        107        108        109        110 
## 0.27777778 0.22929293 0.26666667 0.16262626 0.10606061 0.33535354 0.48686869 
##        112        113        114        115        116        118        119 
## 0.13939394 0.23636364 0.28787879 0.33232323 0.22929293 0.37676768 0.33131313 
##        120        121        122        123        124        125        126 
## 0.20101010 0.23838384 0.35959596 0.39090909 0.61111111 0.26464646 0.72828283 
##        127        128        129        130        131        132        133 
## 0.28080808 0.26262626 0.22727273 0.22020202 0.27979798 0.29090909 0.27575758 
##        135        136        138        139        140        141        142 
## 0.22525253 0.28686869 0.19797980 0.31515152 0.29292929 0.26868687 0.21010101 
##        144        146        147        149        151        152        153 
## 0.24949495 0.14747475 0.23030303 0.20707071 0.27272727 0.25151515 0.34242424 
##        154        155        156        157        158        159        160 
## 0.31818182 0.39393939 0.24646465 0.37777778 0.23737374 0.37979798 0.36767677 
##        161        162        163        164 
## 0.41010101 0.41111111 0.35454545 0.32222222
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that the vector names (taken from gr.list names) are the ego IDs.}

\CommentTok{\# If you want the same result as a nice data frame with ego IDs, use enframe().}
\NormalTok{gr.list }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{map\_dbl}\NormalTok{(edge\_density) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{enframe}\NormalTok{(}\AttributeTok{name =} \StringTok{"ego\_ID"}\NormalTok{, }\AttributeTok{value =} \StringTok{"density"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 2
##    ego_ID density
##    <chr>    <dbl>
##  1 28      0.262 
##  2 29      0.204 
##  3 33      0.209 
##  4 35      0.223 
##  5 39      0.0929
##  6 40      0.258 
##  7 45      0.185 
##  8 46      0.270 
##  9 47      0.537 
## 10 48      0.203 
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same thing, with number of components in each ego network. Note the \textasciitilde{} .x }
\CommentTok{\# syntax}
\NormalTok{gr.list }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{map\_dbl}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{components}\NormalTok{(.x)}\SpecialCharTok{$}\NormalTok{no) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{enframe}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 2
##    name  value
##    <chr> <dbl>
##  1 28        1
##  2 29        4
##  3 33        7
##  4 35        2
##  5 39       20
##  6 40        2
##  7 45        1
##  8 46        2
##  9 47        1
## 10 48        1
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# With map\_dfr() we can calculate multiple structural measures at once on every }
\CommentTok{\# ego{-}network, and return the results as a single ego{-}level data frame.}

\CommentTok{\# This assumes that we are applying an operation that returns one data frame row}
\CommentTok{\# for each ego{-}network. For example, take one ego{-}network from our list.}
\NormalTok{gr }\OtherTok{\textless{}{-}}\NormalTok{ gr.list[[}\DecValTok{10}\NormalTok{]]}

\CommentTok{\# Apply an operation to that ego{-}network, which returns one data frame row.}
\FunctionTok{tibble}\NormalTok{(}\AttributeTok{dens =} \FunctionTok{edge\_density}\NormalTok{(gr),}
       \AttributeTok{mean.deg =} \FunctionTok{mean}\NormalTok{(igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(gr)),}
       \AttributeTok{mean.bet =} \FunctionTok{mean}\NormalTok{(igraph}\SpecialCharTok{::}\FunctionTok{betweenness}\NormalTok{(gr, }\AttributeTok{weights =} \ConstantTok{NA}\NormalTok{)),}
       \AttributeTok{deg.centr =} \FunctionTok{centr\_degree}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{centralization)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 4
##    dens mean.deg mean.bet deg.centr
##   <dbl>    <dbl>    <dbl>     <dbl>
## 1 0.203     8.93     33.8     0.365
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Now we can do the same thing but for all ego{-}networks at once. The result is a }
\CommentTok{\# single ego{-}level data frame, with one row for each ego. }
\CommentTok{\# Note the .id argument in map\_dfr().}
\NormalTok{gr.list }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{map\_dfr}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{dens=} \FunctionTok{edge\_density}\NormalTok{(.x),}
                   \AttributeTok{mean.deg=} \FunctionTok{mean}\NormalTok{(igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(.x)),}
                   \AttributeTok{mean.bet=} \FunctionTok{mean}\NormalTok{(igraph}\SpecialCharTok{::}\FunctionTok{betweenness}\NormalTok{(.x, }\AttributeTok{weights =} \ConstantTok{NA}\NormalTok{)),}
                   \AttributeTok{deg.centr=} \FunctionTok{centr\_degree}\NormalTok{(.x)}\SpecialCharTok{$}\NormalTok{centralization),}
          \AttributeTok{.id =} \StringTok{"ego\_ID"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 5
##    ego_ID   dens mean.deg mean.bet deg.centr
##    <chr>   <dbl>    <dbl>    <dbl>     <dbl>
##  1 28     0.262     11.5     22.9      0.352
##  2 29     0.204      8.98    23.9      0.273
##  3 33     0.209      9.2      4.56     0.291
##  4 35     0.223      9.82    22.0      0.481
##  5 39     0.0929     4.09     7.18     0.316
##  6 40     0.258     11.3     21.3      0.492
##  7 45     0.185      8.13    20.6      0.679
##  8 46     0.270     11.9     19.6      0.503
##  9 47     0.537     23.6     10.5      0.372
## 10 48     0.203      8.93    33.8      0.365
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ***** EXERCISES}
\CommentTok{\#}
\CommentTok{\# (1) Get the graph for ego ID 28 from gr.list. Get the max betweenness of}
\CommentTok{\# Italian alters on this graph. Based on this code, use map() to get the same}
\CommentTok{\# measure that for all egos.}
\CommentTok{\#}
\CommentTok{\# (2) Given a personal network gr, the subgraph of close family in the personal}
\CommentTok{\# network is induced\_subgraph(gr, V(gr)[alter.rel=="Close family"]). Use}
\CommentTok{\# purrr::map() to get the family subgraph for every personal network in gr.list,}
\CommentTok{\# and put the results in a new list called gr.list.family. Use the formula}
\CommentTok{\# notation (\textasciitilde{} .x).}
\CommentTok{\#}
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{multilevel}{%
\chapter{Multilevel modeling of ego-network data}\label{multilevel}}

In progress.

\hypertarget{resources}{%
\section{Resources}\label{resources}}

\hypertarget{multilevel-models-for-egocentric-network-data}{%
\subsection{Multilevel models for egocentric network data}\label{multilevel-models-for-egocentric-network-data}}

Specific resources on multilevel modeling of egocentric/personal network data:

\begin{itemize}
\tightlist
\item
  \href{https://www.sa-ijas.org/ojs/index.php/sa-ijas/article/view/30-3}{\citet{vacca_multilevel_2018}}: overview of multilevel modeling for egocentric/personal network data, with R demo (the code below is drawn in part from this article).
\item
  \citet{simonoff_multilevel_2013}: overview of multilevel modeling for egocentric and sociocentric data.
\item
  \href{http://journals.sagepub.com/doi/10.1177/0049124119882450}{\citet{vacca_cross-classified_2019}}: multilevel models for overlapping egocentric networks.
\item
  \citet{mccarty_conducting_2019}: Ch. 13.
\item
  \citet{perry_egocentric_2018}: Ch. 8.
\item
  \citet{crossley_social_2015}: Ch. 6.
\end{itemize}

\hypertarget{multilevel-modeling-in-general}{%
\subsection{Multilevel modeling in general}\label{multilevel-modeling-in-general}}

General resources on multilevel models:

\begin{itemize}
\tightlist
\item
  \href{https://www.cmm.bris.ac.uk/lemma}{\citet{rasbash_lemma:_2008}}: Extensive online course on multilevel modeling for the social sciences, including Stata and R implementation.
\item
  \citet{snijders_multilevel_2012}: mode in-depth statistical treatment, social science focus.
\item
  \citet{goldstein_multilevel_2010}
\item
  \citet{fox_r_2018}: Ch. 7, R implementation with \texttt{lme4}.
\item
  \href{http://bbolker.github.io/mixedmodels-misc/glmmFAQ.html}{GLMM FAQ} by Ben Bolker and others: online list of R packages and resources on linear and generalized linear mixed models.
\end{itemize}

\hypertarget{prepare-the-data}{%
\section{Prepare the data}\label{prepare-the-data}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load packages.}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(lme4)}
\FunctionTok{library}\NormalTok{(car)}
\FunctionTok{library}\NormalTok{(magrittr)}
\FunctionTok{library}\NormalTok{(skimr)}
\FunctionTok{library}\NormalTok{(janitor)}
\FunctionTok{library}\NormalTok{(broom.mixed)}

\CommentTok{\# Clear the workspace from all previous objects}
\FunctionTok{rm}\NormalTok{(}\AttributeTok{list=}\FunctionTok{ls}\NormalTok{())}

\CommentTok{\# Load the data}
\FunctionTok{load}\NormalTok{(}\StringTok{"./Data/data.rda"}\NormalTok{)}

\CommentTok{\# Create data frame object for models (level{-}1 join)}
\NormalTok{(model.data }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(alter.attr.all, ego.df, }\AttributeTok{by=} \StringTok{"ego\_ID"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,590 x 20
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <fct>     <fct>         <fct>        <fct>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 4,580 more rows
## # i 13 more variables: alter.res <fct>, alter.clo <dbl>, alter.loan <fct>,
## #   alter.fam <fct>, alter.age <dbl>, ego.sex <fct>, ego.age <dbl>,
## #   ego.arr <dbl>, ego.edu <fct>, ego.inc <dbl>, empl <dbl>,
## #   ego.empl.bin <fct>, ego.age.cat <fct>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Create variables to be used in multilevel models                         ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Ego{-}alter age homophily variable}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# (TRUE if alter and ego are in the same age bracket)}
\NormalTok{model.data }\OtherTok{\textless{}{-}}\NormalTok{ model.data }\SpecialCharTok{|\textgreater{}}  
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{alter.same.age =}\NormalTok{ (alter.age.cat}\SpecialCharTok{==}\NormalTok{ego.age.cat))  }

\CommentTok{\# See result}
\FunctionTok{tabyl}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{alter.same.age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  model.data$alter.same.age    n    percent valid_percent
##                      FALSE 3228 0.70326797     0.7113266
##                       TRUE 1310 0.28540305     0.2886734
##                         NA   52 0.01132898            NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Recode: TRUE = Yes, FALSE = No}
\NormalTok{model.data }\OtherTok{\textless{}{-}}\NormalTok{ model.data }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{alter.same.age =} \FunctionTok{as.character}\NormalTok{(alter.same.age),}
         \AttributeTok{alter.same.age =} \FunctionTok{fct\_recode}\NormalTok{(alter.same.age,}
                                     \AttributeTok{Yes =} \StringTok{"TRUE"}\NormalTok{, }\AttributeTok{No =} \StringTok{"FALSE"}\NormalTok{))}

\CommentTok{\# See result}
\FunctionTok{tabyl}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{alter.same.age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  model.data$alter.same.age    n    percent valid_percent
##                         No 3228 0.70326797     0.7113266
##                        Yes 1310 0.28540305     0.2886734
##                       <NA>   52 0.01132898            NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Centered/rescaled versions of ego and alter age }
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# This is done for easier interpretation of model coefficients}
\NormalTok{model.data }\OtherTok{\textless{}{-}}\NormalTok{ model.data }\SpecialCharTok{|\textgreater{}} 
  \CommentTok{\# Ego age centered around its mean and scaled by 5 (1 unit = 5 years)}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ego.age.cen =} \FunctionTok{scale}\NormalTok{(ego.age, }\AttributeTok{scale=} \DecValTok{5}\NormalTok{),}
         \CommentTok{\# Alter age category centered around its mean}
         \AttributeTok{alter.age.cat.cen =} \FunctionTok{scale}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(alter.age.cat), }\AttributeTok{scale=} \ConstantTok{FALSE}\NormalTok{))}

\CommentTok{\# Count of family members in ego{-}network}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\NormalTok{model.data }\OtherTok{\textless{}{-}}\NormalTok{ model.data }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{group\_by}\NormalTok{(ego\_ID) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{net.count.fam =} \FunctionTok{sum}\NormalTok{(alter.fam}\SpecialCharTok{==}\StringTok{"Yes"}\NormalTok{, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ungroup}\NormalTok{()}

\CommentTok{\# Center and rescale by 5 (+1 unit = 5 more family members in ego{-}network)}
\NormalTok{model.data }\OtherTok{\textless{}{-}}\NormalTok{ model.data }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{net.count.fam.cen =} \FunctionTok{scale}\NormalTok{(net.count.fam, }\AttributeTok{scale=}\DecValTok{5}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\hypertarget{random-intercept-models}{%
\section{Random intercept models}\label{random-intercept-models}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# m1: Variance components models                                           ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Variance components model: level 1 is ties, level 2 is egos, random intercept, }
\CommentTok{\# no predictor}
\NormalTok{m1 }\OtherTok{\textless{}{-}} \FunctionTok{glmer}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}} \CommentTok{\# Dependent variable}
\NormalTok{              (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ ego\_ID), }\CommentTok{\# Intercept (1) varies in level{-}2 units (ego\_ID)}
            \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\CommentTok{\# Model class (logistic)}
            \AttributeTok{data =}\NormalTok{ model.data) }\CommentTok{\# Data object}

\CommentTok{\# View results}
\NormalTok{car}\SpecialCharTok{::}\FunctionTok{S}\NormalTok{(m1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Generalized linear mixed model fit by ML
## Call: glmer(formula = alter.loan ~ (1 | ego_ID), data = model.data, family =
##             binomial("logit"))
## 
## Estimates of Fixed Effects:
##             Estimate Std. Error z value Pr(>|z|)
## (Intercept)  0.05376    0.09609   0.559    0.576
## 
## Exponentiated Fixed Effects and Confidence Bounds:
##             Estimate     2.5 %   97.5 %
## (Intercept) 1.055234 0.8740859 1.273925
## 
## Estimates of Random Effects (Covariance Components):
##  Groups Name        Std.Dev.
##  ego_ID (Intercept) 0.9001  
## 
## Number of obs: 4021, groups:  ego_ID, 101
## 
##   logLik       df      AIC      BIC 
## -2577.23        2  5158.46  5171.06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# m2: Add tie characteristics as predictors (level 1)                      ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Add alter.fam and alter.same.age as predictors}

\CommentTok{\# See descriptives for the new predictors}
\FunctionTok{tabyl}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{alter.fam)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  model.data$alter.fam    n   percent
##                    No 3202 0.6976035
##                   Yes 1388 0.3023965
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabyl}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{alter.same.age)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  model.data$alter.same.age    n    percent valid_percent
##                         No 3228 0.70326797     0.7113266
##                        Yes 1310 0.28540305     0.2886734
##                       <NA>   52 0.01132898            NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Estimate the model and view results}
\NormalTok{m2 }\OtherTok{\textless{}{-}} \FunctionTok{glmer}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}} \CommentTok{\# Dependent variable}
\NormalTok{              alter.fam }\SpecialCharTok{+}\NormalTok{ alter.same.age }\SpecialCharTok{+} \CommentTok{\# Tie characteristics}
\NormalTok{              (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ ego\_ID), }\CommentTok{\# Intercept (1) varies in level{-}2 units (ego\_ID)}
            \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\CommentTok{\# Model class (logistic)}
            \AttributeTok{data =}\NormalTok{ model.data) }\CommentTok{\# Data object}
\NormalTok{car}\SpecialCharTok{::}\FunctionTok{S}\NormalTok{(m2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Generalized linear mixed model fit by ML
## Call: glmer(formula = alter.loan ~ alter.fam + alter.same.age + (1 | ego_ID),
##             data = model.data, family = binomial("logit"))
## 
## Estimates of Fixed Effects:
##                   Estimate Std. Error z value Pr(>|z|)    
## (Intercept)       -0.21556    0.10511  -2.051   0.0403 *  
## alter.famYes       1.01248    0.09284  10.906   <2e-16 ***
## alter.same.ageYes  0.20385    0.07951   2.564   0.0104 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Exponentiated Fixed Effects and Confidence Bounds:
##                   Estimate     2.5 %    97.5 %
## (Intercept)       0.806089 0.6560166 0.9904925
## alter.famYes      2.752416 2.2945237 3.3016850
## alter.same.ageYes 1.226113 1.0491868 1.4328735
## 
## Estimates of Random Effects (Covariance Components):
##  Groups Name        Std.Dev.
##  ego_ID (Intercept) 0.9372  
## 
## Number of obs: 3972, groups:  ego_ID, 100
## 
##   logLik       df      AIC      BIC 
## -2478.16        4  4964.31  4989.46
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# m3: Add ego characteristics as predictors (level 2)                      ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Add ego age (ego.age.cen), employment status (ego.empl.bin), }
\CommentTok{\# educational level (ego.edu)}

\CommentTok{\# See descriptives for the new predictors}
\FunctionTok{skim\_tee}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{ego.age.cen)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Data Summary ------------------------
##                            Values
## Name                       data  
## Number of rows             4590  
## Number of columns          1     
## _______________________          
## Column type frequency:           
##   numeric                  1     
## ________________________         
## Group variables            None  
## 
## -- Variable type: numeric ------------------------------------------------------
##   skim_variable n_missing complete_rate     mean   sd    p0   p25     p50  p75
## 1 V1                   45         0.990 1.09e-15 2.14 -3.85 -1.85 -0.0515 1.95
##   p100 hist 
## 1 3.95 ‚ñÉ‚ñá‚ñÖ‚ñÜ‚ñÖ
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabyl}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{ego.empl.bin)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  model.data$ego.empl.bin    n   percent
##                       No  900 0.1960784
##                      Yes 3690 0.8039216
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabyl}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{ego.edu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  model.data$ego.edu    n   percent
##             Primary 1890 0.4117647
##           Secondary 2025 0.4411765
##          University  675 0.1470588
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Estimate the model and view results}
\NormalTok{m3 }\OtherTok{\textless{}{-}} \FunctionTok{glmer}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}}\NormalTok{ alter.fam }\SpecialCharTok{+}\NormalTok{ alter.same.age }\SpecialCharTok{+} \CommentTok{\# Tie characteristics}
\NormalTok{              ego.age.cen }\SpecialCharTok{+}\NormalTok{ ego.empl.bin }\SpecialCharTok{+}\NormalTok{ ego.edu }\SpecialCharTok{+} \CommentTok{\# Ego characteristics}
\NormalTok{              (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ ego\_ID), }\CommentTok{\# Intercept (1) varies in level{-}2 units}
            \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\CommentTok{\# Model class (logistic)}
            \AttributeTok{data =}\NormalTok{ model.data) }\CommentTok{\# Data}
\NormalTok{car}\SpecialCharTok{::}\FunctionTok{S}\NormalTok{(m3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Generalized linear mixed model fit by ML
## Call: glmer(formula = alter.loan ~ alter.fam + alter.same.age + ego.age.cen +
##             ego.empl.bin + ego.edu + (1 | ego_ID), data = model.data, family =
##             binomial("logit"))
## 
## Estimates of Fixed Effects:
##                   Estimate Std. Error z value Pr(>|z|)    
## (Intercept)       -0.61436    0.22536  -2.726  0.00641 ** 
## alter.famYes       1.00698    0.09285  10.845  < 2e-16 ***
## alter.same.ageYes  0.19790    0.07950   2.489  0.01281 *  
## ego.age.cen       -0.01306    0.04487  -0.291  0.77099    
## ego.empl.binYes    0.07830    0.24563   0.319  0.74991    
## ego.eduSecondary   0.49402    0.20962   2.357  0.01844 *  
## ego.eduUniversity  0.86482    0.29947   2.888  0.00388 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Exponentiated Fixed Effects and Confidence Bounds:
##                    Estimate     2.5 %    97.5 %
## (Intercept)       0.5409892 0.3478234 0.8414306
## alter.famYes      2.7373325 2.2818749 3.2836986
## alter.same.ageYes 1.2188387 1.0429695 1.4243637
## ego.age.cen       0.9870230 0.9039204 1.0777658
## ego.empl.binYes   1.0814450 0.6682212 1.7502037
## ego.eduSecondary  1.6388905 1.0867238 2.4716141
## ego.eduUniversity 2.3745730 1.3202994 4.2706956
## 
## Estimates of Random Effects (Covariance Components):
##  Groups Name        Std.Dev.
##  ego_ID (Intercept) 0.879   
## 
## Number of obs: 3972, groups:  ego_ID, 100
## 
##   logLik       df      AIC      BIC 
## -2472.68        8  4961.36  5011.66
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# m4: Add alter characteristics as predictors (level 1)                        ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Add alter sex and alter age (centered)}

\CommentTok{\# See descriptives for the new predictors}
\FunctionTok{tabyl}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{alter.sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  model.data$alter.sex    n   percent
##                Female 1297 0.2825708
##                  Male 3293 0.7174292
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{skim\_tee}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{alter.age.cat.cen)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Data Summary ------------------------
##                            Values
## Name                       data  
## Number of rows             4590  
## Number of columns          1     
## _______________________          
## Column type frequency:           
##   numeric                  1     
## ________________________         
## Group variables            None  
## 
## -- Variable type: numeric ------------------------------------------------------
##   skim_variable n_missing complete_rate     mean   sd    p0   p25    p50   p75
## 1 V1                    8         0.998 1.95e-15 1.64 -3.13 -1.13 -0.126 0.874
##   p100 hist 
## 1 2.87 ‚ñÜ‚ñÖ‚ñÜ‚ñá‚ñÜ
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Estimate the model and view results}
\NormalTok{m4 }\OtherTok{\textless{}{-}} \FunctionTok{glmer}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}}\NormalTok{ alter.fam }\SpecialCharTok{+}\NormalTok{ alter.same.age }\SpecialCharTok{+} \CommentTok{\# Tie characteristics}
\NormalTok{              ego.age.cen }\SpecialCharTok{+}\NormalTok{ ego.empl.bin }\SpecialCharTok{+}\NormalTok{ ego.edu }\SpecialCharTok{+} \CommentTok{\# Ego characteristics}
\NormalTok{              alter.sex }\SpecialCharTok{+}\NormalTok{ alter.age.cat.cen }\SpecialCharTok{+} \CommentTok{\# Alter characteristics}
\NormalTok{              (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ ego\_ID), }\CommentTok{\# Intercept (1) varies in level{-}2 units}
            \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\CommentTok{\# Model class (logistic)}
            \AttributeTok{data=}\NormalTok{ model.data) }\CommentTok{\# Data}
\NormalTok{car}\SpecialCharTok{::}\FunctionTok{S}\NormalTok{(m4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Generalized linear mixed model fit by ML
## Call: glmer(formula = alter.loan ~ alter.fam + alter.same.age + ego.age.cen +
##             ego.empl.bin + ego.edu + alter.sex + alter.age.cat.cen + (1 | ego_ID), data =
##             model.data, family = binomial("logit"))
## 
## Estimates of Fixed Effects:
##                   Estimate Std. Error z value Pr(>|z|)    
## (Intercept)       -0.79887    0.23618  -3.383 0.000718 ***
## alter.famYes       1.04455    0.09450  11.053  < 2e-16 ***
## alter.same.ageYes  0.18047    0.07984   2.261 0.023786 *  
## ego.age.cen       -0.02345    0.04544  -0.516 0.605772    
## ego.empl.binYes    0.06895    0.24628   0.280 0.779486    
## ego.eduSecondary   0.49039    0.21008   2.334 0.019578 *  
## ego.eduUniversity  0.87968    0.30013   2.931 0.003379 ** 
## alter.sexMale      0.25266    0.08596   2.939 0.003289 ** 
## alter.age.cat.cen  0.03834    0.02475   1.549 0.121300    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Exponentiated Fixed Effects and Confidence Bounds:
##                    Estimate     2.5 %    97.5 %
## (Intercept)       0.4498365 0.2831526 0.7146425
## alter.famYes      2.8421300 2.3615731 3.4204755
## alter.same.ageYes 1.1977844 1.0242887 1.4006672
## ego.age.cen       0.9768214 0.8935895 1.0678058
## ego.empl.binYes   1.0713874 0.6611755 1.7361061
## ego.eduSecondary  1.6329480 1.0818205 2.4648443
## ego.eduUniversity 2.4101365 1.3383500 4.3402381
## alter.sexMale     1.2874404 1.0878274 1.5236817
## alter.age.cat.cen 1.0390877 0.9898894 1.0907312
## 
## Estimates of Random Effects (Covariance Components):
##  Groups Name        Std.Dev.
##  ego_ID (Intercept) 0.881   
## 
## Number of obs: 3972, groups:  ego_ID, 100
## 
##   logLik       df      AIC      BIC 
## -2467.02       10  4954.04  5016.91
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# m5: Add network characteristics as predictors (level 2)                  ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Add count of family members in network (centered)}

\CommentTok{\# See descriptives for the new predictor}
\FunctionTok{skim\_tee}\NormalTok{(model.data}\SpecialCharTok{$}\NormalTok{net.count.fam.cen)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Data Summary ------------------------
##                            Values
## Name                       data  
## Number of rows             4590  
## Number of columns          1     
## _______________________          
## Column type frequency:           
##   numeric                  1     
## ________________________         
## Group variables            None  
## 
## -- Variable type: numeric ------------------------------------------------------
##   skim_variable n_missing complete_rate     mean   sd    p0    p25    p50   p75
## 1 V1                    0             1 2.30e-16 1.02 -1.72 -0.722 -0.122 0.478
##   p100 hist 
## 1 2.88 ‚ñÉ‚ñá‚ñÖ‚ñÇ‚ñÅ
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Estimate model and see results}
\NormalTok{m5 }\OtherTok{\textless{}{-}} \FunctionTok{glmer}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}}\NormalTok{ alter.fam }\SpecialCharTok{+}\NormalTok{ alter.same.age }\SpecialCharTok{+} \CommentTok{\# Tie characteristics}
\NormalTok{              ego.age.cen }\SpecialCharTok{+}\NormalTok{ ego.empl.bin }\SpecialCharTok{+}\NormalTok{ ego.edu }\SpecialCharTok{+} \CommentTok{\# Ego characteristics}
\NormalTok{              alter.sex }\SpecialCharTok{+}\NormalTok{ alter.age.cat.cen }\SpecialCharTok{+}  \CommentTok{\# Alter characteristics}
\NormalTok{              net.count.fam.cen }\SpecialCharTok{+} \CommentTok{\# Ego{-}network characteristics}
\NormalTok{              (}\DecValTok{1} \SpecialCharTok{|}\NormalTok{ ego\_ID), }\CommentTok{\# Intercept (1) varies in level{-}2 units}
            \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\CommentTok{\# Model class (logistic)}
            \AttributeTok{data=}\NormalTok{ model.data) }\CommentTok{\# Data}
\NormalTok{car}\SpecialCharTok{::}\FunctionTok{S}\NormalTok{(m5)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Generalized linear mixed model fit by ML
## Call: glmer(formula = alter.loan ~ alter.fam + alter.same.age + ego.age.cen +
##             ego.empl.bin + ego.edu + alter.sex + alter.age.cat.cen + net.count.fam.cen + (1
##             | ego_ID), data = model.data, family = binomial("logit"))
## 
## Estimates of Fixed Effects:
##                   Estimate Std. Error z value Pr(>|z|)    
## (Intercept)       -0.85010    0.23451  -3.625 0.000289 ***
## alter.famYes       1.06161    0.09498  11.178  < 2e-16 ***
## alter.same.ageYes  0.18265    0.07984   2.288 0.022143 *  
## ego.age.cen       -0.02294    0.04473  -0.513 0.608080    
## ego.empl.binYes    0.11925    0.24383   0.489 0.624801    
## ego.eduSecondary   0.49636    0.20680   2.400 0.016385 *  
## ego.eduUniversity  0.94460    0.29757   3.174 0.001502 ** 
## alter.sexMale      0.25065    0.08595   2.916 0.003544 ** 
## alter.age.cat.cen  0.03879    0.02474   1.568 0.116935    
## net.count.fam.cen -0.17863    0.09517  -1.877 0.060523 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Exponentiated Fixed Effects and Confidence Bounds:
##                    Estimate     2.5 %    97.5 %
## (Intercept)       0.4273712 0.2698904 0.6767418
## alter.famYes      2.8910105 2.3999717 3.4825169
## alter.same.ageYes 1.2003998 1.0265266 1.4037236
## ego.age.cen       0.9773249 0.8952995 1.0668653
## ego.empl.binYes   1.1266465 0.6986206 1.8169121
## ego.eduSecondary  1.6427235 1.0953169 2.4637077
## ego.eduUniversity 2.5717720 1.4352830 4.6081582
## alter.sexMale     1.2848651 1.0856573 1.5206256
## alter.age.cat.cen 1.0395482 0.9903442 1.0911968
## net.count.fam.cen 0.8364157 0.6940866 1.0079307
## 
## Estimates of Random Effects (Covariance Components):
##  Groups Name        Std.Dev.
##  ego_ID (Intercept) 0.8647  
## 
## Number of obs: 3972, groups:  ego_ID, 100
## 
##   logLik       df      AIC      BIC 
## -2465.28       11  4952.56  5021.72
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Results as tidy data frame}
\FunctionTok{tidy}\NormalTok{(m5)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 7
##    effect   group  term              estimate std.error statistic   p.value
##    <chr>    <chr>  <chr>                <dbl>     <dbl>     <dbl>     <dbl>
##  1 fixed    <NA>   (Intercept)        -0.850     0.235     -3.62   2.89e- 4
##  2 fixed    <NA>   alter.famYes        1.06      0.0950    11.2    5.25e-29
##  3 fixed    <NA>   alter.same.ageYes   0.183     0.0798     2.29   2.21e- 2
##  4 fixed    <NA>   ego.age.cen        -0.0229    0.0447    -0.513  6.08e- 1
##  5 fixed    <NA>   ego.empl.binYes     0.119     0.244      0.489  6.25e- 1
##  6 fixed    <NA>   ego.eduSecondary    0.496     0.207      2.40   1.64e- 2
##  7 fixed    <NA>   ego.eduUniversity   0.945     0.298      3.17   1.50e- 3
##  8 fixed    <NA>   alter.sexMale       0.251     0.0860     2.92   3.54e- 3
##  9 fixed    <NA>   alter.age.cat.cen   0.0388    0.0247     1.57   1.17e- 1
## 10 fixed    <NA>   net.count.fam.cen  -0.179     0.0952    -1.88   6.05e- 2
## 11 ran_pars ego_ID sd__(Intercept)     0.865    NA         NA     NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Plot predictor effects                                                   ====}
\CommentTok{\# ============================================================================ =}

\FunctionTok{library}\NormalTok{(ggeffects)}

\CommentTok{\# Probability of financial support as a function of alter.fam}
\FunctionTok{ggpredict}\NormalTok{(m5, }\StringTok{"alter.fam"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # Predicted probabilities of alter.loan
## 
## alter.fam | Predicted |       95% CI
## ------------------------------------
## No        |      0.30 | [0.21, 0.40]
## Yes       |      0.55 | [0.44, 0.66]
## 
## Adjusted for:
## *    alter.same.age =      No
## *       ego.age.cen =   -0.03
## *      ego.empl.bin =      No
## *           ego.edu = Primary
## *         alter.sex =  Female
## * alter.age.cat.cen =   -0.05
## * net.count.fam.cen =    0.00
## *            ego_ID = 0 (population-level)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# You can convert it to a tidy data frame}
\FunctionTok{ggpredict}\NormalTok{(m5, }\StringTok{"alter.fam"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{as\_tibble}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 6
##   x     predicted std.error conf.low conf.high group
##   <fct>     <dbl>     <dbl>    <dbl>     <dbl> <fct>
## 1 No        0.299     0.234    0.212     0.403 1    
## 2 Yes       0.552     0.239    0.436     0.664 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# You can also plot the result}
\FunctionTok{ggpredict}\NormalTok{(m5, }\StringTok{"alter.fam"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{plot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Egocentric_R_bookdown_files/figure-latex/rand-intercept-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Probability of financial support as a function of ego.edu}
\FunctionTok{ggpredict}\NormalTok{(m5, }\StringTok{"ego.edu"}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{plot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Egocentric_R_bookdown_files/figure-latex/rand-intercept-2.pdf}

\hypertarget{random-slope-models}{%
\section{Random slope models}\label{random-slope-models}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# m6: Random slope for alter.fam                                           ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Fit model}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2707}\NormalTok{)}
\NormalTok{m6 }\OtherTok{\textless{}{-}} \FunctionTok{glmer}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}}\NormalTok{ alter.fam }\SpecialCharTok{+}\NormalTok{ alter.same.age }\SpecialCharTok{+} \CommentTok{\# Tie characteristics}
\NormalTok{              ego.age.cen }\SpecialCharTok{+}\NormalTok{ ego.empl.bin }\SpecialCharTok{+}\NormalTok{ ego.edu }\SpecialCharTok{+} \CommentTok{\# Ego characteristics}
\NormalTok{              alter.sex }\SpecialCharTok{+}\NormalTok{ alter.age.cat.cen }\SpecialCharTok{+}  \CommentTok{\# Alter characteristics}
\NormalTok{              net.count.fam.cen }\SpecialCharTok{+} \CommentTok{\# Ego{-}network characteristics}
\NormalTok{              (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ alter.fam }\SpecialCharTok{|}\NormalTok{ ego\_ID), }\CommentTok{\# Both intercept (1) and alter.fam }
            \CommentTok{\# slppe vary in level{-}2 units (ego\_ID)}
            \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\CommentTok{\# Model class (logistic)}
            \AttributeTok{data =}\NormalTok{ model.data) }\CommentTok{\# Data}

\CommentTok{\# Re{-}fit with starting values from previous fit to address convergence warnings}

\CommentTok{\# Get estimate values from previous fit}
\NormalTok{ss }\OtherTok{\textless{}{-}} \FunctionTok{getME}\NormalTok{(m6, }\FunctionTok{c}\NormalTok{(}\StringTok{"theta"}\NormalTok{, }\StringTok{"fixef"}\NormalTok{))}

\CommentTok{\# Refit by setting ss as starting values }
\NormalTok{m6 }\OtherTok{\textless{}{-}} \FunctionTok{glmer}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}}\NormalTok{ alter.fam }\SpecialCharTok{+}\NormalTok{ alter.same.age }\SpecialCharTok{+} \CommentTok{\# Tie characteristics}
\NormalTok{              ego.age.cen }\SpecialCharTok{+}\NormalTok{ ego.empl.bin }\SpecialCharTok{+}\NormalTok{ ego.edu }\SpecialCharTok{+} \CommentTok{\# Ego characteristics}
\NormalTok{              alter.sex }\SpecialCharTok{+}\NormalTok{ alter.age.cat.cen }\SpecialCharTok{+}  \CommentTok{\# Alter characteristics}
\NormalTok{              net.count.fam.cen }\SpecialCharTok{+} \CommentTok{\# Ego{-}network characteristics}
\NormalTok{              (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ alter.fam }\SpecialCharTok{|}\NormalTok{ ego\_ID), }\CommentTok{\# Both intercept (1) and alter.fam }
            \AttributeTok{start=}\NormalTok{ ss, }\CommentTok{\# }
            \CommentTok{\# slppe vary in level{-}2 units (ego\_ID)}
            \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\CommentTok{\# Model class (logistic)}
            \AttributeTok{data=}\NormalTok{ model.data) }\CommentTok{\# Data}

\CommentTok{\# View results}
\NormalTok{car}\SpecialCharTok{::}\FunctionTok{S}\NormalTok{(m6)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Generalized linear mixed model fit by ML
## Call: glmer(formula = alter.loan ~ alter.fam + alter.same.age + ego.age.cen +
##             ego.empl.bin + ego.edu + alter.sex + alter.age.cat.cen + net.count.fam.cen + (1
##             + alter.fam | ego_ID), data = model.data, family = binomial("logit"), start =
##             ss)
## 
## Estimates of Fixed Effects:
##                   Estimate Std. Error z value Pr(>|z|)    
## (Intercept)       -0.91968    0.24605  -3.738 0.000186 ***
## alter.famYes       1.10130    0.12286   8.964  < 2e-16 ***
## alter.same.ageYes  0.18966    0.08067   2.351 0.018713 *  
## ego.age.cen       -0.02932    0.04559  -0.643 0.520114    
## ego.empl.binYes    0.16612    0.25192   0.659 0.509615    
## ego.eduSecondary   0.52521    0.21101   2.489 0.012809 *  
## ego.eduUniversity  1.00011    0.30744   3.253 0.001142 ** 
## alter.sexMale      0.25913    0.08691   2.982 0.002868 ** 
## alter.age.cat.cen  0.04229    0.02515   1.682 0.092584 .  
## net.count.fam.cen -0.18543    0.09693  -1.913 0.055745 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Exponentiated Fixed Effects and Confidence Bounds:
##                    Estimate     2.5 %    97.5 %
## (Intercept)       0.3986475 0.2461204 0.6456995
## alter.famYes      3.0080801 2.3643604 3.8270587
## alter.same.ageYes 1.2088406 1.0320627 1.4158981
## ego.age.cen       0.9711061 0.8881039 1.0618657
## ego.empl.binYes   1.1807181 0.7206342 1.9345392
## ego.eduSecondary  1.6908172 1.1181093 2.5568725
## ego.eduUniversity 2.7185746 1.4881625 4.9662908
## alter.sexMale     1.2958056 1.0928514 1.5364505
## alter.age.cat.cen 1.0432016 0.9930326 1.0959051
## net.count.fam.cen 0.8307445 0.6870036 1.0045601
## 
## Estimates of Random Effects (Covariance Components):
##  Groups Name         Std.Dev. Corr 
##  ego_ID (Intercept)  0.9054        
##         alter.famYes 0.6697   -0.27
## 
## Number of obs: 3972, groups:  ego_ID, 100
## 
##   logLik       df      AIC      BIC 
## -2460.22       13  4946.44  5028.17
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Results as tidy data frame}
\FunctionTok{tidy}\NormalTok{(m6)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 13 x 7
##    effect   group  term                   estimate std.error statistic   p.value
##    <chr>    <chr>  <chr>                     <dbl>     <dbl>     <dbl>     <dbl>
##  1 fixed    <NA>   (Intercept)             -0.920     0.246     -3.74   1.86e- 4
##  2 fixed    <NA>   alter.famYes             1.10      0.123      8.96   3.13e-19
##  3 fixed    <NA>   alter.same.ageYes        0.190     0.0807     2.35   1.87e- 2
##  4 fixed    <NA>   ego.age.cen             -0.0293    0.0456    -0.643  5.20e- 1
##  5 fixed    <NA>   ego.empl.binYes          0.166     0.252      0.659  5.10e- 1
##  6 fixed    <NA>   ego.eduSecondary         0.525     0.211      2.49   1.28e- 2
##  7 fixed    <NA>   ego.eduUniversity        1.00      0.307      3.25   1.14e- 3
##  8 fixed    <NA>   alter.sexMale            0.259     0.0869     2.98   2.87e- 3
##  9 fixed    <NA>   alter.age.cat.cen        0.0423    0.0251     1.68   9.26e- 2
## 10 fixed    <NA>   net.count.fam.cen       -0.185     0.0969    -1.91   5.57e- 2
## 11 ran_pars ego_ID sd__(Intercept)          0.905    NA         NA     NA       
## 12 ran_pars ego_ID cor__(Intercept).alte~  -0.275    NA         NA     NA       
## 13 ran_pars ego_ID sd__alter.famYes         0.670    NA         NA     NA
\end{verbatim}

\hypertarget{tests-of-significance}{%
\section{Tests of significance}\label{tests-of-significance}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Test significance of ego{-}level random intercept                          ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# Test that there is significant clustering by egos, i.e. ego{-}level variance}
\CommentTok{\# of random intercepts is significantly higher than 0. This means comparing}
\CommentTok{\# the random{-}intercept null model (i.e. "variance components" model) to the }
\CommentTok{\# single{-}level null model.}

\CommentTok{\# First estimate the simpler, single{-}level null model: m0, which is nested in m1}
\NormalTok{m0 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(alter.loan }\SpecialCharTok{\textasciitilde{}} \DecValTok{1}\NormalTok{, }\AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{ model.data)}

\CommentTok{\# Then conduct a LRT comparing deviance of m0 to deviance of m1.}

\CommentTok{\# Difference between deviances.}
\NormalTok{(val }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{2}\SpecialCharTok{*}\FunctionTok{logLik}\NormalTok{(m0)) }\SpecialCharTok{{-}}\NormalTok{ (}\SpecialCharTok{{-}}\DecValTok{2}\SpecialCharTok{*}\FunctionTok{logLik}\NormalTok{(m1))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'log Lik.' 416.3027 (df=1)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Compare this difference to chi{-}squared distribution with 1 degree of freedom.}
\FunctionTok{pchisq}\NormalTok{(val, }\AttributeTok{df=} \DecValTok{1}\NormalTok{, }\AttributeTok{lower.tail =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'log Lik.' 0 (df=1)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The same result is obtained using the anova() function}
\FunctionTok{anova}\NormalTok{(m1, m0, }\AttributeTok{refit=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Data: model.data
## Models:
## m0: alter.loan ~ 1
## m1: alter.loan ~ (1 | ego_ID)
##    npar    AIC    BIC  logLik deviance Chisq Df Pr(>Chisq)    
## m0    1 5572.8 5579.1 -2785.4   5570.8                        
## m1    2 5158.5 5171.1 -2577.2   5154.5 416.3  1  < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Test significance of ego{-}level random slope for alter.fam                ====}
\CommentTok{\# ============================================================================ =}

\CommentTok{\# This is done with a LRT comparing the same model with random slope for alter.fam}
\CommentTok{\# (m6) and without it (m5). Note that m5 is nested in m6, that\textquotesingle{}s why we can }
\CommentTok{\# use LRT.}

\CommentTok{\# Difference between deviances.}
\NormalTok{(val }\OtherTok{\textless{}{-}}\NormalTok{ (}\SpecialCharTok{{-}}\DecValTok{2}\SpecialCharTok{*}\FunctionTok{logLik}\NormalTok{(m5)) }\SpecialCharTok{{-}}\NormalTok{ (}\SpecialCharTok{{-}}\DecValTok{2}\SpecialCharTok{*}\FunctionTok{logLik}\NormalTok{(m6)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'log Lik.' 10.12578 (df=11)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Compare this difference to chi{-}squared distribution with 2 degrees of freedom.}
\FunctionTok{pchisq}\NormalTok{(val, }\AttributeTok{df=} \DecValTok{2}\NormalTok{, }\AttributeTok{lower.tail =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'log Lik.' 0.006327254 (df=11)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same results with anova() function}
\FunctionTok{anova}\NormalTok{(m6, m5, }\AttributeTok{refit=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Data: model.data
## Models:
## m5: alter.loan ~ alter.fam + alter.same.age + ego.age.cen + ego.empl.bin + ego.edu + alter.sex + alter.age.cat.cen + net.count.fam.cen + (1 | ego_ID)
## m6: alter.loan ~ alter.fam + alter.same.age + ego.age.cen + ego.empl.bin + ego.edu + alter.sex + alter.age.cat.cen + net.count.fam.cen + (1 + alter.fam | ego_ID)
##    npar    AIC    BIC  logLik deviance  Chisq Df Pr(>Chisq)   
## m5   11 4952.6 5021.7 -2465.3   4930.6                        
## m6   13 4946.4 5028.2 -2460.2   4920.4 10.126  2   0.006327 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\hypertarget{egor}{%
\chapter{\texorpdfstring{The \texttt{egor} package}{The egor package}}\label{egor}}

The \texttt{egor} package provides tools for data import, data manipulation, network measures and visualization for egocentric network analysis. This chapter currently focuses on egocentric data import, with Section \ref{egor-import} showing how we can use \texttt{egor} to read raw csv files into the R data objects used throughout this workshop (those saved in the \texttt{data.rda} file).

More information about this package can be found in its \href{https://github.com/tilltnet/egor}{github website} and \href{https://cran.r-project.org/web/packages/egor/vignettes/using_egor.html}{main vignette}. A list of all \texttt{egor} vignettes is \href{https://cran.r-project.org/web/packages/egor/index.html}{here}.

\hypertarget{egor-import}{%
\section{Importing ego-network data}\label{egor-import}}

\begin{itemize}
\tightlist
\item
  Here we show how to use \texttt{egor} to import egocentric data stored in csv files. This operation requires that all needed csv files are first imported into R data frames, using standard data import functions such as \texttt{read\_csv()}. The \texttt{egor} functions then take these data frames as input and return an \texttt{egor} object as output.
\item
  Once we have the data in an \texttt{egor} object, this can be manipulated and analyzed in various and powerful ways. It can also further be converted into the other types of objects we have used throughout this workshop, such as a data frame of alter attributes or a list of igraph objects.
\item
  In this example, we import the data with the function \texttt{threefiles\_to\_egor}. This assumes that the data are stored in three datasets: (1) a datasets with ego attributes for all egos; (2) a datasets with attributes of the alters and ego-alter ties, for all alters from all egos; (3) a datasets of alter-alter ties with a single edge list for all alters from all egos. These correspond to the three main components of egocentric data discussed in Section \ref{egocentric-data}: (1) ego attributes; (2) alter attributes; (3) alter-alter ties.
\item
  In some cases, these three components are combined into two or even one single dataset. \texttt{egor} offers functions to import data in these formats as well: \texttt{onefile\_to\_egor} and \texttt{twofiles\_to\_egor}. See their manual page for the contents and features that the functions assume in these data.
\item
  Finally, \texttt{egor} has functions to import egocentric data obtained from popular data collection software, such as \texttt{read\_openeddi}, \texttt{read\_egoweb}, and \texttt{read\_egonet}.
\item
  Regardless of the format of the original data, an \texttt{egor} object always stores the data in the three components indicated above (ego attributes, alter attributes, alter-alter ties). Each of the three components can be ``activated'' using the \texttt{activate} function, similar to the \texttt{tidygraph} package. After we select which of the three components we want to work on (via \texttt{activate}), an \texttt{egor} object can be easily manipulated with \texttt{dplyr} verbs.
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Read three csv files (ego attributes, alter attributes, alter-alter ties) into R data frames.
  \item
    Create an \texttt{egor} object from these three data frames.
  \item
    Convert the \texttt{egor} object to a list of \texttt{igraph} ego-networks.
  \end{itemize}
\item
  The resulting data objects are those that we used in the previous chapters (saved in the \texttt{data.rda} file).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load packages}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(magrittr)}
\FunctionTok{library}\NormalTok{(igraph)}
\FunctionTok{library}\NormalTok{(egor)}
\FunctionTok{library}\NormalTok{(janitor)}

\CommentTok{\# Import the raw csv files into R as data frames.}

\CommentTok{\# Ego attributes}
\NormalTok{(ego.df }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/ego\_data.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second~    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second~    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second~     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert all character variables to factor}
\CommentTok{\# Using dplyr\textquotesingle{}s across(), this code takes all ego.df variables that are character}
\CommentTok{\# (where(is.character)) and applies the as.factor() function to each, converting }
\CommentTok{\# it to a factor variable. The resulting data frame is re{-}assigned to ego.df.}
\NormalTok{ego.df }\OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.character), as.factor))}

\CommentTok{\# Alter attributes (all alters from all egos in same data frame).}
\NormalTok{(alter.attr.all }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/alter\_attributes.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,590 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <chr>     <chr>         <chr>        <chr>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 4,580 more rows
## # i 5 more variables: alter.res <chr>, alter.clo <dbl>, alter.loan <chr>,
## #   alter.fam <chr>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert all character variables to factor.}
\NormalTok{alter.attr.all }\OtherTok{\textless{}{-}}\NormalTok{ alter.attr.all }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.character), as.factor))}

\CommentTok{\# To make things easier in the rest of the workshop materials, make sure the }
\CommentTok{\# factors of alter gender and ego gender have the same levels (categories).}

\CommentTok{\# Levels of alter.sex variable.}
\NormalTok{alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(alter.sex) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{levels}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Female" "Male"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Levels of ego.sex variable: Female doesn\textquotesingle{}t appear because no ego is female in }
\CommentTok{\# these data.}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(ego.sex) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{levels}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Male"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tabyl}\NormalTok{(ego.sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  ego.sex   n percent
##     Male 102       1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Add the Female level to the ego.sex factor.}
\NormalTok{ego.df }\OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ego.sex =} \FunctionTok{fct\_expand}\NormalTok{(ego.sex, }\StringTok{"Female"}\NormalTok{))}

\CommentTok{\# See the result}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pull}\NormalTok{(ego.sex) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{levels}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Male"   "Female"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that this doesn\textquotesingle{}t alter the actual data in ego.df, just adds "Female" to }
\CommentTok{\# the list of possible levels (categories) in ego.sex.}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tabyl}\NormalTok{(ego.sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  ego.sex   n percent
##     Male 102       1
##   Female   0       0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Alter{-}alter ties (single edge list with all alters from all egos).}
\NormalTok{(alter\_ties }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/alter\_ties.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 30,064 x 4
##     from    to ego_ID weight
##    <dbl> <dbl>  <dbl>  <dbl>
##  1  2801  2802     28      1
##  2  2801  2803     28      1
##  3  2801  2804     28      1
##  4  2801  2805     28      1
##  5  2801  2806     28      1
##  6  2801  2807     28      1
##  7  2801  2808     28      1
##  8  2801  2809     28      1
##  9  2801  2810     28      1
## 10  2801  2811     28      1
## # i 30,054 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Using these 3 data frames, create an egor object.}
\NormalTok{egor.obj }\OtherTok{\textless{}{-}}\NormalTok{ egor}\SpecialCharTok{::}\FunctionTok{threefiles\_to\_egor}\NormalTok{(}\AttributeTok{egos=}\NormalTok{ ego.df, }
                               \AttributeTok{alters.df=}\NormalTok{ alter.attr.all, }
                               \AttributeTok{edges=}\NormalTok{ alter\_ties, }
                               \AttributeTok{ID.vars =} \FunctionTok{list}\NormalTok{(}\AttributeTok{ego =} \StringTok{"ego\_ID"}\NormalTok{, }
                                              \AttributeTok{alter =} \StringTok{"alter\_ID"}\NormalTok{, }
                                              \AttributeTok{source =} \StringTok{"from"}\NormalTok{, }
                                              \AttributeTok{target =} \StringTok{"to"}\NormalTok{))}

\CommentTok{\# The egor object can immediately be converted to a list of igraph networks.}
\NormalTok{gr.list }\OtherTok{\textless{}{-}}\NormalTok{ egor}\SpecialCharTok{::}\FunctionTok{as\_igraph}\NormalTok{(egor.obj)}

\CommentTok{\# See the result}
\FunctionTok{head}\NormalTok{(gr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $`28`
## IGRAPH d7aa3db UNW- 45 259 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from d7aa3db (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
## 
## $`29`
## IGRAPH ba6f278 UNW- 45 202 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from ba6f278 (vertex names):
##  [1] 2901--2902 2901--2904 2901--2906 2901--2907 2901--2908 2901--2909
##  [7] 2901--2910 2901--2911 2901--2915 2901--2916 2901--2917 2901--2918
## [13] 2901--2919 2901--2927 2901--2928 2901--2929 2901--2930 2901--2931
## [19] 2901--2936 2901--2942 2901--2945 2902--2903 2902--2904 2902--2905
## [25] 2902--2906 2902--2907 2902--2908 2902--2909 2902--2910 2902--2911
## + ... omitted several edges
## 
## $`33`
## IGRAPH 61def57 UNW- 45 207 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from 61def57 (vertex names):
##  [1] 3301--3302 3301--3303 3301--3304 3301--3305 3301--3306 3301--3307
##  [7] 3301--3308 3301--3309 3301--3310 3301--3311 3301--3312 3301--3313
## [13] 3301--3314 3301--3315 3301--3316 3301--3317 3301--3318 3301--3319
## [19] 3301--3320 3301--3321 3301--3322 3301--3323 3302--3303 3302--3304
## [25] 3302--3305 3302--3306 3302--3307 3302--3308 3302--3309 3302--3310
## + ... omitted several edges
## 
## $`35`
## IGRAPH 40f9c1b UNW- 45 221 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from 40f9c1b (vertex names):
##  [1] 3501--3502 3501--3503 3501--3504 3501--3505 3501--3506 3501--3507
##  [7] 3501--3508 3501--3509 3501--3510 3501--3512 3501--3513 3501--3514
## [13] 3501--3516 3501--3517 3501--3522 3501--3523 3501--3524 3501--3525
## [19] 3501--3526 3501--3527 3501--3528 3501--3529 3501--3530 3501--3532
## [25] 3501--3533 3501--3534 3501--3535 3501--3536 3501--3540 3501--3543
## + ... omitted several edges
## 
## $`39`
## IGRAPH c82c64d UNW- 45 92 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from c82c64d (vertex names):
##  [1] 3901--3902 3901--3903 3901--3904 3901--3905 3901--3906 3901--3907
##  [7] 3901--3911 3901--3913 3901--3920 3901--3924 3901--3925 3901--3931
## [13] 3901--3932 3901--3933 3901--3937 3901--3938 3901--3940 3901--3941
## [19] 3902--3903 3902--3904 3902--3905 3902--3906 3902--3907 3902--3908
## [25] 3902--3909 3902--3910 3902--3913 3902--3924 3902--3925 3902--3931
## + ... omitted several edges
## 
## $`40`
## IGRAPH a34649c UNW- 45 255 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from a34649c (vertex names):
##  [1] 4001--4003 4001--4007 4001--4008 4001--4009 4001--4036 4001--4040
##  [7] 4001--4045 4002--4003 4002--4004 4002--4006 4002--4008 4002--4009
## [13] 4002--4010 4002--4011 4002--4012 4002--4013 4002--4014 4002--4015
## [19] 4002--4016 4002--4017 4002--4021 4002--4029 4002--4036 4002--4037
## [25] 4002--4038 4002--4040 4002--4041 4002--4042 4002--4043 4002--4044
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that gr.list is a named list, with each element\textquotesingle{}s name being the }
\CommentTok{\# corresponding ego ID.}
\FunctionTok{names}\NormalTok{(gr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "28"  "29"  "33"  "35"  "39"  "40"  "45"  "46"  "47"  "48"  "49"  "51" 
##  [13] "52"  "53"  "55"  "56"  "57"  "58"  "59"  "60"  "61"  "62"  "64"  "65" 
##  [25] "66"  "68"  "69"  "71"  "73"  "74"  "78"  "79"  "80"  "81"  "82"  "83" 
##  [37] "84"  "85"  "86"  "87"  "88"  "90"  "91"  "92"  "93"  "94"  "95"  "97" 
##  [49] "99"  "102" "104" "105" "107" "108" "109" "110" "112" "113" "114" "115"
##  [61] "116" "118" "119" "120" "121" "122" "123" "124" "125" "126" "127" "128"
##  [73] "129" "130" "131" "132" "133" "135" "136" "138" "139" "140" "141" "142"
##  [85] "144" "146" "147" "149" "151" "152" "153" "154" "155" "156" "157" "158"
##  [97] "159" "160" "161" "162" "163" "164"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# In gr.list, the igraph ego{-}networks do not include the ego node. We can create}
\CommentTok{\# the same list, but now include a node for ego in each igraph ego{-}network.}
\NormalTok{gr.list.ego }\OtherTok{\textless{}{-}}\NormalTok{ egor}\SpecialCharTok{::}\FunctionTok{as\_igraph}\NormalTok{(egor.obj, }\AttributeTok{include.ego =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\# Let\textquotesingle{}s look at the same network with and without the ego.}

\CommentTok{\# Without ego (gr.list).}
\NormalTok{(gr }\OtherTok{\textless{}{-}}\NormalTok{ gr.list[[}\StringTok{"28"}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH d7aa3db UNW- 45 259 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from d7aa3db (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Just the vertex sequence.}
\FunctionTok{V}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 45/45 vertices, named, from d7aa3db:
##  [1] 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## [16] 2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## [31] 2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# With ego (gr.list.ego). }
\NormalTok{(gr.ego }\OtherTok{\textless{}{-}}\NormalTok{ gr.list.ego[[}\StringTok{"28"}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 3b5d609 UNW- 46 304 -- 
## + attr: .egoID (g/n), name (v/c), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), weight (e/n)
## + edges from 3b5d609 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Just the vertex sequence. Note the name of the last node.}
\FunctionTok{V}\NormalTok{(gr.ego)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 46/46 vertices, named, from 3b5d609:
##  [1] 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## [16] 2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## [31] 2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
## [46] ego
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# In our ego{-}network data, alter{-}alter ties have weights (1 or 2, see the data }
\CommentTok{\# codebook).}
\FunctionTok{E}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [75] 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 2 1
## [112] 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1
## [149] 1 1 1 1 1 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1
## [186] 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 2 1 1 1 1 1 1
## [223] 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# These weights are obviously not defined for ego{-}alter ties. So in the }
\CommentTok{\# ego{-}network with the ego included, the tie weights are NA for ego{-}alter ties.}
\FunctionTok{E}\NormalTok{(gr.ego)}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1]  1  1  1  1  1  1  1  1  1  1  1  1  1  1  2  1  1  1  1  1  2  1  1  1  1
##  [26]  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
##  [51]  1  1  1  1  1  1  1  2  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
##  [76]  1  1  1  1  2  1  1  1  1  1  1  1  1  1  1  2  2  1  1  1  1  1  1  1  1
## [101]  1  1  1  1  1  1  1  2  1  2  1  1  1  1  1  1  1  1  1  2  1  1  1  1  1
## [126]  1  1  1  1  1  2  1  1  1  1  1  1  1  1  2  1  1  1  1  2  1  1  1  1  1
## [151]  1  1  1  1  1  2  2  1  1  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
## [176]  1  1  1  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  2  1  1  1
## [201]  1  1  1  1  1  1  1  2  1  1  1  1  2  1  1  2  1  1  1  1  1  1  1  1  1
## [226]  1  1  1  1  2  1  1  1  1  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
## [251]  1  1  1  1  1  1  2  1  1 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [276] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [301] NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{E}\NormalTok{(gr.ego)[}\FunctionTok{inc}\NormalTok{(}\StringTok{"ego"}\NormalTok{)]}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 'inc' is deprecated.
## Use '.inc' instead.
## See help("Deprecated")
\end{verbatim}

\begin{verbatim}
##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This may create problems in certain functions, for example the plot.igraph()}
\CommentTok{\# function. So let\textquotesingle{}s replace those NA\textquotesingle{}s with a distinctive weight value for }
\CommentTok{\# ego{-}alter ties: 3.}
\FunctionTok{E}\NormalTok{(gr.ego)}\SpecialCharTok{$}\NormalTok{weight }\OtherTok{\textless{}{-}} \FunctionTok{E}\NormalTok{(gr.ego)}\SpecialCharTok{$}\NormalTok{weight }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{replace\_na}\NormalTok{(}\DecValTok{3}\NormalTok{)}

\CommentTok{\# See the result}
\FunctionTok{E}\NormalTok{(gr.ego)}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [75] 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 2 1
## [112] 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1
## [149] 1 1 1 1 1 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1
## [186] 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 2 1 1 1 1 1 1
## [223] 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1
## [260] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
## [297] 3 3 3 3 3 3 3 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{E}\NormalTok{(gr.ego)[}\FunctionTok{inc}\NormalTok{(}\StringTok{"ego"}\NormalTok{)]}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 'inc' is deprecated.
## Use '.inc' instead.
## See help("Deprecated")
\end{verbatim}

\begin{verbatim}
##  [1] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
## [39] 3 3 3 3 3 3 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s now plot the two ego{-}networks.}

\CommentTok{\# Without ego.}
\FunctionTok{plot}\NormalTok{(gr, }\AttributeTok{vertex.label =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Egocentric_R_bookdown_files/figure-latex/egor-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# With ego.}
\FunctionTok{plot}\NormalTok{(gr.ego, }\AttributeTok{vertex.label =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Egocentric_R_bookdown_files/figure-latex/egor-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s do the weight replacement operation above (NA replaced by 3 for ego{-}alter }
\CommentTok{\# tie weights) for all the ego{-}networks in gr.list.ego.}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(gr.list.ego)) \{}
  \FunctionTok{E}\NormalTok{(gr.ego)}\SpecialCharTok{$}\NormalTok{weight }\OtherTok{\textless{}{-}} \FunctionTok{E}\NormalTok{(gr.ego)}\SpecialCharTok{$}\NormalTok{weight }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{replace\_na}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\NormalTok{\}}

\CommentTok{\# The operation above can be done with tidyverse map() functions as well. First}
\CommentTok{\# define the function operating on a single graph.}
\NormalTok{weight\_replace }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(gr) \{}
  \FunctionTok{E}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{weight }\OtherTok{\textless{}{-}} \FunctionTok{E}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{weight }\SpecialCharTok{|\textgreater{}} 
    \FunctionTok{replace\_na}\NormalTok{(}\DecValTok{3}\NormalTok{)}
  
  \CommentTok{\# Return value}
\NormalTok{  gr}
\NormalTok{\}}

\CommentTok{\# Then apply the function to all graphs in the list.}
\NormalTok{new.list }\OtherTok{\textless{}{-}}\NormalTok{ gr.list.ego }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{map}\NormalTok{(weight\_replace)}

\CommentTok{\# Sometimes it\textquotesingle{}s useful to have ego ID as a graph attribute of the ego{-}network}
\CommentTok{\# in addition to having it as name of the ego{-}network\textquotesingle{}s element in the list.}
\CommentTok{\# So let\textquotesingle{}s add ego ID as the $ego\_ID graph attribute in each list element.}

\CommentTok{\# List of graphs without the ego.}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(gr.list)) \{}
\NormalTok{  gr.list[[i]]}\SpecialCharTok{$}\NormalTok{ego\_ID }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(gr.list)[[i]]}
\NormalTok{\}}

\CommentTok{\# List of graphs with the ego.}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(gr.list.ego)) \{}
\NormalTok{  gr.list.ego[[i]]}\SpecialCharTok{$}\NormalTok{ego\_ID }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(gr.list.ego)[[i]]}
\NormalTok{\}}

\CommentTok{\# See the result }
\NormalTok{gr.list[[}\StringTok{"28"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH d7aa3db UNW- 45 259 -- 
## + attr: .egoID (g/n), ego_ID (g/c), name (v/c), alter_num (v/n),
## | alter.sex (v/c), alter.age.cat (v/c), alter.rel (v/c), alter.nat
## | (v/c), alter.res (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam
## | (v/c), alter.age (v/n), weight (e/n)
## + edges from d7aa3db (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gr.list[[}\StringTok{"28"}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{ego\_ID}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "28"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Extract alter attributes and graph for one ego (ego ID 28)}

\CommentTok{\# Alter attribute data frame.}
\NormalTok{alter.attr}\FloatTok{.28} \OtherTok{\textless{}{-}}\NormalTok{ alter.attr.all }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(ego\_ID}\SpecialCharTok{==}\DecValTok{28}\NormalTok{)}

\CommentTok{\# Ego{-}network graph.}
\NormalTok{gr}\FloatTok{.28} \OtherTok{\textless{}{-}}\NormalTok{ gr.list[[}\StringTok{"28"}\NormalTok{]]}

\CommentTok{\# Ego{-}network graph, with ego included.}
\NormalTok{gr.ego}\FloatTok{.28} \OtherTok{\textless{}{-}}\NormalTok{ gr.list.ego[[}\StringTok{"28"}\NormalTok{]]}

\CommentTok{\# Save all data to file.}
\FunctionTok{save}\NormalTok{(ego.df, alter.attr.all, gr.list, alter.attr}\FloatTok{.28}\NormalTok{, gr}\FloatTok{.28}\NormalTok{, gr.ego}\FloatTok{.28}\NormalTok{, }\AttributeTok{file=}\StringTok{"./Data/data.rda"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{analyzing-and-visualizing-ego-network-data}{%
\section{Analyzing and visualizing ego-network data}\label{analyzing-and-visualizing-ego-network-data}}

In progress.

\texttt{egor} also simplifies some of the analysis operations that we have seen in the previous chapters, such as the calculation of certain compositional and structural measures.

\hypertarget{supplementary}{%
\chapter{Supplementary topics}\label{supplementary}}

\hypertarget{more-r-programming-topics}{%
\section{More R programming topics}\label{more-r-programming-topics}}

\hypertarget{types-and-classes-of-objects}{%
\subsection{Types and classes of objects}\label{types-and-classes-of-objects}}

This is a quick summary of the basics about \textbf{types} and \textbf{classes} of objects in R.

\begin{itemize}
\item
  Three functions are used to know what kind of object you are dealing with in R: \texttt{class()}, \texttt{mode()}, and \texttt{typeof()}.
\item
  For most purposes, you only need to know what the \textbf{class} of an object is. This is returned by \texttt{class()}. The class of an object determines what R functions you can or cannot run on that object, and how functions will behave when you run them on the object. In particular, if the function has a \texttt{method} for a specific class \emph{A} of objects, it will use that method whenever an object of class \emph{A} is given as its argument.
\item
  \texttt{typeof()} and \texttt{mode()} return the \textbf{type} and \textbf{mode} of an object, respectively. Although they refer to slightly different classifications of objects, type and mode give essentially the same kind of information --- the type of data structure in which the object is stored, also called the R ``internal type'' or ``storage mode''. For example, an object can be internally stored in R as double-precision numbers, integer numbers, or character strings.

  \begin{itemize}
  \tightlist
  \item
    You should prefer \texttt{typeof()} over \texttt{mode()}. \texttt{mode()} refers to the old S classification of types and is mostly used for S compatibility.
  \end{itemize}
\item
  While most times all you need to know is the \texttt{class} of an object, there are a few cases in which knowing the \texttt{type} is useful too. For example, you may want to know the \texttt{type} of a matrix object (whose \texttt{class} is always \texttt{matrix}) to check if the values in the matrix are being stored as numbers or character strings (that will affect the result of some functions).
\item
  Main classes/types of objects

  \begin{itemize}
  \tightlist
  \item
    \texttt{numeric}: Numerical data (integer, real or complex numbers).
  \item
    \texttt{logical}: \texttt{TRUE/FALSE} data.
  \item
    \texttt{character}: String data.
  \item
    \texttt{factor}: Categorical data, that is, integer numbers with string labels attached. May be \emph{unordered} factors (nominal data) or \emph{ordered} factors (ordinal data).
  \end{itemize}
\item
  Special and complex classes/types

  \begin{itemize}
  \tightlist
  \item
    \texttt{list}: A collection of elements of any type, including numeric, character, logical (see Section \ref{lists}).
  \item
    \texttt{data.frame}: A dataset. In R, a data frame is a special kind of list (its type is \texttt{list} but its class is \texttt{data.frame}), where each variable (column) is a list element (see Section \ref{dataframes})
  \item
    \texttt{matrix}: Matrix values can be numeric, character, logical etc. So an object can have \texttt{matrix} as class and \texttt{numeric}, \texttt{character} or \texttt{logical} as type. While data frames can contain variables of different type (e.g.~a character variable and a numeric variable), matrices can only contain values of \emph{one} type.
  \item
    Functions (more on this in Section \ref{functions}).
  \item
    Expressions.
  \item
    Formulas.
  \item
    Other objects: Statistical results (e.g.~linear model estimates), dendrograms, graphics objects, etc.
  \end{itemize}
\item
  Relevant functions

  \begin{itemize}
  \tightlist
  \item
    \texttt{class()}, \texttt{typeof()} and \texttt{mode()}, as discussed above.
  \item
    \texttt{is.}\emph{type} functions verify that an object is in a specific type or class: e.g.~\texttt{is.numeric(x)}, \texttt{is.character(x)} (they return \texttt{TRUE} or \texttt{FALSE}).
  \item
    \texttt{as.}\emph{type} functions convert objects between types or classes: e.g.~\texttt{as.numeric()}, \texttt{as.character()}. If the conversion is impossible, the result is \texttt{NA}: e.g.~\texttt{as.numeric("abc")} returns \texttt{NA}.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A numeric vector of integers.}
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{100}

\CommentTok{\# Let\textquotesingle{}s check the class and type.}
\FunctionTok{class}\NormalTok{(n)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(n)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A character object.}
\NormalTok{(char }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"e"}\NormalTok{, }\StringTok{"f"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a" "b" "c" "d" "e" "f"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Class and type.}
\FunctionTok{class}\NormalTok{(char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s put n in a matrix.}
\NormalTok{(M }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(n, }\AttributeTok{nrow=}\DecValTok{10}\NormalTok{, }\AttributeTok{ncol=}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1   11   21   31   41   51   61   71   81    91
##  [2,]    2   12   22   32   42   52   62   72   82    92
##  [3,]    3   13   23   33   43   53   63   73   83    93
##  [4,]    4   14   24   34   44   54   64   74   84    94
##  [5,]    5   15   25   35   45   55   65   75   85    95
##  [6,]    6   16   26   36   46   56   66   76   86    96
##  [7,]    7   17   27   37   47   57   67   77   87    97
##  [8,]    8   18   28   38   48   58   68   78   88    98
##  [9,]    9   19   29   39   49   59   69   79   89    99
## [10,]   10   20   30   40   50   60   70   80   90   100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Class/type of this object.}
\FunctionTok{class}\NormalTok{(M)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "matrix" "array"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Type and mode tell us that this is an *integer* matrix.}
\FunctionTok{typeof}\NormalTok{(M)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "integer"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# There are character and logical matrices too.}
\NormalTok{char}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a" "b" "c" "d" "e" "f"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(C }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(char, }\AttributeTok{nrow=}\DecValTok{3}\NormalTok{, }\AttributeTok{ncol=} \DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,] "a"  "d" 
## [2,] "b"  "e" 
## [3,] "c"  "f"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Class and type.}
\FunctionTok{class}\NormalTok{(C)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "matrix" "array"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(C)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Notice that a matrix can contain numbers but still be stored as character.}
\NormalTok{(M }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"2"}\NormalTok{, }\StringTok{"3"}\NormalTok{, }\StringTok{"4"}\NormalTok{), }\AttributeTok{nrow=}\DecValTok{2}\NormalTok{, }\AttributeTok{ncol=}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,] "1"  "3" 
## [2,] "2"  "4"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(M)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "matrix" "array"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(M)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s convert "char" to factor.}
\NormalTok{char}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a" "b" "c" "d" "e" "f"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(char }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] a b c d e f
## Levels: a b c d e f
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This means that now char is not just a collection of strings, it is a}
\CommentTok{\# categorical variable in R\textquotesingle{}s mind: it is a collection of numbers with character}
\CommentTok{\# labels attached.}

\CommentTok{\# Compare the different behavior of as.numeric(): char as character...}
\NormalTok{(char }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"e"}\NormalTok{, }\StringTok{"f"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "a" "b" "c" "d" "e" "f"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert to numeric}
\FunctionTok{as.numeric}\NormalTok{(char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: NAs introduced by coercion
\end{verbatim}

\begin{verbatim}
## [1] NA NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...versus char as factor.}
\NormalTok{char }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"e"}\NormalTok{, }\StringTok{"f"}\NormalTok{)}
\NormalTok{(char }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] a b c d e f
## Levels: a b c d e f
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.numeric}\NormalTok{(char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# char is a different object in R\textquotesingle{}s mind when it\textquotesingle{}s character vs when}
\CommentTok{\# it\textquotesingle{}s factor. Characters can\textquotesingle{}t be converted to numbers,}
\CommentTok{\# but factors can.}

\CommentTok{\# ***** EXERCISE: }
\CommentTok{\# Using "as.factor()", convert the "educ" object to factor. Assign the}
\CommentTok{\# result to "educ.fc". Print both "educ" and "educ.fc". Do you notice any}
\CommentTok{\# difference in the way they are printed? Convert "educ" and "educ.fc" to}
\CommentTok{\# numeric. Why is the result different?}
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{functions}{%
\subsection{Writing your own R functions}\label{functions}}

\begin{itemize}
\tightlist
\item
  One of the most powerful tools in R is the ability to \textbf{write your own functions}.
\item
  A function is a \textbf{piece of code} that operates on one or multiple \textbf{arguments} (the \emph{input}), and returns an \emph{output} (the function \textbf{value} in R terminology). Everything that happens in R is done by a function.
\item
  Many R functions have \textbf{default values} for their arguments: if you don't specify the argument's value, the function will use the default.
\item
  Once you write a function and define its arguments, you can run that function on any argument values you want --- provided that the function code actually works on those argument values. For example, if a function takes an \texttt{igraph} object as an argument, you'll be able to run that function on any network you like, provided that the network is an \texttt{igraph} object. If your network is a \texttt{network} object (created by a \texttt{statnet} function), the function will likely return an error.
\item
  R functions, combined with \href{https://adv-r.hadley.nz/functionals.html}{functional} and summarization methods such as those seen in Sections \ref{comp-many} and \ref{apply-purrr}, are the best way to run exactly the same code on many different objects (for example, many different ego-networks). Functions are \textbf{crucial for code reproducibility} in R. If you write functions, you won't need to re-write (copy and paste) the same code over and over again --- you just write it once in the function, then run the function any time and on any arguments you need. This yields clearer, shorter, more readable code with less errors.
\item
  New functions are also commonly used to \textbf{redefine existing functions} by pre-setting the value of specific arguments. For example, if you want all your plots to have \texttt{red} as color, you can take R's existing plotting function \texttt{plot}, and wrap it in a new function that always executes \texttt{plot} with the argument \texttt{col="red"}. Your function would be something like \texttt{my.plot\ \textless{}-\ function(...)\ \{plot(...,\ col="red")\}} (examples below).
\item
  \textbf{Tips and tricks} with functions:

  \begin{itemize}
  \tightlist
  \item
    \texttt{stopifnot()} is useful to check that function arguments are of the type that was intended by the function author. It stops the function if a certain condition is not met by a function argument (e.g.~argument is \emph{not} an \texttt{igraph} object, if the function was written for \texttt{igraph} objects).
  \item
    \texttt{return()} allows you to explicitly set the output that the function will return (clearer code). It is also used to stop function execution earlier under certain conditions. Note: If you don't use \texttt{return()}, the function value (output) is the last object that is printed at the end of the function code.
  \item
    \texttt{if} is a flow control tool that is frequently used within functions: it specifies what the function should do \texttt{if} a certain condition is met at one point.
  \item
    First think particular, then generalize. When you want to write a function, it's a good idea to first try the code on a ``real'', specific existing object in your workspace. If the code does what you want on that object, you can then wrap it into a general function to be run on any similar object (see examples in the code below).
  \end{itemize}
\item
  In ego-network analysis, we often want to write functions that calculate measures of ego-network composition and structure that we are interested in. These functions will have different arguments depending on whether they look at network composition or structure:

  \begin{itemize}
  \tightlist
  \item
    Functions that calculate compositional measures typically require just the alter attribute data frame as argument.
  \item
    Functions that calculate structural measures require the ego-network as an \texttt{igraph} object (or \texttt{network} object in \texttt{statnet}), which store the alter-alter tie information.
  \item
    Functions that calculate measures combining composition and structure require the \texttt{igraph} object, with alter attributes incorporated in the object as vertex attributes.
  \end{itemize}
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Demonstrate the basics of R functions using simple examples.
  \item
    Consider some of the compositional and structural measures we calculated in previous chapters, and convert them to general functions that can be applied to any ego-network: average closeness of alters; proportion of female alters; proportion of alters of the same gender as ego; function that returns multiple compositional measures into a data frame; maximum alter betweenness; number of components and isolates in the ego-network; tie density between alters who live in Sri Lanka.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Basics of R functions}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Any piece of code you can write and run in R, you can also put in a function.}

\CommentTok{\# Let\textquotesingle{}s write a trivial function that takes its argument and multiplies it by 2.}
\NormalTok{times2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x}\SpecialCharTok{*}\DecValTok{2}
\NormalTok{\}}

\CommentTok{\# Now we can run the function on any argument.}
\FunctionTok{times2}\NormalTok{(}\AttributeTok{x=} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{times2}\NormalTok{(}\AttributeTok{x=} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{times2}\NormalTok{(}\DecValTok{50}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A function that takes its argument and prints a sentence with it:}
\NormalTok{myoutput }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(word) \{}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"My output is"}\NormalTok{, word))}
\NormalTok{\}}

\CommentTok{\# Let\textquotesingle{}s run the function.}
\FunctionTok{myoutput}\NormalTok{(}\StringTok{"cat"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "My output is cat"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{myoutput}\NormalTok{(}\AttributeTok{word=} \StringTok{"table"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "My output is table"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{myoutput}\NormalTok{(}\StringTok{"any word here"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "My output is any word here"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Not necessarily a useful function...}

\CommentTok{\# Note that the function output is the last object that is printed at the end}
\CommentTok{\# of the function code.}
\NormalTok{times2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  y }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{*}\DecValTok{2}
\NormalTok{  y}
\NormalTok{\}}
\FunctionTok{times2}\NormalTok{(}\AttributeTok{x=}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# If nothing is printed, then the function returns nothing.}
\NormalTok{times2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  y }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{*}\DecValTok{2}
\NormalTok{\}}
\FunctionTok{times2}\NormalTok{(}\AttributeTok{x=}\DecValTok{4}\NormalTok{)}

\CommentTok{\# A function will return an error if it\textquotesingle{}s executed on arguments that are not}
\CommentTok{\# suitable for the code inside the function. E.g., R can\textquotesingle{}t multiply "a" by 2...}
\NormalTok{times2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x}\SpecialCharTok{*}\DecValTok{2}
\NormalTok{\}}
\FunctionTok{times2}\NormalTok{(}\AttributeTok{x=} \StringTok{"a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in x * 2: non-numeric argument to binary operator
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s then specify that the function\textquotesingle{}s argument must be numeric.}
\NormalTok{times2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{stopifnot}\NormalTok{(}\FunctionTok{is.numeric}\NormalTok{(x))  }
\NormalTok{  x}\SpecialCharTok{*}\DecValTok{2}
\NormalTok{\}}

\CommentTok{\# Let\textquotesingle{}s try it now.}
\FunctionTok{times2}\NormalTok{(}\AttributeTok{x=} \StringTok{"a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in times2(x = "a"): is.numeric(x) is not TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This still throws and error, but it makes the error clearer to the user and }
\CommentTok{\# it immidiately indicates where the problem is.}

\CommentTok{\# Using if, we can also re{-}write the function so that it returns NA with a}
\CommentTok{\# warning if its argument is not numeric {-}{-} instead of just stopping with an}
\CommentTok{\# error.}
\NormalTok{times2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \CommentTok{\# If x is not numeric}
  \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.numeric}\NormalTok{(x)) \{}
    \CommentTok{\# Give the warning}
    \FunctionTok{warning}\NormalTok{(}\StringTok{"Your argument is not numeric!"}\NormalTok{, }\AttributeTok{call. =} \ConstantTok{FALSE}\NormalTok{)}
    \CommentTok{\# Return missing value}
    \FunctionTok{return}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
    \CommentTok{\# Otherwise, return x*2}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{return}\NormalTok{(x}\SpecialCharTok{*}\DecValTok{2}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\# Try the function}
\FunctionTok{times2}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{times2}\NormalTok{(}\StringTok{"a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Your argument is not numeric!
\end{verbatim}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Writing functions that calculate ego{-}network measures}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Now that we know how to write functions, we can convert any ego{-}network}
\CommentTok{\# measure we calculated above to a general function.}

\CommentTok{\# This is a function that takes the alter{-}level data frame for an ego, and}
\CommentTok{\# calculates average closeness of alters.}
\NormalTok{avg\_alt\_clo }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df) \{}
  \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{alter.clo, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }
\NormalTok{\}}

\CommentTok{\# Let\textquotesingle{}s run this function on our alter data frame for ego 28}
\FunctionTok{avg\_alt\_clo}\NormalTok{(}\AttributeTok{df=}\NormalTok{ alter.attr}\FloatTok{.28}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function that takes the alter{-}level data frame for an ego, and calculates}
\CommentTok{\# the proportion of female alters.}
\NormalTok{prop\_fem }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df) \{}
  \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{alter.sex }\SpecialCharTok{==} \StringTok{"Female"}\NormalTok{) }
\NormalTok{\}}

\CommentTok{\# Apply the function to our data frame}
\FunctionTok{prop\_fem}\NormalTok{(}\AttributeTok{df=}\NormalTok{ alter.attr}\FloatTok{.28}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1777778
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function that takes two arguments: the alter{-}level data frame for an ego, and}
\CommentTok{\# the ego{-}level data frame; and calculates the proportion of alters of the same}
\CommentTok{\# sex as ego.}
\NormalTok{same\_sex }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, ego.df) \{}
  
  \CommentTok{\# Join alter and ego attribute data.}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(df, ego.df, }\AttributeTok{by=} \StringTok{"ego\_ID"}\NormalTok{)}
  
  \CommentTok{\# Return the measure}
  \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{alter.sex }\SpecialCharTok{==}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{ego.sex) }
\NormalTok{\}}

\CommentTok{\# Apply the function}
\FunctionTok{same\_sex}\NormalTok{(}\AttributeTok{df=}\NormalTok{ alter.attr}\FloatTok{.28}\NormalTok{, }\AttributeTok{ego.df=}\NormalTok{ ego.df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8222222
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function that takes the alter{-}level data frame for an ego, and calculates}
\CommentTok{\# multiple compositional measures.}
\NormalTok{comp\_meas }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{  df }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{summarise}\NormalTok{(}
      \AttributeTok{mean.clo =} \FunctionTok{mean}\NormalTok{(alter.clo, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{), }
      \AttributeTok{prop.fem =} \FunctionTok{mean}\NormalTok{(alter.sex}\SpecialCharTok{==}\StringTok{"Female"}\NormalTok{), }
      \AttributeTok{count.nat.slk =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{), }
      \AttributeTok{count.nat.ita =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{), }
      \AttributeTok{count.nat.oth =} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Other"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{\}}

\CommentTok{\# Let\textquotesingle{}s apply the function.}
\FunctionTok{comp\_meas}\NormalTok{(alter.attr}\FloatTok{.28}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   mean.clo prop.fem count.nat.slk count.nat.ita count.nat.oth
##      <dbl>    <dbl>         <int>         <int>         <int>
## 1      4.1    0.178            43             0             2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function that takes an ego{-}network as igraph object, and calculates max alter}
\CommentTok{\# betweenness.}
\NormalTok{max\_betw }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) x }\SpecialCharTok{|\textgreater{}}\NormalTok{ igraph}\SpecialCharTok{::}\FunctionTok{betweenness}\NormalTok{(}\AttributeTok{weights =} \ConstantTok{NA}\NormalTok{) }\SpecialCharTok{|\textgreater{}} \FunctionTok{max}\NormalTok{()}

\CommentTok{\# Apply to our graph.}
\FunctionTok{max\_betw}\NormalTok{(}\AttributeTok{x =}\NormalTok{ gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 257.0168
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function that takes an ego{-}network as igraph object, and calculates the number}
\CommentTok{\# of components and the number of isolates. }
\NormalTok{comp\_iso }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  
  \CommentTok{\# Get N components}
\NormalTok{  N.comp }\OtherTok{\textless{}{-}}\NormalTok{ igraph}\SpecialCharTok{::}\FunctionTok{components}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{no}
  
  \CommentTok{\# Get N isolates}
\NormalTok{  N.iso }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(x)}\SpecialCharTok{==}\DecValTok{0}\NormalTok{)}
  
  \CommentTok{\# Return output}
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{N.comp =}\NormalTok{ N.comp, }\AttributeTok{N.iso=}\NormalTok{ N.iso)}
\NormalTok{\}}

\CommentTok{\# Apply the function}
\FunctionTok{comp\_iso}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   N.comp N.iso
##    <int> <int>
## 1      1     0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function that takes an ego{-}network as igraph object, and calculates the}
\CommentTok{\# density of ties among alters who live in Sri Lanka.}
\NormalTok{sl\_dens }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  
  \CommentTok{\# Get the vertex sequence of alters who live in Sri Lanka.}
\NormalTok{  alters.sl }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(x)[alter.res}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{]}
  
  \CommentTok{\# Get the subgraph of those alters}
\NormalTok{  sl.subg }\OtherTok{\textless{}{-}} \FunctionTok{induced\_subgraph}\NormalTok{(x, }\AttributeTok{vids =}\NormalTok{ alters.sl) }
  
  \CommentTok{\# Return the density of this subgraph.}
  \FunctionTok{edge\_density}\NormalTok{(sl.subg)}
\NormalTok{\}}

\CommentTok{\# Run the function on our ego{-}network of ego 28.}
\FunctionTok{sl\_dens}\NormalTok{(}\AttributeTok{x=}\NormalTok{ gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6470588
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ***** EXERCISE: }
\CommentTok{\# Write a function that takes an ego\textquotesingle{}s edge list as argument. The function}
\CommentTok{\# returns the number of "maybe" edges in the corresponding personal network (use}
\CommentTok{\# data frame indexing and sum()). Run this function on the edge lists of ego ID}
\CommentTok{\# 47, 53 and 162. HINT: You should first try the code on one edge list from the}
\CommentTok{\# list elist.all.list An edge is "uncertain" if the corresponding value in}
\CommentTok{\# the edge list is 2. Remember that the ego IDs are in names(elist.all.list).}
\CommentTok{\# *****}
\end{Highlighting}
\end{Shaded}

\hypertarget{import-igraph}{%
\section{\texorpdfstring{Importing ego-network data with \texttt{igraph} and \texttt{tidyverse}}{Importing ego-network data with igraph and tidyverse}}\label{import-igraph}}

This section demonstrates how to import ego-network data into R ``manually'', without using \texttt{egor}. The \texttt{egor} packages has simplified many of these operations (see Section \ref{egor}).

\hypertarget{importing-data-for-one-ego-network}{%
\subsection{Importing data for one ego-network}\label{importing-data-for-one-ego-network}}

\begin{itemize}
\tightlist
\item
  Different functions exist to create \texttt{igraph} objects from data manually typed in R or (more typically) imported from external data sources -- such as adjacency matrices or edge lists in an external csv file. Some of these functions are \texttt{graph\_from\_edgelist}, \texttt{graph\_from\_adjacency\_matrix}, \texttt{graph\_from\_data\_frame}.
\item
  The following code assumes a common format for egocentric data (which, however, may not be the one you have): (1) a dataset with ego attributes for all egos; (2) a dataset with alter attributes for all alters from all egos; (3) a dataset of alter-alter ties with a single edge list for all alters from all egos.
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Import an ego-network from 2 csv files: the csv file with the edge list (alter-alter ties) and the csv file with alter attributes for one ego. Convert it to igraph object with alter attributes: \texttt{graph\_from\_data\_frame()}.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Alter attribute and tie data for one ego{-}network}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# Create graph with ego{-}network for ego 28}

\CommentTok{\# Get the ego{-}network of ego ID 28 from an external edge list and a data set}
\CommentTok{\# with alter attributes.}

\CommentTok{\# Read in the edge list for ego 28. This is a personal network edge list.}
\NormalTok{(elist}\FloatTok{.28} \OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/alter\_ties\_028.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 259 Columns: 3
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## dbl (3): from, to, weight
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{verbatim}
## # A tibble: 259 x 3
##     from    to weight
##    <dbl> <dbl>  <dbl>
##  1  2801  2802      1
##  2  2801  2803      1
##  3  2801  2804      1
##  4  2801  2805      1
##  5  2801  2806      1
##  6  2801  2807      1
##  7  2801  2808      1
##  8  2801  2809      1
##  9  2801  2810      1
## 10  2801  2811      1
## # i 249 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Read in the alter attribute data for ego 28. }
\NormalTok{(alter.attr}\FloatTok{.28} \OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/alter\_attributes\_028.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 45 Columns: 12
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (7): alter.sex, alter.age.cat, alter.rel, alter.nat, alter.res, alter.lo...
## dbl (5): alter_ID, ego_ID, alter_num, alter.clo, alter.age
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{verbatim}
## # A tibble: 45 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <chr>     <chr>         <chr>        <chr>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 35 more rows
## # i 5 more variables: alter.res <chr>, alter.clo <dbl>, alter.loan <chr>,
## #   alter.fam <chr>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert to graph with vertex attributes.}
\NormalTok{gr}\FloatTok{.28} \OtherTok{\textless{}{-}} \FunctionTok{graph\_from\_data\_frame}\NormalTok{(}\AttributeTok{d=}\NormalTok{ elist}\FloatTok{.28}\NormalTok{, }\AttributeTok{vertices=}\NormalTok{ alter.attr}\FloatTok{.28}\NormalTok{, }\AttributeTok{directed=} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Note directed= FALSE}

\CommentTok{\# A network object can be created from an adjacency matrix too: import adjacency}
\CommentTok{\# matrix for ego{-}network of ego 28.}

\CommentTok{\# Read the adjacency matrix.}
\NormalTok{adj}\FloatTok{.28} \OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./Data/raw\_data/adj\_028.csv"}\NormalTok{, }\AttributeTok{row.names=}\DecValTok{1}\NormalTok{) }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{as.matrix}\NormalTok{()}
\CommentTok{\# Set column names the same as rownames}
\FunctionTok{colnames}\NormalTok{(adj}\FloatTok{.28}\NormalTok{) }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(adj}\FloatTok{.28}\NormalTok{)}

\CommentTok{\# Convert to igraph}
\FunctionTok{graph\_from\_adjacency\_matrix}\NormalTok{(adj}\FloatTok{.28}\NormalTok{, }\AttributeTok{mode=}\StringTok{"upper"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 8342593 UN-- 45 283 -- 
## + attr: name (v/c)
## + edges from 8342593 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2818 2801--2820 2801--2823
## [19] 2801--2825 2801--2827 2801--2828 2801--2829 2801--2829 2801--2831
## [25] 2801--2840 2801--2841 2802--2803 2802--2804 2802--2805 2802--2806
## [31] 2802--2807 2802--2808 2802--2809 2802--2810 2802--2811 2802--2812
## [37] 2802--2813 2802--2815 2802--2823 2802--2831 2802--2840 2802--2841
## [43] 2803--2804 2803--2805 2803--2806 2803--2807 2803--2808 2803--2809
## + ... omitted several edges
\end{verbatim}

\hypertarget{importing-data-on-many-ego-networks-as-data-frames-and-lists}{%
\subsection{Importing data on many ego-networks as data frames and lists}\label{importing-data-on-many-ego-networks-as-data-frames-and-lists}}

\begin{itemize}
\tightlist
\item
  \textbf{Lists} are very convenient objects to store multiple pieces of data, such as multiple adjacency matrices or multiple alter attribute data frames, one for each ego. Once we have all our data pieces (e.g.~matrices or data frames) into a single list, we can very easily do two things:

  \begin{itemize}
  \tightlist
  \item
    Run a function on \emph{every} piece in batch (see Sections \ref{comp-many} and \ref{apply-purrr}).
  \item
    Run a function on \emph{all} the pieces together, using \texttt{do.call()}. \texttt{do.call(function,\ list)} executes \texttt{function} using all the elements of \texttt{list} as its arguments.
  \end{itemize}
\item
  In many cases, attributes of all alters from all the egos are stored in a single tabular dataset, e.g., a single csv file (such as \texttt{alter\_attributes.csv} in our data). Alter tie data can also be stored in a single csv file, for example as an edge list with an additional column indicating the ego ID (such as \texttt{alter\_ties.csv} in our data). Data of this type can be easily imported into R using the \texttt{read\_csv} function in tidyverse.
\item
  In other cases, alter attributes or alter-alter edge lists are stored in different \texttt{csv} files, one for each ego. These can also be imported using \texttt{read\_csv()} within a \texttt{for} loop.
\item
  Regardless of the external csv data source, once the data are in R we might want to store them as a single \emph{data frame} with all alters from all egos, or as a \emph{list} of separate data frames, one for each ego.

  \begin{itemize}
  \tightlist
  \item
    While a single data frame is more compact, there are scenarios in which coding is simpler if data for different egos are located in different data frames, and all these data frames are gathered in a list.
  \end{itemize}
\item
  In R it is easy to switch between a single data frame (pooling alters from all egos) and a list (with alters from each ego in a separate data frame)

  \begin{itemize}
  \tightlist
  \item
    Separate data frames, say \texttt{df1} and \texttt{df2}, can be appended into a single data frame using \texttt{bind\_rows}, which stacks their rows together: e.g.~\texttt{bind\_rows(df1,\ df2)}. If we have 100 egos, we will want to bind 100 data frames. If the data frames are part of a list, say \texttt{df.list}, this can be done simply as \texttt{bind\_rows(df.list)}. The result is a single data frame in which all data from all egos are stacked together by rows. Note that this requires that all data frames in \texttt{df.list} have the same variables with the same names.
  \item
    A single data frame, say \texttt{df} can be split into a list of data frames (one for each ego) by running \texttt{split(df,\ f=\ df\$egoID)} -- where \texttt{df\$egoID} is the variable with the ego IDs. This splits the single data frame into a list of separate data frames, one for each value of \texttt{egoID} (i.e., one for each ego).
  \end{itemize}
\item
  When you store ego data frames into a list, ego IDs can be conveniently saved as \textbf{names of list elements} (set via \texttt{names} or \texttt{set\_names}). If you're using \emph{numeric} ego IDs, you should be careful to the order in which list elements are stored in the list. Depending on the sequence of your numeric ego IDs, the 53rd data frame in the list is not necessarily the data frame of ego ID=53. Thus, you need to keep in mind the difference between \texttt{list{[}{[}53{]}{]}} (numeric indexing: get the 53rd list element) and \texttt{list{[}{[}"53"{]}{]}} (name indexing: get the list element named ``53'').
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Import the alter attribute data frame and edge list for all alters from \texttt{alter\_attributes.csv} and \texttt{alter\_ties.csv}.
  \item
    Demonstrate how alter attribute data frames and edge lists can be easily split by ego (using \texttt{split}) or combined into a single data frame with all alters (using \texttt{bind\_rows}).
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# All ego and alter attributes}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Import all ego and alter attributes}

\CommentTok{\# Import ego{-}level data.}
\NormalTok{(ego.df }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/ego\_data.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 102 Columns: 9
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (4): ego.sex, ego.edu, ego.empl.bin, ego.age.cat
## dbl (5): ego_ID, ego.age, ego.arr, ego.inc, empl
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{verbatim}
## # A tibble: 102 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <chr>     <dbl>   <dbl> <chr>     <dbl> <dbl> <chr>        <chr>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second~    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second~    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second~     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Import the csv file with attributes of all alters from all egos.}
\NormalTok{(alter.attr.all }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/alter\_attributes.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 4590 Columns: 12
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (7): alter.sex, alter.age.cat, alter.rel, alter.nat, alter.res, alter.lo...
## dbl (5): alter_ID, ego_ID, alter_num, alter.clo, alter.age
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{verbatim}
## # A tibble: 4,590 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <chr>     <chr>         <chr>        <chr>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 4,580 more rows
## # i 5 more variables: alter.res <chr>, alter.clo <dbl>, alter.loan <chr>,
## #   alter.fam <chr>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note the number of rows (number of all alters).}

\CommentTok{\# We can easily split a single data frame into a list of data frames, with one}
\CommentTok{\# separate element for each ego.}
\NormalTok{alter.attr.list }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(alter.attr.all, }\AttributeTok{f=}\NormalTok{ alter.attr.all}\SpecialCharTok{$}\NormalTok{ego\_ID)}

\CommentTok{\# The result is a list of N alter attribute data frames, one for each ego.}
\FunctionTok{length}\NormalTok{(alter.attr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The values of "f" in split() (the split factor) are preserved as list names.}
\CommentTok{\# In our case these are the ego IDs.}
\FunctionTok{names}\NormalTok{(alter.attr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "28"  "29"  "33"  "35"  "39"  "40"  "45"  "46"  "47"  "48"  "49"  "51" 
##  [13] "52"  "53"  "55"  "56"  "57"  "58"  "59"  "60"  "61"  "62"  "64"  "65" 
##  [25] "66"  "68"  "69"  "71"  "73"  "74"  "78"  "79"  "80"  "81"  "82"  "83" 
##  [37] "84"  "85"  "86"  "87"  "88"  "90"  "91"  "92"  "93"  "94"  "95"  "97" 
##  [49] "99"  "102" "104" "105" "107" "108" "109" "110" "112" "113" "114" "115"
##  [61] "116" "118" "119" "120" "121" "122" "123" "124" "125" "126" "127" "128"
##  [73] "129" "130" "131" "132" "133" "135" "136" "138" "139" "140" "141" "142"
##  [85] "144" "146" "147" "149" "151" "152" "153" "154" "155" "156" "157" "158"
##  [97] "159" "160" "161" "162" "163" "164"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The list element is the alter attribute data for a single ego. Get the}
\CommentTok{\# attribute data frame for ego ID 94.}
\NormalTok{alter.attr.list[[}\StringTok{"94"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 45 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <chr>     <chr>         <chr>        <chr>    
##  1     9401     94         1 Male      60+           Close family Sri Lanka
##  2     9402     94         2 Female    60+           Close family Sri Lanka
##  3     9403     94         3 Female    26-30         Close family Sri Lanka
##  4     9404     94         4 Male      26-30         Close family Sri Lanka
##  5     9405     94         5 Male      31-35         Close family Sri Lanka
##  6     9406     94         6 Female    60+           Other family Sri Lanka
##  7     9407     94         7 Male      51-60         Other family Sri Lanka
##  8     9408     94         8 Female    36-40         Other family Sri Lanka
##  9     9409     94         9 Female    51-60         Other family Sri Lanka
## 10     9410     94        10 Male      18-25         Other family Sri Lanka
## # i 35 more rows
## # i 5 more variables: alter.res <chr>, alter.clo <dbl>, alter.loan <chr>,
## #   alter.fam <chr>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The reverse of splitting is also easy to do: if we have N data frames in a}
\CommentTok{\# list, we can easily bind them into a single data frame by stacking their rows}
\CommentTok{\# together.}
\NormalTok{alter.attr.all}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(alter.attr.list)}

\CommentTok{\# The result is a single alter{-}level data frame where each row is an alter, and}
\CommentTok{\# alters from all egos are in the same data frame.}
\NormalTok{alter.attr.all}\FloatTok{.2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4,590 x 12
##    alter_ID ego_ID alter_num alter.sex alter.age.cat alter.rel    alter.nat
##       <dbl>  <dbl>     <dbl> <chr>     <chr>         <chr>        <chr>    
##  1     2801     28         1 Female    51-60         Close family Sri Lanka
##  2     2802     28         2 Male      51-60         Other family Sri Lanka
##  3     2803     28         3 Male      51-60         Close family Sri Lanka
##  4     2804     28         4 Male      60+           Close family Sri Lanka
##  5     2805     28         5 Female    41-50         Close family Sri Lanka
##  6     2806     28         6 Female    60+           Close family Sri Lanka
##  7     2807     28         7 Male      41-50         Other family Sri Lanka
##  8     2808     28         8 Female    36-40         Other family Sri Lanka
##  9     2809     28         9 Female    51-60         Other family Sri Lanka
## 10     2810     28        10 Male      60+           Other family Sri Lanka
## # i 4,580 more rows
## # i 5 more variables: alter.res <chr>, alter.clo <dbl>, alter.loan <chr>,
## #   alter.fam <chr>, alter.age <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 45 alters x 102 egos = 4590 alters.}

\CommentTok{\# Edge list with alter{-}alter ties}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Let\textquotesingle{}s import the csv containing a single edge list with alters from all}
\CommentTok{\# egos.}
\NormalTok{(elist.all }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"./Data/raw\_data/alter\_ties.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 30064 Columns: 4
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## dbl (4): from, to, ego_ID, weight
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{verbatim}
## # A tibble: 30,064 x 4
##     from    to ego_ID weight
##    <dbl> <dbl>  <dbl>  <dbl>
##  1  2801  2802     28      1
##  2  2801  2803     28      1
##  3  2801  2804     28      1
##  4  2801  2805     28      1
##  5  2801  2806     28      1
##  6  2801  2807     28      1
##  7  2801  2808     28      1
##  8  2801  2809     28      1
##  9  2801  2810     28      1
## 10  2801  2811     28      1
## # i 30,054 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Exactly the same split by ego ID can be done for the edge list with}
\CommentTok{\# alter{-}alter ties.}
\NormalTok{elist.all.list }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(elist.all, }\AttributeTok{f=}\NormalTok{ elist.all}\SpecialCharTok{$}\NormalTok{ego\_ID)}

\CommentTok{\# See the result.}
\FunctionTok{length}\NormalTok{(elist.all.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(elist.all.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "28"  "29"  "33"  "35"  "39"  "40"  "45"  "46"  "47"  "48"  "49"  "51" 
##  [13] "52"  "53"  "55"  "56"  "57"  "58"  "59"  "60"  "61"  "62"  "64"  "65" 
##  [25] "66"  "68"  "69"  "71"  "73"  "74"  "78"  "79"  "80"  "81"  "82"  "83" 
##  [37] "84"  "85"  "86"  "87"  "88"  "90"  "91"  "92"  "93"  "94"  "95"  "97" 
##  [49] "99"  "102" "104" "105" "107" "108" "109" "110" "112" "113" "114" "115"
##  [61] "116" "118" "119" "120" "121" "122" "123" "124" "125" "126" "127" "128"
##  [73] "129" "130" "131" "132" "133" "135" "136" "138" "139" "140" "141" "142"
##  [85] "144" "146" "147" "149" "151" "152" "153" "154" "155" "156" "157" "158"
##  [97] "159" "160" "161" "162" "163" "164"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{elist.all.list[[}\StringTok{"94"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 265 x 4
##     from    to ego_ID weight
##    <dbl> <dbl>  <dbl>  <dbl>
##  1  9401  9402     94      1
##  2  9401  9403     94      1
##  3  9401  9404     94      1
##  4  9401  9405     94      1
##  5  9401  9406     94      1
##  6  9401  9407     94      1
##  7  9401  9408     94      1
##  8  9401  9409     94      1
##  9  9401  9410     94      1
## 10  9401  9411     94      1
## # i 255 more rows
\end{verbatim}

\hypertarget{creating-lists-of-ego-networks-as-igraph-objects-with-purrr}{%
\subsection{\texorpdfstring{Creating lists of ego-networks as \texttt{igraph} objects with \texttt{purrr}}{Creating lists of ego-networks as igraph objects with purrr}}\label{creating-lists-of-ego-networks-as-igraph-objects-with-purrr}}

\begin{itemize}
\tightlist
\item
  \texttt{purrr::map()} is useful when you want to run functions that take a list element as argument, e.g.~an \texttt{igraph} ego network; and return another list element as output, e.g.~another \texttt{igraph} object. This is the case whenever you want to manipulate the ego networks (e.g.~only keep a certain type of ties or vertices), and store the results in a new list.
\item
  In certain cases, you want to run a function that takes \emph{two} arguments from two different lists, say \texttt{L1} and \texttt{L2}, for each ego. For example, for each ego you may want to take its alter-alter edge list (argument 1, from \texttt{L1}), take its alter attributes (argument 2, from \texttt{L2}), and put them together into an \texttt{igraph} object.

  \begin{itemize}
  \tightlist
  \item
    The function \texttt{purrr::map2()} does this with very little code. For \texttt{i}= 1, \ldots, \emph{I}, \texttt{map2()} takes the \texttt{i}-th element of \texttt{L1} and the \texttt{i}-th element of \texttt{L2}, and runs your function \emph{I} times, one for each pair of arguments \texttt{L1{[}{[}i{]}{]}} and \texttt{L2{[}{[}i{]}{]}}.
  \item
    Note that \texttt{L1} and \texttt{L2} need to be two ``parallel'' lists: the first element of \texttt{L1} corresponds to (will be combined with) the first element of \texttt{L2}; the second element of \texttt{L1} with the second element of \texttt{L2}, \ldots, the \emph{I}-the element of \texttt{L1} with the \emph{I}-th element of \texttt{L2}.
  \item
    \texttt{map2()} has a formula notation too: \texttt{map2(L1,\ L2,\ \textasciitilde{}\ f(.x,\ .y)}, where \texttt{.x} refers to each element of \texttt{L1} and \texttt{.y} refers to each element of \texttt{L2}.
  \end{itemize}
\item
  \textbf{What we do in the following code}.

  \begin{itemize}
  \tightlist
  \item
    Use \texttt{map()} to convert each ego's edge list to an \texttt{igraph} object.
  \item
    Use \texttt{map2()} to convert each ego's edge list \emph{and} alter attribute data frame to an \texttt{igraph} object.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Creating a list of ego{-}networks as igraph objects}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# We have a list of alter edge lists, with each list element being the edge list }
\CommentTok{\# of one ego.}
\FunctionTok{length}\NormalTok{(elist.all.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(elist.all.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "28"  "29"  "33"  "35"  "39"  "40"  "45"  "46"  "47"  "48"  "49"  "51" 
##  [13] "52"  "53"  "55"  "56"  "57"  "58"  "59"  "60"  "61"  "62"  "64"  "65" 
##  [25] "66"  "68"  "69"  "71"  "73"  "74"  "78"  "79"  "80"  "81"  "82"  "83" 
##  [37] "84"  "85"  "86"  "87"  "88"  "90"  "91"  "92"  "93"  "94"  "95"  "97" 
##  [49] "99"  "102" "104" "105" "107" "108" "109" "110" "112" "113" "114" "115"
##  [61] "116" "118" "119" "120" "121" "122" "123" "124" "125" "126" "127" "128"
##  [73] "129" "130" "131" "132" "133" "135" "136" "138" "139" "140" "141" "142"
##  [85] "144" "146" "147" "149" "151" "152" "153" "154" "155" "156" "157" "158"
##  [97] "159" "160" "161" "162" "163" "164"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{elist.all.list[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 259 x 4
##     from    to ego_ID weight
##    <dbl> <dbl>  <dbl>  <dbl>
##  1  2801  2802     28      1
##  2  2801  2803     28      1
##  3  2801  2804     28      1
##  4  2801  2805     28      1
##  5  2801  2806     28      1
##  6  2801  2807     28      1
##  7  2801  2808     28      1
##  8  2801  2809     28      1
##  9  2801  2810     28      1
## 10  2801  2811     28      1
## # i 249 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We saw that we can use igraph to convert one ego{-}network edge list}
\CommentTok{\# to an igraph object. Let\textquotesingle{}s do it for the first element (i.e., the first ego)}
\CommentTok{\# of elist.all.list.}
\NormalTok{elist }\OtherTok{\textless{}{-}}\NormalTok{ elist.all.list[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{(gr }\OtherTok{\textless{}{-}} \FunctionTok{graph\_from\_data\_frame}\NormalTok{(}\AttributeTok{d=}\NormalTok{ elist, }\AttributeTok{directed=} \ConstantTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 7fa1618 UNW- 45 259 -- 
## + attr: name (v/c), ego_ID (e/n), weight (e/n)
## + edges from 7fa1618 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## [31] 2802--2809 2802--2810 2802--2811 2802--2812 2802--2813 2802--2815
## [37] 2802--2823 2802--2831 2802--2840 2802--2841 2803--2804 2803--2805
## [43] 2803--2806 2803--2807 2803--2808 2803--2809 2803--2810 2803--2811
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# With map(), we can do the same thing for all egos at once.}
\NormalTok{gr.list }\OtherTok{\textless{}{-}}\NormalTok{ purrr}\SpecialCharTok{::}\FunctionTok{map}\NormalTok{(}\AttributeTok{.x=}\NormalTok{ elist.all.list, }
                      \SpecialCharTok{\textasciitilde{}} \FunctionTok{graph\_from\_data\_frame}\NormalTok{(}\AttributeTok{d=}\NormalTok{ .x, }\AttributeTok{directed=} \ConstantTok{FALSE}\NormalTok{))}

\CommentTok{\# The result is a list of graphs, with each element corresponding to an ego.}

\CommentTok{\# The list has as many elements as egos.}
\FunctionTok{length}\NormalTok{(gr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The element names are the ego IDs (taken from the names of elist.all.list).}
\FunctionTok{names}\NormalTok{(gr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "28"  "29"  "33"  "35"  "39"  "40"  "45"  "46"  "47"  "48"  "49"  "51" 
##  [13] "52"  "53"  "55"  "56"  "57"  "58"  "59"  "60"  "61"  "62"  "64"  "65" 
##  [25] "66"  "68"  "69"  "71"  "73"  "74"  "78"  "79"  "80"  "81"  "82"  "83" 
##  [37] "84"  "85"  "86"  "87"  "88"  "90"  "91"  "92"  "93"  "94"  "95"  "97" 
##  [49] "99"  "102" "104" "105" "107" "108" "109" "110" "112" "113" "114" "115"
##  [61] "116" "118" "119" "120" "121" "122" "123" "124" "125" "126" "127" "128"
##  [73] "129" "130" "131" "132" "133" "135" "136" "138" "139" "140" "141" "142"
##  [85] "144" "146" "147" "149" "151" "152" "153" "154" "155" "156" "157" "158"
##  [97] "159" "160" "161" "162" "163" "164"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can extract each ego\textquotesingle{}s graph.}
\CommentTok{\# By position.}
\NormalTok{gr.list[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 6ff7395 UNW- 45 259 -- 
## + attr: name (v/c), ego_ID (e/n), weight (e/n)
## + edges from 6ff7395 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## [31] 2802--2809 2802--2810 2802--2811 2802--2812 2802--2813 2802--2815
## [37] 2802--2823 2802--2831 2802--2840 2802--2841 2803--2804 2803--2805
## [43] 2803--2806 2803--2807 2803--2808 2803--2809 2803--2810 2803--2811
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# By name (ego ID).}
\NormalTok{gr.list[[}\StringTok{"94"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH b531146 UNW- 42 265 -- 
## + attr: name (v/c), ego_ID (e/n), weight (e/n)
## + edges from b531146 (vertex names):
##  [1] 9401--9402 9401--9403 9401--9404 9401--9405 9401--9406 9401--9407
##  [7] 9401--9408 9401--9409 9401--9410 9401--9411 9401--9412 9401--9413
## [13] 9401--9414 9401--9415 9401--9438 9401--9443 9401--9444 9402--9403
## [19] 9402--9404 9402--9405 9402--9406 9402--9407 9402--9408 9402--9409
## [25] 9402--9410 9402--9411 9402--9412 9402--9413 9402--9414 9402--9415
## [31] 9402--9418 9402--9419 9402--9435 9402--9438 9402--9443 9402--9444
## [37] 9403--9404 9403--9405 9403--9406 9403--9407 9403--9408 9403--9409
## [43] 9403--9410 9403--9411 9403--9412 9403--9413 9403--9414 9403--9415
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# If we have a function that takes two arguments, we can use map2(). For}
\CommentTok{\# example, graph\_from\_data\_frame() can take two arguments: the ego\textquotesingle{}s edge list}
\CommentTok{\# and the ego\textquotesingle{}s alter attribute data frame. }

\CommentTok{\# We now have a list of edge lists, one for each ego.}
\FunctionTok{length}\NormalTok{(elist.all.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# And a lsist of alter attribute data frames, one for each ego.}
\FunctionTok{length}\NormalTok{(alter.attr.list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s run graph\_from\_data\_frame() for the first ego, i.e., using the first}
\CommentTok{\# element of each of the two lists.}
\NormalTok{(gr }\OtherTok{\textless{}{-}} \FunctionTok{graph\_from\_data\_frame}\NormalTok{(}\AttributeTok{d=}\NormalTok{ elist.all.list[[}\DecValTok{1}\NormalTok{]], }
                             \AttributeTok{vertices=}\NormalTok{ alter.attr.list[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{directed=} \ConstantTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## IGRAPH 39e6262 UNW- 45 259 -- 
## + attr: name (v/c), ego_ID (v/n), alter_num (v/n), alter.sex (v/c),
## | alter.age.cat (v/c), alter.rel (v/c), alter.nat (v/c), alter.res
## | (v/c), alter.clo (v/n), alter.loan (v/c), alter.fam (v/c), alter.age
## | (v/n), ego_ID (e/n), weight (e/n)
## + edges from 39e6262 (vertex names):
##  [1] 2801--2802 2801--2803 2801--2804 2801--2805 2801--2806 2801--2807
##  [7] 2801--2808 2801--2809 2801--2810 2801--2811 2801--2812 2801--2813
## [13] 2801--2814 2801--2815 2801--2818 2801--2820 2801--2823 2801--2825
## [19] 2801--2827 2801--2828 2801--2829 2801--2831 2801--2840 2801--2841
## [25] 2802--2803 2802--2804 2802--2805 2802--2806 2802--2807 2802--2808
## + ... omitted several edges
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We can now run the same function for all egos at once.}
\NormalTok{gr.list }\OtherTok{\textless{}{-}}\NormalTok{ purrr}\SpecialCharTok{::}\FunctionTok{map2}\NormalTok{(}\AttributeTok{.x=}\NormalTok{ elist.all.list, }\AttributeTok{.y=}\NormalTok{ alter.attr.list, }
                       \SpecialCharTok{\textasciitilde{}} \FunctionTok{graph\_from\_data\_frame}\NormalTok{(}\AttributeTok{d=}\NormalTok{ .x, }\AttributeTok{vertices=}\NormalTok{ .y, }\AttributeTok{directed=} \ConstantTok{FALSE}\NormalTok{))}

\CommentTok{\# The result is again a list, with each element corresponding to one ego.}
\end{Highlighting}
\end{Shaded}

\hypertarget{more-igraph}{%
\section{\texorpdfstring{More operations with \texttt{igraph}}{More operations with igraph}}\label{more-igraph}}

\begin{itemize}
\tightlist
\item
  More examples of network visualization with \texttt{igraph}.
\item
  Add vertices to \texttt{igraph} objects, for example to add the ego node.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Example of network visualization with igraph}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Get graph of one ego{-}network.}
\NormalTok{gr }\OtherTok{\textless{}{-}}\NormalTok{ gr}\FloatTok{.28}

\CommentTok{\# Vertex attribute with alter\textquotesingle{}s country of residence.}
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.res}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka"
##  [7] "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka" "Sri Lanka"
## [13] "Italy"     "Italy"     "Italy"     "Italy"     "Italy"     "Italy"    
## [19] "Italy"     "Other"     "Italy"     "Italy"     "Italy"     "Italy"    
## [25] "Italy"     "Italy"     "Sri Lanka" "Sri Lanka" "Sri Lanka" "Italy"    
## [31] "Italy"     "Italy"     "Italy"     "Italy"     "Italy"     "Italy"    
## [37] "Italy"     "Italy"     "Italy"     "Sri Lanka" "Sri Lanka" "Italy"    
## [43] "Italy"     "Italy"     "Italy"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Set red as default vertex color.}
\NormalTok{color }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\FunctionTok{vcount}\NormalTok{(gr))}
\NormalTok{color}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "red" "red" "red" "red" "red" "red" "red" "red" "red" "red" "red" "red"
## [13] "red" "red" "red" "red" "red" "red" "red" "red" "red" "red" "red" "red"
## [25] "red" "red" "red" "red" "red" "red" "red" "red" "red" "red" "red" "red"
## [37] "red" "red" "red" "red" "red" "red" "red" "red" "red"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Set color=="blue" when vertex (alter) lives in Italy.}
\NormalTok{color[}\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.res}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"blue"}

\CommentTok{\# Set color=="green" when vertex (alter) lives in Other country.}
\NormalTok{color[}\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{alter.res}\SpecialCharTok{==}\StringTok{"Other"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"green"}

\CommentTok{\# Plot using the "color" vector we just created.}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{607}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(gr, }\AttributeTok{vertex.label=} \ConstantTok{NA}\NormalTok{, }\AttributeTok{vertex.size=}\DecValTok{7}\NormalTok{, }\AttributeTok{vertex.color=}\NormalTok{ color)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Egocentric_R_bookdown_files/figure-latex/more_igraph-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Add ego node to igraph object with igraph operations}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Use the + operator to add a named vertex, e.g. ego, to a graph.}
\NormalTok{gr.ego }\OtherTok{\textless{}{-}}\NormalTok{ gr }\SpecialCharTok{+} \StringTok{"ego"}

\CommentTok{\# The graph has now one more node. It has the same number of edges because we}
\CommentTok{\# haven\textquotesingle{}t added edges between ego and alters.}
\FunctionTok{vcount}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 45
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{vcount}\NormalTok{(gr.ego)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 46
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ecount}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 259
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ecount}\NormalTok{(gr.ego)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 259
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Ego is the 46th vertex.}
\FunctionTok{V}\NormalTok{(gr.ego)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## + 46/46 vertices, named, from afc3010:
##  [1] 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## [16] 2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## [31] 2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
## [46] ego
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s add all edges between ego and the alters.}

\CommentTok{\# Ego\textquotesingle{}s adjacency row. Note that the last (46th) cell is the diagonal cell}
\CommentTok{\# between ego and itself.}
\NormalTok{gr.ego[}\StringTok{"ego"}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845  ego 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s select ego\textquotesingle{}s row without the 46th cell: i.e., only cells (ties) between}
\CommentTok{\# ego and the 45 alters. }
\NormalTok{gr.ego[}\StringTok{"ego"}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{46}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##    0    0    0    0    0    0    0    0    0    0    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Note that we can write this in a more general way, which works for any graph}
\CommentTok{\# regardless of the number of vertices. Creating general code that applies to}
\CommentTok{\# different circumstances is essential when writing R functions.}
\NormalTok{gr.ego[}\StringTok{"ego"}\NormalTok{,}\SpecialCharTok{{-}}\FunctionTok{vcount}\NormalTok{(gr.ego)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##    0    0    0    0    0    0    0    0    0    0    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s set ego\textquotesingle{}s entire adjacency row with alters to 1\textquotesingle{}s. This adds edges}
\CommentTok{\# between ego and all alters.}
\NormalTok{gr.ego[}\StringTok{"ego"}\NormalTok{,}\SpecialCharTok{{-}}\FunctionTok{vcount}\NormalTok{(gr.ego)] }\OtherTok{\textless{}{-}} \DecValTok{1}

\CommentTok{\# We now have 45 more edges.}
\FunctionTok{ecount}\NormalTok{(gr.ego)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 304
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# See what the ego{-}network looks like now.}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(gr.ego)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Egocentric_R_bookdown_files/figure-latex/more_igraph-2.pdf}

\hypertarget{statnet}{%
\section{\texorpdfstring{The \texttt{statnet} suite of packages}{The statnet suite of packages}}\label{statnet}}

\begin{itemize}
\tightlist
\item
  \texttt{statnet} is a collection of different packages. The \texttt{statnet} packages we'll use in the following code are \texttt{network} and \texttt{sna}.
\item
  While \texttt{igraph} represents networks as objects of class \texttt{igraph}, \texttt{statnet} represents networks as objects of class \texttt{network}.
\item
  If your network is already stored in an \texttt{igraph} object but you want to analyze it with \texttt{statnet}, you can easily convert the \texttt{igraph} object into a \texttt{network} object using the \texttt{intergraph} package (function \texttt{asNetwork()}). The conversion preserves edge (adjacency) data, vertex attributes, edge attributes, and network attributes.
\item
  Of course, you can also create a \texttt{network} object from external data, such as an adjacency matrix stored in a csv file.
\item
  Similar to \texttt{igraph}, \texttt{statnet} allows you to import, set and view edge, vertex, and network attributes in addition to edge (adjacency) data.
\item
  \texttt{igraph} and \texttt{statnet} have overlapping function names. That is, there are \texttt{igraph} functions and \texttt{statnet} functions that have the same name, although they are obviously different functions. For example, both \texttt{igraph} and \texttt{statnet} have a function called \texttt{degree} to calculate vertex degree centrality. When both \texttt{igraph} and \texttt{statnet} are loaded, you should use the \texttt{package::function()} notation to specify which package you want to take the function from (see Section \ref{starting-R-and-loading-packages}).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load the statnet package "network" (we use suppressMessages() to avoid}
\CommentTok{\# printing verbose loading messages) and intergraph.}
\FunctionTok{library}\NormalTok{(network)}
\FunctionTok{library}\NormalTok{(sna)}
\FunctionTok{library}\NormalTok{(intergraph)}

\CommentTok{\# Let\textquotesingle{}s convert our ego{-}network to a statnet "network" object.}
\NormalTok{net.gr }\OtherTok{\textless{}{-}} \FunctionTok{asNetwork}\NormalTok{(gr)}

\CommentTok{\# Check out the object\textquotesingle{}s class.}
\FunctionTok{class}\NormalTok{(net.gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "network"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Print the object for basic information. Note that vertex and edge attributes}
\CommentTok{\# are correctly imported.}
\NormalTok{net.gr}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  Network attributes:
##   vertices = 45 
##   directed = FALSE 
##   hyper = FALSE 
##   loops = FALSE 
##   multiple = FALSE 
##   bipartite = FALSE 
##   total edges= 259 
##     missing edges= 0 
##     non-missing edges= 259 
## 
##  Vertex attribute names: 
##     alter_num alter.age alter.age.cat alter.clo alter.fam alter.loan alter.nat alter.rel alter.res alter.sex ego_ID vertex.names 
## 
##  Edge attribute names: 
##     weight
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Alternatively, we can create a network object from an adjacency matrix.}

\CommentTok{\# Adjacency matrix for ego 20}
\FunctionTok{head}\NormalTok{(adj}\FloatTok{.28}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## 2801   NA    1    1    1    1    1    1    1    1    1    1    1    1    1    1
## 2802    1   NA    1    1    1    1    1    1    1    1    1    1    1    0    1
## 2803    1    1   NA    1    1    1    1    1    1    1    1    1    0    0    0
## 2804    1    1    1   NA    1    1    1    1    1    1    2    0    0    0    0
## 2805    1    1    1    1   NA    1    1    1    1    1    1    0    0    0    0
## 2806    1    1    1    1    1   NA    1    1    1    1    1    1    0    0    0
##      2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## 2801    0    0    2    0    1    0    0    1    0    1    0    1    1    2    0
## 2802    0    0    0    0    0    0    0    1    0    0    0    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 2804    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 2805    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 2806    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
##      2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
## 2801    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2802    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2804    0    0    0    0    0    0    0    0    0    2    1    0    0    0    0
## 2805    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2806    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert to network object.}
\NormalTok{net }\OtherTok{\textless{}{-}} \FunctionTok{as.network}\NormalTok{(adj}\FloatTok{.28}\NormalTok{, }\AttributeTok{matrix.type =} \StringTok{"adjacency"}\NormalTok{, }\AttributeTok{directed=}\ConstantTok{FALSE}\NormalTok{, }
                  \AttributeTok{ignore.eval=}\ConstantTok{FALSE}\NormalTok{, }\AttributeTok{names.eval =} \StringTok{"weight"}\NormalTok{)}

\CommentTok{\# }\AlertTok{NOTE}\CommentTok{: }
\CommentTok{\# {-}{-} ignore.eval=FALSE imports adjacency cell values as edge attribute.}
\CommentTok{\# {-}{-} names.eval = "weight" indicates that the resulting edge attribute should be}
\CommentTok{\# called "weight".}

\CommentTok{\# Print the result. Note that there is only "vertex.names" as vertex attribute.}
\NormalTok{net}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  Network attributes:
##   vertices = 45 
##   directed = FALSE 
##   hyper = FALSE 
##   loops = FALSE 
##   multiple = FALSE 
##   bipartite = FALSE 
##   total edges= 259 
##     missing edges= 0 
##     non-missing edges= 259 
## 
##  Vertex attribute names: 
##     vertex.names 
## 
##  Edge attribute names: 
##     weight
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# The matrix column names are imported as vertex attribute "vertex name".}
\NormalTok{net }\SpecialCharTok{\%v\%} \StringTok{"vertex.names"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "2801" "2802" "2803" "2804" "2805" "2806" "2807" "2808" "2809" "2810"
## [11] "2811" "2812" "2813" "2814" "2815" "2816" "2817" "2818" "2819" "2820"
## [21] "2821" "2822" "2823" "2824" "2825" "2826" "2827" "2828" "2829" "2830"
## [31] "2831" "2832" "2833" "2834" "2835" "2836" "2837" "2838" "2839" "2840"
## [41] "2841" "2842" "2843" "2844" "2845"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# We want to import more vertex attributes. Let\textquotesingle{}s get alter attributes for ego 28.}
\NormalTok{vert.attr }\OtherTok{\textless{}{-}}\NormalTok{ alter.attr}\FloatTok{.28}

\CommentTok{\# We can now take columns from "vert.attr" and set them as attributes. However,}
\CommentTok{\# we first need to make sure that nodes are in the same order in the attribute}
\CommentTok{\# data frame (vert.attr) and in the network object (net).}
\FunctionTok{identical}\NormalTok{(net }\SpecialCharTok{\%v\%} \StringTok{"vertex.names"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(vert.attr}\SpecialCharTok{$}\NormalTok{alter\_ID))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s import, for example, the sex alter attribute.}
\CommentTok{\# There\textquotesingle{}s no sex attribute right now in the "net" object.}
\NormalTok{net }\SpecialCharTok{\%v\%} \StringTok{"alter.sex"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s set it.}
\NormalTok{net }\SpecialCharTok{\%v\%} \StringTok{"alter.sex"} \OtherTok{\textless{}{-}}\NormalTok{ vert.attr}\SpecialCharTok{$}\NormalTok{alter.sex}


\CommentTok{\# Basic statistics: Number of nodes, dyads, edges in the network.}
\FunctionTok{network.size}\NormalTok{(net)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 45
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{network.dyadcount}\NormalTok{(net)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 990
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{network.edgecount}\NormalTok{(net)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 259
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Simple plot}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2106}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(net)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Egocentric_R_bookdown_files/figure-latex/statnet-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A network object can be indexed as an adjacency matrix.}

\CommentTok{\# Adjacency matrix row for alter \#3}
\NormalTok{net[}\DecValTok{3}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 1 1 0 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [39] 0 1 1 0 0 0 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...for first 3 alters}
\NormalTok{net[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815
## 2801    0    1    1    1    1    1    1    1    1    1    1    1    1    1    1
## 2802    1    0    1    1    1    1    1    1    1    1    1    1    1    0    1
## 2803    1    1    0    1    1    1    1    1    1    1    1    1    0    0    0
##      2816 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830
## 2801    0    0    1    0    1    0    0    1    0    1    0    1    1    1    0
## 2802    0    0    0    0    0    0    0    1    0    0    0    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
##      2831 2832 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845
## 2801    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2802    1    0    0    0    0    0    0    0    0    1    1    0    0    0    0
## 2803    0    0    0    0    0    0    0    0    0    1    1    0    0    0    0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get a specific vertex attribute.}
\NormalTok{net }\SpecialCharTok{\%v\%} \StringTok{"alter.sex"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Female" "Male"   "Male"   "Male"   "Female" "Female" "Male"   "Female"
##  [9] "Female" "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Male"  
## [17] "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Male"  
## [25] "Male"   "Male"   "Male"   "Female" "Male"   "Male"   "Male"   "Female"
## [33] "Male"   "Male"   "Male"   "Male"   "Female" "Male"   "Male"   "Male"  
## [41] "Male"   "Male"   "Male"   "Male"   "Male"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get a specific edge attribute.}
\NormalTok{net }\SpecialCharTok{\%e\%} \StringTok{"weight"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [75] 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 2 1
## [112] 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1
## [149] 1 1 1 1 1 1 1 2 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1
## [186] 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 2 1 1 1 1 1 1
## [223] 1 1 1 1 1 1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# When both igraph and statnet are loaded, you should call their functions using}
\CommentTok{\# the "::" notation.}

\CommentTok{\# E.g. there is a "degree()" function both in igraph and statnet (sna package).}
\CommentTok{\# Check out the help for degree: ?degree}

\CommentTok{\# If we just call "degree()", R will take it from the most recently loaded }
\CommentTok{\# package, in this case statnet (sna). This causes an error if degree() is}
\CommentTok{\# applied to an igraph object.}
\FunctionTok{degree}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in FUN(X[[i]], ...): as.edgelist.sna input must be an adjacency matrix/array, edgelist matrix, network, or sparse matrix, or list thereof.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s specify we want igraph\textquotesingle{}s degree().}
\NormalTok{igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 2801 2802 2803 2804 2805 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 2816 
##   24   17   13   12   12   13   13   12   10    9   11    8   18   14   16    9 
## 2817 2818 2819 2820 2821 2822 2823 2824 2825 2826 2827 2828 2829 2830 2831 2832 
##    9   10    2    2    9   18   27   13   10    8    4    3    3    3   15   16 
## 2833 2834 2835 2836 2837 2838 2839 2840 2841 2842 2843 2844 2845 
##   16   12   21    3   10   14   14   16   13    7   12    5   12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Before proceeding, let\textquotesingle{}s un{-}load the sna package to avoid function name }
\CommentTok{\# overlaps with igraph.}
\FunctionTok{detach}\NormalTok{(}\StringTok{"package:sna"}\NormalTok{, }\AttributeTok{unload=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{illustrative-example-personal-networks-of-sri-lankan-immigrants-in-italy}{%
\section{Illustrative example: personal networks of Sri Lankan immigrants in Italy}\label{illustrative-example-personal-networks-of-sri-lankan-immigrants-in-italy}}

In this section, we'll apply some of the tools presented earlier to a specific case study about the personal networks of Sri Lankan immigrants in Italy. We will demonstrate the use of R in four major tasks of personal network analysis:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \textbf{Visualization}. We'll write an R function that plots a personal network with specific graphical parameters. We'll then run this function on many personal networks and we'll export the output to an external pdf file.
\item
  \textbf{Compositional analysis}. We'll calculate multiple measures on network composition for all our personal networks at once.
\item
  \textbf{Structural analysis}. We'll write an R function that calculates multiple structural measures on a personal network and we'll run it on all the personal networks in our data at once.
\item
  \textbf{Association with ego-level variables}. We'll merge the results of personal network compositional and structural analysis with non-network ego-level data, and we'll analyze the association between ego-level attributes and personal network characteristics.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load package}
\FunctionTok{library}\NormalTok{(igraph)}
\FunctionTok{library}\NormalTok{(ggraph)}

\CommentTok{\# Load the data}
\FunctionTok{load}\NormalTok{(}\StringTok{"./Data/data.rda"}\NormalTok{)}

\CommentTok{\# Visualization}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# We want to produce the same kind of plot for all our personal networks, with}
\CommentTok{\# the following characteristics:}
\CommentTok{\# {-}{-} Vertices sized by degree centrality.}
\CommentTok{\# {-}{-} Sri Lankan alters in red, Italian alters in blue, Other alters in}
\CommentTok{\# grey.}
\CommentTok{\# {-}{-} Edges among Sri Lankans in light red, edges among Italians in light blue,}
\CommentTok{\# all other edges in grey.}

\CommentTok{\# Let\textquotesingle{}s first try this on a single ego{-}network.}

\CommentTok{\# Get an ego{-}network\textquotesingle{}s igaph object.}
\NormalTok{gr }\OtherTok{\textless{}{-}}\NormalTok{ gr.list[[}\StringTok{"45"}\NormalTok{]]}

\CommentTok{\# Vertex sequence of Sri Lankans.}
\NormalTok{slk }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{]}
\CommentTok{\# Vertex sequence of Italians.}
\NormalTok{ita }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{]}
\CommentTok{\# Vertex sequence of Other.}
\NormalTok{oth }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Other"}\NormalTok{]}

\CommentTok{\# Edge attribute indicating which group the edge is between.}
\CommentTok{\# Residual value.}
\FunctionTok{E}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{edge\_between }\OtherTok{\textless{}{-}} \StringTok{"other"}
\CommentTok{\# Overwrite value for edges among Sri Lankans.}
\FunctionTok{E}\NormalTok{(gr)[slk }\SpecialCharTok{\%{-}{-}\%}\NormalTok{ slk]}\SpecialCharTok{$}\NormalTok{edge\_between }\OtherTok{\textless{}{-}} \StringTok{"slk{-}slk"}
\CommentTok{\# Overwrite value for edges among Italians.}
\FunctionTok{E}\NormalTok{(gr)[ita }\SpecialCharTok{\%{-}{-}\%}\NormalTok{ ita]}\SpecialCharTok{$}\NormalTok{edge\_between }\OtherTok{\textless{}{-}} \StringTok{"ita{-}ita"}

\CommentTok{\# Calculate degree centrality and set it as vertex attribute in gr.}
\NormalTok{igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(gr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 4501 4502 4503 4504 4505 4506 4507 4508 4509 4510 4511 4512 4513 4514 4515 4516 
##   38   14   38    8    7    7   10    9    9    9    9    8    9    8    5    4 
## 4517 4518 4519 4520 4521 4522 4523 4524 4525 4526 4527 4528 4529 4530 4531 4532 
##   10   10    7   15    5    5    3    4    1    5    5    4    8    3    3    3 
## 4533 4534 4535 4536 4537 4538 4539 4540 4541 4542 4543 4544 4545 
##    5    5    5    4    1    5    8   10    9    7    7    8    9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{degree }\OtherTok{\textless{}{-}}\NormalTok{ igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(gr)}

\CommentTok{\# Plot}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{613}\NormalTok{)}
\FunctionTok{ggraph}\NormalTok{(gr, }\AttributeTok{layout=} \StringTok{"fr"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_edge\_link}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color=}\NormalTok{edge\_between), }\AttributeTok{width=}\DecValTok{1}\NormalTok{, }\AttributeTok{alpha=} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+} \CommentTok{\# Edges}
  \FunctionTok{geom\_node\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill=}\NormalTok{alter.nat, }\AttributeTok{size=}\NormalTok{ degree), }\AttributeTok{shape=}\DecValTok{21}\NormalTok{) }\SpecialCharTok{+} \CommentTok{\# Nodes}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"Italy"}\OtherTok{=}\StringTok{"blue"}\NormalTok{, }\StringTok{"Sri Lanka"}\OtherTok{=}\StringTok{"red"}\NormalTok{, }\StringTok{"Other"}\OtherTok{=}\StringTok{"grey"}\NormalTok{)) }\SpecialCharTok{+} \CommentTok{\# Colors for nodes}
  \FunctionTok{scale\_edge\_color\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"ita{-}ita"}\OtherTok{=}\StringTok{"blue"}\NormalTok{, }\StringTok{"slk{-}slk"}\OtherTok{=}\StringTok{"red"}\NormalTok{, }\StringTok{"other"}\OtherTok{=}\StringTok{"grey"}\NormalTok{)) }\SpecialCharTok{+} 
  \CommentTok{\# Colors for edges}
  \FunctionTok{ggtitle}\NormalTok{(gr}\SpecialCharTok{$}\NormalTok{ego\_ID) }\SpecialCharTok{+} \CommentTok{\# Ego ID as plot title}
  \FunctionTok{theme\_graph}\NormalTok{(}\AttributeTok{base\_family =} \StringTok{\textquotesingle{}Helvetica\textquotesingle{}}\NormalTok{) }\CommentTok{\# Empty plot theme for network visualizations}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.7\linewidth]{Egocentric_R_bookdown_files/figure-latex/case-study-1}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Let\textquotesingle{}s now plot the first 10 personal networks. We won\textquotesingle{}t print the plots in the}
\CommentTok{\# GUI, but we\textquotesingle{}ll export them to an external pdf file.}

\CommentTok{\# Put all the code above in a single function}
\NormalTok{my.plot }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(gr) \{}
  
  \CommentTok{\# Vertex sequence of Sri Lankans.}
\NormalTok{  slk }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{]}
  \CommentTok{\# Vertex sequence of Italians.}
\NormalTok{  ita }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{]}
  \CommentTok{\# Vertex sequence of Other.}
\NormalTok{  oth }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Other"}\NormalTok{]}
  
  \CommentTok{\# Edge attribute indicating which group the edge is between.}
  \CommentTok{\# Residual value.}
  \FunctionTok{E}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{edge\_between }\OtherTok{\textless{}{-}} \StringTok{"other"}
  \CommentTok{\# Overwrite value for edges among Sri Lankans.}
  \FunctionTok{E}\NormalTok{(gr)[slk }\SpecialCharTok{\%{-}{-}\%}\NormalTok{ slk]}\SpecialCharTok{$}\NormalTok{edge\_between }\OtherTok{\textless{}{-}} \StringTok{"slk{-}slk"}
  \CommentTok{\# Overwrite value for edges among Italians.}
  \FunctionTok{E}\NormalTok{(gr)[ita }\SpecialCharTok{\%{-}{-}\%}\NormalTok{ ita]}\SpecialCharTok{$}\NormalTok{edge\_between }\OtherTok{\textless{}{-}} \StringTok{"ita{-}ita"}
  
  \CommentTok{\# Calculate degree centrality and set it as vertex attribute in gr}
  \FunctionTok{degree}\NormalTok{(gr)}
  \FunctionTok{V}\NormalTok{(gr)}\SpecialCharTok{$}\NormalTok{degree }\OtherTok{\textless{}{-}} \FunctionTok{degree}\NormalTok{(gr)}
  
  \CommentTok{\# Plot}
  \FunctionTok{set.seed}\NormalTok{(}\DecValTok{613}\NormalTok{)}
  \FunctionTok{ggraph}\NormalTok{(gr, }\AttributeTok{layout=} \StringTok{"fr"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{geom\_edge\_link}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color=}\NormalTok{edge\_between), }\AttributeTok{width=}\DecValTok{1}\NormalTok{, }\AttributeTok{alpha=} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_node\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill=}\NormalTok{alter.nat, }\AttributeTok{size=}\NormalTok{ degree), }\AttributeTok{shape=}\DecValTok{21}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"Italy"}\OtherTok{=}\StringTok{"blue"}\NormalTok{, }\StringTok{"Sri Lanka"}\OtherTok{=}\StringTok{"red"}\NormalTok{, }\StringTok{"Other"}\OtherTok{=}\StringTok{"grey"}\NormalTok{)) }\SpecialCharTok{+} 
    \FunctionTok{scale\_edge\_color\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"ita{-}ita"}\OtherTok{=}\StringTok{"blue"}\NormalTok{, }\StringTok{"slk{-}slk"}\OtherTok{=}\StringTok{"red"}\NormalTok{, }\StringTok{"other"}\OtherTok{=}\StringTok{"grey"}\NormalTok{)) }\SpecialCharTok{+} 
    \FunctionTok{ggtitle}\NormalTok{(gr}\SpecialCharTok{$}\NormalTok{ego\_ID) }\SpecialCharTok{+}
    \FunctionTok{theme\_graph}\NormalTok{(}\AttributeTok{base\_family =} \StringTok{\textquotesingle{}Helvetica\textquotesingle{}}\NormalTok{)}
\NormalTok{\}}

\CommentTok{\# Run the function we just created on each of the first 10 personal networks}
\CommentTok{\# with a for loop.}

\CommentTok{\# Open pdf device}
\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"./Figures/ego\_nets\_graphs.pdf"}\NormalTok{)}

\CommentTok{\# For loop to make plot for each i in first 10 ego{-}networks.}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{) \{}
  
  \CommentTok{\# Get the graph from list}
\NormalTok{  gr }\OtherTok{\textless{}{-}}\NormalTok{ gr.list[[i]]}
  
  \CommentTok{\# Run the plot function and print (needed for ggplot within a for loop).}
  \FunctionTok{my.plot}\NormalTok{(gr) }\SpecialCharTok{|\textgreater{}} \FunctionTok{print}\NormalTok{()}
\NormalTok{\}}

\CommentTok{\# Close pdf device}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## pdf 
##   2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same result, but with tidyverse code:}

\CommentTok{\# Open pdf device}
\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"./Figures/ego\_nets\_graphs.pdf"}\NormalTok{)}

\CommentTok{\# Get list of ego{-}networks (first 10 elements)}
\NormalTok{gr.list[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{] }\SpecialCharTok{|\textgreater{}}
  \CommentTok{\# walk: similar to map(), but calls a function for its side effects (here,}
  \CommentTok{\# producing a plot)}
  \FunctionTok{walk}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{my.plot}\NormalTok{(.x) }\SpecialCharTok{|\textgreater{}} \FunctionTok{print}\NormalTok{())}

\CommentTok{\# Close pdf device}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## pdf 
##   2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Compositional analysis}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Frequency of different nationalities in the personal networks.}

\CommentTok{\# Group the pooled alter attribute data frame by ego\_ID.}
\NormalTok{alter.attr.all }\OtherTok{\textless{}{-}}\NormalTok{ alter.attr.all }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{group\_by}\NormalTok{(ego\_ID)}

\CommentTok{\# Run the compositional measures.}
\NormalTok{comp.measures }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(alter.attr.all, }
                                  \CommentTok{\# N Italians}
                                  \AttributeTok{N.ita=} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{), }
                                  \CommentTok{\# N Sri Lankans}
                                  \AttributeTok{N.slk=} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Sri Lanka"}\NormalTok{), }
                                  \CommentTok{\# N Others}
                                  \AttributeTok{N.oth=} \FunctionTok{sum}\NormalTok{(alter.nat}\SpecialCharTok{==}\StringTok{"Other"}\NormalTok{))}

\CommentTok{\# Add the relative frequency of Italians.}
\NormalTok{comp.measures }\OtherTok{\textless{}{-}}\NormalTok{ comp.measures }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{prop.ita =}\NormalTok{ N.ita}\SpecialCharTok{/}\DecValTok{45}\NormalTok{)}

\CommentTok{\# Show result.}
\NormalTok{comp.measures}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 5
##    ego_ID N.ita N.slk N.oth prop.ita
##     <dbl> <int> <int> <int>    <dbl>
##  1     28     0    43     2   0     
##  2     29     1    44     0   0.0222
##  3     33     2    32    11   0.0444
##  4     35     4    33     8   0.0889
##  5     39     5    39     1   0.111 
##  6     40     1    34    10   0.0222
##  7     45    19    14    12   0.422 
##  8     46     7    33     5   0.156 
##  9     47     0    45     0   0     
## 10     48     4    39     2   0.0889
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Structural analysis}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# We are going to write a function that takes an igraph object as argument and }
\CommentTok{\# returns 3 values:}
\CommentTok{\# {-}{-} The density of ties among Italian alters}
\CommentTok{\# {-}{-} The average degree of Italian alters.}
\CommentTok{\# {-}{-} The average degree of Italian alters, as a proportion of the overall}
\CommentTok{\# average degree.}

\CommentTok{\# Write the function.}
\NormalTok{str.ita }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(gr) \{}
  
  \CommentTok{\# Vertex sequence of Italians in the graph.}
\NormalTok{  ita }\OtherTok{\textless{}{-}} \FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{]}
  
  \CommentTok{\# Number of Italians.}
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(ita)}
  
  \CommentTok{\# Number of all possible edges among Italians.}
\NormalTok{  possible }\OtherTok{\textless{}{-}}\NormalTok{ n}\SpecialCharTok{*}\NormalTok{(n}\DecValTok{{-}1}\NormalTok{)}\SpecialCharTok{/}\DecValTok{2}
  
  \CommentTok{\# Actual number of edges among Italians.}
\NormalTok{  actual }\OtherTok{\textless{}{-}} \FunctionTok{E}\NormalTok{(gr)[ita }\SpecialCharTok{\%{-}{-}\%}\NormalTok{ ita] }\SpecialCharTok{|\textgreater{}} \FunctionTok{length}\NormalTok{()}
  \CommentTok{\# Notice that this is 0 if there are no Italian contacts, i.e. length(ita)==0.}
  
  \CommentTok{\# Density of connections among Italians.}
\NormalTok{  dens.ita }\OtherTok{\textless{}{-}}\NormalTok{ actual}\SpecialCharTok{/}\NormalTok{possible}
  \CommentTok{\# Notice that this is NaN if there are no Italian contacts.}
  
  \CommentTok{\# Average degree of Italian contacts.}
\NormalTok{  avg.deg.ita }\OtherTok{\textless{}{-}}\NormalTok{ igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(gr, }\FunctionTok{V}\NormalTok{(gr)[alter.nat}\SpecialCharTok{==}\StringTok{"Italy"}\NormalTok{]) }\SpecialCharTok{|\textgreater{}} \FunctionTok{mean}\NormalTok{()}
  \CommentTok{\# This is also NaN if there are no Italians.}
  
  \CommentTok{\# Average degree of Italians, as a proportion of overall average degree.}
\NormalTok{  avg.deg.ita.prop }\OtherTok{\textless{}{-}}\NormalTok{ avg.deg.ita}\SpecialCharTok{/}\FunctionTok{mean}\NormalTok{(igraph}\SpecialCharTok{::}\FunctionTok{degree}\NormalTok{(gr))}
  \CommentTok{\# This is also NaN if there are no Italians. }
  
  \CommentTok{\# Return the 3 results as a tibble}
  \FunctionTok{tibble}\NormalTok{(}\AttributeTok{dens.ita =}\NormalTok{ dens.ita, }
         \AttributeTok{avg.deg.ita =}\NormalTok{ avg.deg.ita, }
         \AttributeTok{avg.deg.ita.prop =}\NormalTok{ avg.deg.ita.prop)}
\NormalTok{\}}

\CommentTok{\# Run the function on all personal networks.}
\NormalTok{(str.ita.df }\OtherTok{\textless{}{-}} \FunctionTok{map\_dfr}\NormalTok{(gr.list, str.ita, }\AttributeTok{.id=} \StringTok{"ego\_ID"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 4
##    ego_ID dens.ita avg.deg.ita avg.deg.ita.prop
##    <chr>     <dbl>       <dbl>            <dbl>
##  1 28      NaN          NaN             NaN    
##  2 29      NaN            0               0    
##  3 33        1            1               0.109
##  4 35        0            3.25            0.331
##  5 39        0            0               0    
##  6 40      NaN            3               0.265
##  7 45        0.193        6.11            0.751
##  8 46        0.571       10.7             0.903
##  9 47      NaN          NaN             NaN    
## 10 48        1            5               0.560
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Convert ego\_ID from character to numeric for consistency with ego attribute}
\CommentTok{\# data.}
\NormalTok{str.ita.df }\OtherTok{\textless{}{-}}\NormalTok{ str.ita.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ego\_ID =} \FunctionTok{as.numeric}\NormalTok{(ego\_ID))}

\CommentTok{\# Association with ego{-}level variables}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} }

\CommentTok{\# Ego attribute data}
\NormalTok{ego.df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 9
##    ego_ID ego.sex ego.age ego.arr ego.edu ego.inc  empl ego.empl.bin ego.age.cat
##     <dbl> <fct>     <dbl>   <dbl> <fct>     <dbl> <dbl> <fct>        <fct>      
##  1     28 Male         61    2008 Second~     350     3 Yes          60+        
##  2     29 Male         38    2000 Primary     900     4 Yes          36-40      
##  3     33 Male         30    2010 Primary     200     3 Yes          26-30      
##  4     35 Male         25    2009 Second~    1000     3 Yes          18-25      
##  5     39 Male         29    2007 Primary       0     1 No           26-30      
##  6     40 Male         56    2008 Second~     950     4 Yes          51-60      
##  7     45 Male         52    1975 Primary    1600     3 Yes          51-60      
##  8     46 Male         35    2002 Second~    1200     4 Yes          31-35      
##  9     47 Male         22    2010 Second~     700     4 Yes          18-25      
## 10     48 Male         51    2007 Primary     950     4 Yes          51-60      
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Join ego{-}level data with compositional variables obtained above.}
\NormalTok{ego.df }\OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{left\_join}\NormalTok{(comp.measures, }\AttributeTok{by=} \StringTok{"ego\_ID"}\NormalTok{)}

\CommentTok{\# Merge ego{-}level data with structural variables obtained above.}
\NormalTok{ego.df }\OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{left\_join}\NormalTok{(str.ita.df, }\AttributeTok{by=} \StringTok{"ego\_ID"}\NormalTok{)}

\CommentTok{\# See the result (just a subset of the variables)}
\NormalTok{ego.df }\SpecialCharTok{|\textgreater{}} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(ego\_ID, ego.sex, ego.age, N.slk, prop.ita, dens.ita)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 102 x 6
##    ego_ID ego.sex ego.age N.slk prop.ita dens.ita
##     <dbl> <fct>     <dbl> <int>    <dbl>    <dbl>
##  1     28 Male         61    43   0       NaN    
##  2     29 Male         38    44   0.0222  NaN    
##  3     33 Male         30    32   0.0444    1    
##  4     35 Male         25    33   0.0889    0    
##  5     39 Male         29    39   0.111     0    
##  6     40 Male         56    34   0.0222  NaN    
##  7     45 Male         52    14   0.422     0.193
##  8     46 Male         35    33   0.156     0.571
##  9     47 Male         22    45   0       NaN    
## 10     48 Male         51    39   0.0889    1    
## # i 92 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot number by mean degree of Italians.}
\CommentTok{\# To avoid warnings from ggplot(), let\textquotesingle{}s remove cases with NA values on the}
\CommentTok{\# relevant variables.}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{complete.cases}\NormalTok{(N.ita, avg.deg.ita))}

\CommentTok{\# Set seed for reproducibility (jittering is random).}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{613}\NormalTok{)}
\CommentTok{\# Get and save plot}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{ data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ N.ita, }\AttributeTok{y=}\NormalTok{ avg.deg.ita)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\FloatTok{1.5}\NormalTok{, }\AttributeTok{alpha=}\FloatTok{0.4}\NormalTok{, }\AttributeTok{position=}\FunctionTok{position\_jitter}\NormalTok{(}\AttributeTok{height=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.5}\NormalTok{)) }\SpecialCharTok{+} 
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=} \StringTok{"N Italians"}\NormalTok{, }\AttributeTok{y=} \StringTok{"Mean degree of Italians"}\NormalTok{)}
\CommentTok{\# Note that we slightly jitter the points to avoid overplotting.}
\CommentTok{\# Print plot.}
\FunctionTok{print}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.7\linewidth]{Egocentric_R_bookdown_files/figure-latex/case-study-2}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same as above, but with ego\_IDs as labels to identify the egos.}
\CommentTok{\# Set seed for reproducibility (jittering is random).}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{613}\NormalTok{)}
\CommentTok{\# Get and save plot}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{ data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ N.ita, }\AttributeTok{y=}\NormalTok{ avg.deg.ita)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{ ego\_ID), }\AttributeTok{size=}\DecValTok{3}\NormalTok{, }\AttributeTok{alpha=}\FloatTok{0.7}\NormalTok{, }
            \AttributeTok{position=}\FunctionTok{position\_jitter}\NormalTok{(}\AttributeTok{height=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.5}\NormalTok{)) }\SpecialCharTok{+} 
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=} \StringTok{"N Italians"}\NormalTok{, }\AttributeTok{y=} \StringTok{"Mean degree of Italians"}\NormalTok{)}
\CommentTok{\# Note that we slightly jitter the labels with position\_jitter() so that egoIDs}
\CommentTok{\# don\textquotesingle{}t overlap and are more readable.}
\CommentTok{\# Print plot.}
\FunctionTok{print}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.7\linewidth]{Egocentric_R_bookdown_files/figure-latex/case-study-3}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Same as above, with color representing ego\textquotesingle{}s educational level.}
\CommentTok{\# Set seed for reproducibility (jittering is random).}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{613}\NormalTok{)}
\CommentTok{\# Get and save plot}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{ data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ N.ita, }\AttributeTok{y=}\NormalTok{ avg.deg.ita)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\FloatTok{1.5}\NormalTok{, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{color=} \FunctionTok{as.factor}\NormalTok{(ego.edu)), }
             \AttributeTok{position=}\FunctionTok{position\_jitter}\NormalTok{(}\AttributeTok{height=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.5}\NormalTok{)) }\SpecialCharTok{+} 
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position=}\StringTok{"bottom"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=} \StringTok{"N Italians"}\NormalTok{, }\AttributeTok{y=} \StringTok{"Mean degree of Italians"}\NormalTok{, }\AttributeTok{color=} \StringTok{"Education"}\NormalTok{)}
\CommentTok{\# Note that we slightly jitter the points to avoid overplotting.}
\CommentTok{\# Print plot.}
\FunctionTok{print}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.7\linewidth]{Egocentric_R_bookdown_files/figure-latex/case-study-4}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Do Sri Lankans who arrived to Italy more recently have fewer Italian contacts}
\CommentTok{\# in their personal network?}

\CommentTok{\# To avoid warnings from ggplot(), let\textquotesingle{}s remove cases with NA values on the}
\CommentTok{\# relevant variables.}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{complete.cases}\NormalTok{(ego.arr, prop.ita))}

\CommentTok{\# Set seed for reproducibility (jittering is random).}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{613}\NormalTok{)}
\CommentTok{\# Get and save plot}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{ data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ ego.arr, }\AttributeTok{y=}\NormalTok{ prop.ita)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{shape=} \DecValTok{1}\NormalTok{, }\AttributeTok{size=} \FloatTok{1.5}\NormalTok{, }\AttributeTok{position=} \FunctionTok{position\_jitter}\NormalTok{(}\AttributeTok{width=} \DecValTok{1}\NormalTok{, }\AttributeTok{height=} \FloatTok{0.01}\NormalTok{)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"loess"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=} \StringTok{"Year of arrival in Italy"}\NormalTok{, }\AttributeTok{y=} \StringTok{"Prop Italians in personal network"}\NormalTok{)}
\CommentTok{\# Print plot.}
\FunctionTok{print}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula = 'y ~ x'
\end{verbatim}

\includegraphics[width=0.7\linewidth]{Egocentric_R_bookdown_files/figure-latex/case-study-5}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Do Sri Lankans with more Italian contacts in their personal network have higher}
\CommentTok{\# income?}

\CommentTok{\# To avoid warnings from ggplot(), let\textquotesingle{}s remove cases with NA values on the}
\CommentTok{\# relevant variables.}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ ego.df }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{complete.cases}\NormalTok{(prop.ita, ego.inc))}

\CommentTok{\# Set seed for reproducibility (jittering is random).}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{613}\NormalTok{)}
\CommentTok{\# Get and save plot}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{ data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{ prop.ita, }\AttributeTok{y=}\NormalTok{ ego.inc)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_jitter}\NormalTok{(}\AttributeTok{width=} \FloatTok{0.01}\NormalTok{, }\AttributeTok{height=} \DecValTok{50}\NormalTok{, }\AttributeTok{shape=} \DecValTok{1}\NormalTok{, }\AttributeTok{size=} \FloatTok{1.5}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"loess"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=} \StringTok{"Prop Italians in personal network"}\NormalTok{, }\AttributeTok{y=} \StringTok{"Monthly income"}\NormalTok{)}
\DocumentationTok{\#\# Print plot.}
\FunctionTok{print}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula = 'y ~ x'
\end{verbatim}

\includegraphics[width=0.7\linewidth]{Egocentric_R_bookdown_files/figure-latex/case-study-6}

  \bibliography{book.bib,packages.bib}

\end{document}
